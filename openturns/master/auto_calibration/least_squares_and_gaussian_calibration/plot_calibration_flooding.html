
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Calibration of the flooding model &#8212; OpenTURNS 1.22dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Calibration of the Chaboche mechanical model" href="plot_calibration_chaboche.html" />
    <link rel="prev" title="Calibration of the deflection of a tube" href="plot_calibration_deflection_tube.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_calibration_chaboche.html" title="Calibration of the Chaboche mechanical model"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_calibration_deflection_tube.html" title="Calibration of the deflection of a tube"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.22dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Calibration</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Least squares and gaussian calibration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Calibration of the flooding model</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Calibration of the flooding model</a><ul>
<li><a class="reference internal" href="#parameters-to-calibrate-and-observations">Parameters to calibrate and observations</a></li>
<li><a class="reference internal" href="#define-the-observations">Define the observations</a></li>
<li><a class="reference internal" href="#create-the-physical-model">Create the physical model</a></li>
<li><a class="reference internal" href="#setting-the-calibration-parameters">Setting the calibration parameters</a></li>
<li><a class="reference internal" href="#create-the-parametric-function">Create the parametric function</a></li>
<li><a class="reference internal" href="#calibration-with-linear-least-squares">Calibration with linear least squares</a></li>
<li><a class="reference internal" href="#diagnostic-of-the-identification-issue">Diagnostic of the identification issue</a></li>
<li><a class="reference internal" href="#conclusion-of-the-linear-least-squares-calibration">Conclusion of the linear least squares calibration</a></li>
<li><a class="reference internal" href="#calibration-with-non-linear-least-squares">Calibration with non linear least squares</a></li>
<li><a class="reference internal" href="#analysis-of-the-results">Analysis of the results</a></li>
<li><a class="reference internal" href="#gaussian-linear-calibration">Gaussian linear calibration</a></li>
<li><a class="reference internal" href="#id1">Analysis of the results</a></li>
<li><a class="reference internal" href="#gaussian-nonlinear-calibration">Gaussian nonlinear calibration</a></li>
<li><a class="reference internal" href="#id2">Analysis of the results</a></li>
<li><a class="reference internal" href="#tuning-the-posterior-distribution-estimation">Tuning the posterior distribution estimation</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_calibration_deflection_tube.html"
                          title="previous chapter">Calibration of the deflection of a tube</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_calibration_chaboche.html"
                          title="next chapter">Calibration of the Chaboche mechanical model</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_calibration/least_squares_and_gaussian_calibration/plot_calibration_flooding.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-calibration-least-squares-and-gaussian-calibration-plot-calibration-flooding-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="calibration-of-the-flooding-model">
<span id="sphx-glr-auto-calibration-least-squares-and-gaussian-calibration-plot-calibration-flooding-py"></span><h1>Calibration of the flooding model<a class="headerlink" href="#calibration-of-the-flooding-model" title="Permalink to this heading">¶</a></h1>
<p>In this example we are interested in the calibration of the <a class="reference internal" href="../../usecases/use_case_flood_model.html#use-case-flood-model"><span class="std std-ref">flooding model</span></a>.
We calibrate the parameters of a flooding model where only the difference between the
downstream and upstream riverbed levels can be calibrated.
This example shows how to manage the lack of identifiability in a calibration problem.</p>
<p>This example use least squares to calibrate the parametric
model.
Please read <a class="reference internal" href="../../theory/data_analysis/code_calibration.html#code-calibration"><span class="std std-ref">Code calibration</span></a> for more details on code calibration and least squares.
This study is relatively complicated: please read the <a class="reference internal" href="plot_calibration_chaboche.html"><span class="doc">calibration of the Chaboche mechanical model</span></a> first if this is not already done.
The observations that we use in this study are simulated with the script
<a class="reference internal" href="plot_generate_flooding.html"><span class="doc">Generate flooding model observations</span></a>.</p>
<section id="parameters-to-calibrate-and-observations">
<h2>Parameters to calibrate and observations<a class="headerlink" href="#parameters-to-calibrate-and-observations" title="Permalink to this heading">¶</a></h2>
<p>The variables of the model are:</p>
<ul class="simple">
<li><p><img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAARBAMAAAAf5oCsAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAGJ2Lv90y+69gdEjzz+k90WGTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAcUlEQVQI12NgYGBUMnJkAAJTAYZ0AQYGjgAIng5kc31gYCgGSnH/ZuAAMhm4PjLwAKUYWD4w8CsAaZ4LDPILgPT8BAZ2AyB9BCh1QUib5QLQ1NMGzDdAxnJc1ktgAzEYeBmkwDSPgAOEPqcApplqGRgAUOkTS0IYTsgAAAAKdEVYdERlcHRoAAAAAAQgTiUVAAAAAElFTkSuQmCC" alt="Q" style="vertical-align: -4px"/> : Input. Observed.</p></li>
<li><p><img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAQBAMAAAAL9CkWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQI12NgYBD67MDgr8oABmwJDAyuECYDfwADSwGUXV/A0AllMsQzzIAxGZaxb4ezt57ZDGPyfr4gD2NzfGC43wBlcz1gYHsAZXMLMLB8B0p7ANn3DzAwADUXchQwMOavYWD8b8BQvxxuMAO7NIK5gAvO5uxpZwAAMp0ZVwjna2YAAAAKdEVYdERlcHRoAAAAAAO+KrC2AAAAAElFTkSuQmCC" alt="K_s" style="vertical-align: -3px"/>, <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQBAMAAADpKDJvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAbUlEQVQI12NgYPxk4vKVAQSYEhhYKsCsWQwM+w+AWRsYeL4xQMH0BVAGhyJMiDcAxhJqgDK4KhnYIKz3Dxi4wAzO3wwMpxg2cygwtDsw8GhyMzUEMNwXEY5XYJgKtAACVjEkQFlufDCjJu5jAADmYRY0Jy22YAAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="Z_v" style="vertical-align: -3px"/>, <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAQBAMAAAAPAfkrAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQI12NgYPxk4vKVAQqYEhhYKmCcWQwM+w/AOBsYeL4xIMD0BQg2hyKSBG8AEkeoAcHmqmRgg3PeP2DggrE5fzMwnOJY8kxymwMDQ7sDA48mN/+BtQwKDAz3RYTjFRjOMthxKMAUr2LQYBOAcWw4FJhfwzgXeBy41jAAAL5tGZE1SZVEAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="Z_m" style="vertical-align: -3px"/> : Input. Calibrated.</p></li>
<li><p><img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAANBAMAAABSlfMXAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dBj7YN3pz52LSDLi5wBxAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAZUlEQVQI12NgYBD67BCoJs7AwMDRwMAwC0gz8G9gYPgDYty/wMD+D8TYz8DAmABirAAqWwBiZAgKyh8A0nx/wcoYGHg+gJUxMHBNYGDoADHYBBgYskGM9wVgZQyM/ctZJT8XMAAA8OAWeIvNF8EAAAAKdEVYdERlcHRoAAAAAAAnI+EMAAAAAElFTkSuQmCC" alt="H" style="vertical-align: 0px"/>: Output. Observed.</p></li>
</ul>
<p>The vector of parameters to calibrate is:</p>
<div class="math">
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIUAAAATBAMAAABMy9NRAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdIuvMt3znRjpz2D7v0jPYBFiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACF0lEQVQ4y41UTWjUQBT+Msm62d02G7x4NF5UEDSw4qnSXKxYlN2beur6Ay6CEBDxYNHgoaeCOXtxQQR1oURPgoKiQr0oi4qIFwOiIhS6eiiKrPomaeandaED8+a9bybfTL73ZoB1zQ6x0VYunM179Ykq9X1DF1vPCOjj2cZkXATjKzcbv1a36+cj8w/oHJeol1rAFgmdACaiItjkwnxR7J8PU6jrHHzDeggjFYgVgv0R0UFgTzFXyYejuKZRGB6Z5RQ7JcQIcEXkwfle+GYG2z/R1DhKAZkruKqB1qIaHRaq17qZtDG2a8vHuLnlvNLAub6auHPSf5IpdKpxnYt9lzefAxxdfPhS4ziunTSW/oCbeoKT2vJD/OjDYFLFxjtq9C6SfpagZmQNNI5vXMQBmp6CzQaQmpafwxBBRv4IZl//dV5msXbg2m9AFu/jRNZnrscU5iNND67pmA+DCoKtlhCdyQlZdy5P0Q/gq33+3tttvtAUPb3EKkTZTAAS9RNLrduUh2fAl8DrVDBNc/M+nNOsnl5AmwhbHKvtSNbcIyrlmR7Mv30sL8B5SnkY7r+zAitmWCKRZt58uNHGZ/Rs4mAeloL1d9HqCteZgJSvHJIrlL2IjkE6lqL/X+hjgqJbVThM94HCsWC3q/eB6RGPwhFRj7t2K19ZrxMlpy3HL18G3o/gqLlqpAXGmqUsHfU6BRt+x6zM/gPRCHOzQMdcdAAAAAp0RVh0RGVwdGgA/////o6f8XkAAAAASUVORK5CYII=" alt="\theta = (K_s,Z_v,Z_m)."/></p>
</div><p>In the description of the <a class="reference internal" href="../../usecases/use_case_flood_model.html#use-case-flood-model"><span class="std std-ref">flooding model</span></a>,
we see that only one parameter can be identified.
Hence, calibrating this model requires some regularization.
We return to this topic when analyzing the singular values of
the Jacobian matrix.</p>
<p>We consider a sample size equal to:</p>
<div class="math">
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADkAAAAMBAMAAAAqgQioAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdJ2LGM9IMmD73fO/r+mGTbZDAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAo0lEQVQY02NgwAR9CQwMTbYNDFhBUX4CA9sDhufYZRn4Exi4BBh0cMsCUSeIyajsbJqAIZtfwJDvAGRWZBowLgDSPKEgcAEq218AUsDAIGDNwBSATW8/SJbhLAOrAoZsfQKDPMhkhhkM/AWYrmpgkAQx2T8wyHFg2MtlwKAKYjI/YDjLjKa3gYFjATA0Sh0YmAwYckVQJH3j3yYwCMk2MGQWAACamyW2Qg8fJAAAAAp0RVh0RGVwdGgA////+RD7ZNoAAAAASUVORK5CYII=" alt="n = 10."/></p>
</div><p>The observations are the couples <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH4AAAAUBAMAAAC5YpSHAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAGL9g6Z0ySHTd88+L+6+Dk2LmAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACCUlEQVQ4y5VUPWgUURD+Nnt5d3u3d25zjZH82J7glgabWCQEYnEEhBAUD0yVFC7YCreIjSDk0gSs9DpNEFZS2W1jmjSxsBAsEpJGo5sQyE9h4ffeu93c3XJ3OMvsm5k3376Z7w0LGDddoIweMkx9hn6SqfIVUMsP550k+uvUH/14ABjjgHm/H/5ajaewBHsN4msStRrAnDReU+vOAHyG68+WtqKs6q8qjzpWG4DnIaY8ezWJ1j2Y59Io+TqlL34dKIYa1ZLHRO5KwwwG4GVxzDyW9mrS6GdSEChrdwC+Tn0HfJD27ST6PYqOQ2WdEO/2hmdnATEFnElnEzkNEheqGemRF3NW3wOv81U3fnKC35iCcSl7PY+j9omiQEqTqEpcQO5lqoBF7rP+HzTz43GwwIreIO4/s5dkL6X5c1ROxXjgVYAdHSwS8U17kj8PdpDGlw9eOJrce8D159jZg513xCduPXUlBfQgGiolbI5GUbTfgQ8v4uFYoHf0ZQY17mfZSentlnF46spsO1QpkuLu87ONgqfxK8oPDB+/ydFVBj1Ll1gK0/jharE1f5aam+YQNWzH01vRI5a/oetfhkiegnf3CfHsQSjiN6aBWzX4V3h6E3rEhrZVwPyzbVUtXz1VCyOsKvee8Tty85Hm2G+/HdvT49MmftdqMkX0Gk+R+v8Ybuf6v5LrWP8BqIR72S4dPfEAAAAKdEVYdERlcHRoAAAAAAbOQEQ5AAAAAElFTkSuQmCC" alt="\{(Q_i,H_i)\}_{i=1,...,n}" style="vertical-align: -6px"/>, i.e. each observation is a
couple made of the flowrate and the corresponding river height.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">flood_model</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>

<span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsUnsignedInteger</span><span class="p">(</span><span class="s2">&quot;Normal-SmallDimension&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="define-the-observations">
<h2>Define the observations<a class="headerlink" href="#define-the-observations" title="Permalink to this heading">¶</a></h2>
<p>In practice, we generally use a data set which has been obtained from
measurements.
This data set can be loaded using e.g. <a class="reference internal" href="../../user_manual/_generated/openturns.Sample.html#openturns.Sample.ImportFromCSVFile" title="openturns.Sample.ImportFromCSVFile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ImportFromCSVFile()</span></code></a>.
Here we import the data from the
<a class="reference internal" href="../../user_manual/_generated/openturns.usecases.flood_model.FloodModel.html#openturns.usecases.flood_model.FloodModel" title="openturns.usecases.flood_model.FloodModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">FloodModel</span></code></a>
class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fm</span> <span class="o">=</span> <span class="n">flood_model</span><span class="o">.</span><span class="n">FloodModel</span><span class="p">()</span>
<span class="n">Qobs</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Hobs</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">nbobs</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="n">fm</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<table>
  <tr><td></td><th>Q ($m^3/s$)</th><th>H (m)</th></tr>
  <tr><th>0</th><td>130</td><td>0.59</td></tr>
  <tr><th>1</th><td>530</td><td>1.33</td></tr>
  <tr><th>2</th><td>960</td><td>2.03</td></tr>
  <tr><th>3</th><td>1400</td><td>2.72</td></tr>
  <tr><th>4</th><td>1830</td><td>2.83</td></tr>
  <tr><th>5</th><td>2260</td><td>3.5</td></tr>
  <tr><th>6</th><td>2700</td><td>3.82</td></tr>
  <tr><th>7</th><td>3130</td><td>4.36</td></tr>
  <tr><th>8</th><td>3560</td><td>4.63</td></tr>
  <tr><th>9</th><td>4010</td><td>4.96</td></tr>
</table>
</div>
<br />
<br /></section>
<section id="create-the-physical-model">
<h2>Create the physical model<a class="headerlink" href="#create-the-physical-model" title="Permalink to this heading">¶</a></h2>
<p>We define the model <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMBAMAAABCcoqQAAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMAGK+LMun7dGCdz7/z+qwmQAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAEtJREFUCNdjYGBUNhRgYHAVEDNgYAhn4HVg4LjA0MbAwBnAoMXAwL2BIZiBgX0B8xUGBgblygQgycC0AETyFDAwTGUoBbKqixUYGABabgpEH3HNBQAAAAp0RVh0RGVwdGgAAAAABCBOJRUAAAAASUVORK5CYII=" alt="g" style="vertical-align: -4px"/> which has 4 inputs and one output H.</p>
<p>The nonlinear least squares algorithm does not take into account for bounds
in the parameters.
Therefore, we ensure that the output is computed whatever the inputs.
The model fails into two situations:</p>
<ul class="simple">
<li><p>if <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAQBAMAAABAXPr7AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA3klEQVQY02NgYBD67MDgr8qAHbAlMDC4YogebTwAovgDGFgK0OXYHzC8BdH1BQydKBI3QcY5MASD2PEMM1DkqixBxhUwnAZxlrFvR5ZziwQbd4GhfgKQ3npmM0KKM8wBTJ+/AJJn4P18QR4ux2sFdRpQBijPwPGB4X4DTPL0ASjjfgGDP9BYrgcMbA8wdPIfYPAGUtwCDCzfgQZ4QOyUgtjJ1sAQBTIAaBLQRYUcUD1tASCSJwEUCIz5axgY/xsw1C+HGX1KEkS6Oh5ACi9plBBCDcsFXAw4AWdPO6YgAA5yNs3592b6AAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="K_s&lt;0" style="vertical-align: -3px"/>,</p></li>
<li><p>if <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAAAQBAMAAADwo9zJAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABLUlEQVQoz2NgYPxk4vKVAQ1gFYQDpgQGlgqiBIHg1ZYHQHIWA8P+A+hSWAUZGHgCGCKB1AYGnm8YclgEZwAxbwLDQjBn+gIsTkAXPCwBJPgPMDwHcTgUsehAF8xdASLPT2A43wCyLQCLFlRBjrUJYPr9BJAuBgahBixaUAQ5haFBAVQP1MXAVcnABpV6excIboNYSIJA8PwBlDH/AEM+0Kz3Dxi4MCxBFYTbwv+AIR3I/c3AcIphM4cCsg6wIMeSZ5LbHCB+cYb4hXcDw2IGhnYHBh5NbqYGFO9CBPkPrGWAmbQXHOZ8F0BReV9EOF6BYSow8pAARPAsgx3C8sceIDIrBeYthlUMCZihtopBg00AJfaRgRsflpC24VBgfo0zOU/ch0XwAo8D1xpMYQCaiFYxY0LlvAAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="Z_v-Z_m&lt;0" style="vertical-align: -3px"/>.</p></li>
</ul>
<p>In these cases, we return an infinite number, so that the optimization
algorithm does not get trapped.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">functionFlooding</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">5.0e3</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mf">300.0</span>
    <span class="n">Q</span><span class="p">,</span> <span class="n">K_s</span><span class="p">,</span> <span class="n">Z_v</span><span class="p">,</span> <span class="n">Z_m</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z_m</span> <span class="o">-</span> <span class="n">Z_v</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">K_s</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q</span> <span class="o">/</span> <span class="p">(</span><span class="n">K_s</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))</span> <span class="o">**</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">H</span><span class="p">]</span>


<span class="n">g</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">functionFlooding</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MemoizeFunction</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">setInputDescription</span><span class="p">([</span><span class="s2">&quot;Q ($m^3/s$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Ks ($m^{1/3}/s$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Zv (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Zm (m)&quot;</span><span class="p">])</span>
<span class="n">g</span><span class="o">.</span><span class="n">setOutputDescription</span><span class="p">([</span><span class="s2">&quot;H (m)&quot;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="setting-the-calibration-parameters">
<h2>Setting the calibration parameters<a class="headerlink" href="#setting-the-calibration-parameters" title="Permalink to this heading">¶</a></h2>
<p>Define the value of the reference values of the <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/> parameter.
In the Bayesian framework, this is called the mean of the <em>prior</em> normal
distribution.
In the data assimilation framework, this is called the <em>background</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">KsInitial</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">ZvInitial</span> <span class="o">=</span> <span class="mf">49.0</span>
<span class="n">ZmInitial</span> <span class="o">=</span> <span class="mf">51.0</span>
<span class="n">thetaPrior</span> <span class="o">=</span> <span class="p">[</span><span class="n">KsInitial</span><span class="p">,</span> <span class="n">ZvInitial</span><span class="p">,</span> <span class="n">ZmInitial</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="create-the-parametric-function">
<h2>Create the parametric function<a class="headerlink" href="#create-the-parametric-function" title="Permalink to this heading">¶</a></h2>
<p>In the physical model, the inputs and parameters are ordered as
presented in the next table.
Notice that there are no parameters in the physical model.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Input variable</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Q</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Ks</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Zv</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Zm</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Parameter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>∅</p></td>
<td><p>∅</p></td>
</tr>
</tbody>
</table>
<p><strong>Table 1.</strong> Indices and names of the inputs and parameters of the physical model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Physical Model Inputs:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">getInputDescription</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Physical Model Parameters:&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">getParameterDescription</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Physical Model Inputs: [Q ($m^3/s$),Ks ($m^{1/3}/s$),Zv (m),Zm (m)]
Physical Model Parameters: []
</pre></div>
</div>
<p>In order to perform calibration, we have to define a parametric model,
with observed inputs and parameters to calibrate.
In order to do this, we create a <a class="reference internal" href="../../user_manual/_generated/openturns.ParametricFunction.html#openturns.ParametricFunction" title="openturns.ParametricFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParametricFunction</span></code></a>
where the parameters are <cite>Ks</cite>, <cite>Zv</cite> and <cite>Zm</cite> which have the indices 1, 2
and 3 in the physical model.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Input variable</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Q</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Parameter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ks</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Zv</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Zm</p></td>
</tr>
</tbody>
</table>
<p><strong>Table 2.</strong> Indices and names of the inputs and parameters of the parametric model.</p>
<p>The following statement creates the calibrated function from the model.
The calibrated parameters <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAQBAMAAAAL9CkWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQI12NgYBD67MDgr8oABmwJDAyuECYDfwADSwGUXV/A0AllMsQzzIAxGZaxb4ezt57ZDGPyfr4gD2NzfGC43wBlcz1gYHsAZXMLMLB8B0p7ANn3DzAwADUXchQwMOavYWD8b8BQvxxuMAO7NIK5gAvO5uxpZwAAMp0ZVwjna2YAAAAKdEVYdERlcHRoAAAAAAO+KrC2AAAAAElFTkSuQmCC" alt="K_s" style="vertical-align: -3px"/>, <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQBAMAAADpKDJvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAbUlEQVQI12NgYPxk4vKVAQSYEhhYKsCsWQwM+w+AWRsYeL4xQMH0BVAGhyJMiDcAxhJqgDK4KhnYIKz3Dxi4wAzO3wwMpxg2cygwtDsw8GhyMzUEMNwXEY5XYJgKtAACVjEkQFlufDCjJu5jAADmYRY0Jy22YAAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="Z_v" style="vertical-align: -3px"/>, <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAQBAMAAAAPAfkrAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQI12NgYPxk4vKVAQqYEhhYKmCcWQwM+w/AOBsYeL4xIMD0BQg2hyKSBG8AEkeoAcHmqmRgg3PeP2DggrE5fzMwnOJY8kxymwMDQ7sDA48mN/+BtQwKDAz3RYTjFRjOMthxKMAUr2LQYBOAcWw4FJhfwzgXeBy41jAAAL5tGZE1SZVEAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="Z_m" style="vertical-align: -3px"/> are at
indices 1, 2, 3 in the inputs arguments of the model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">calibratedIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">mycf</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">calibratedIndices</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the Y observations versus the X observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="s2">&quot;Q ($m^3/s$)&quot;</span><span class="p">,</span> <span class="s2">&quot;H (m)&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># Plot the model before calibration</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">mycf</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">4000.0</span><span class="p">)</span><span class="o">.</span><span class="n">getDrawable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Model, before calibration&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">GetAsString</span><span class="p">(</span><span class="s2">&quot;CalibrationResult-ObservationLineStyle&quot;</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="c1"># Plot the noisy observations</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">Qobs</span><span class="p">,</span> <span class="n">Hobs</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Observations&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">GetAsString</span><span class="p">(</span><span class="s2">&quot;CalibrationResult-ObservationPointStyle&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="o">.</span><span class="n">BuildDefaultPalette</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_001.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_001.png" alt="Observations" class = "sphx-glr-single-img"/><p>Wee see that the model does not fit to the data.
The goal of calibration is to find which parameter best fit to the
observations.</p>
</section>
<section id="calibration-with-linear-least-squares">
<h2>Calibration with linear least squares<a class="headerlink" href="#calibration-with-linear-least-squares" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.LinearLeastSquaresCalibration.html#openturns.LinearLeastSquaresCalibration" title="openturns.LinearLeastSquaresCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearLeastSquaresCalibration</span></code></a> class performs the linear
least squares calibration by linearizing the model in the neighbourhood of
the reference point.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearLeastSquaresCalibration</span><span class="p">(</span><span class="n">mycf</span><span class="p">,</span> <span class="n">Qobs</span><span class="p">,</span> <span class="n">Hobs</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span> <span class="s2">&quot;SVD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.LinearLeastSquaresCalibration.html#openturns.LinearLeastSquaresCalibration.run" title="openturns.LinearLeastSquaresCalibration.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> method computes the
solution of the problem.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterMAP" title="openturns.CalibrationResult.getParameterMAP"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterMAP()</span></code></a> method returns the
maximum of the posterior distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theta After = &quot;</span><span class="p">,</span> <span class="n">thetaMAP</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theta Before = &quot;</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>theta After =  [2.94129e+09,-3.26646e+24,-3.26646e+24]
theta Before =  [20.0, 49.0, 51.0]
</pre></div>
</div>
<p>Print the true values of the parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True theta&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Ks = &quot;</span><span class="p">,</span> <span class="n">fm</span><span class="o">.</span><span class="n">trueKs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Zv = &quot;</span><span class="p">,</span> <span class="n">fm</span><span class="o">.</span><span class="n">trueZv</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Zm = &quot;</span><span class="p">,</span> <span class="n">fm</span><span class="o">.</span><span class="n">trueZm</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True theta
  Ks =  30.0
  Zv =  50.0
  Zm =  55.0
</pre></div>
</div>
<p>In this case, we see that there seems to be a great distance from the
reference value of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/> to the optimum: the values seem too large in magnitude.
As we are going to see, there is an identification problem because the
Jacobian matrix is rank-degenerate.</p>
</section>
<section id="diagnostic-of-the-identification-issue">
<h2>Diagnostic of the identification issue<a class="headerlink" href="#diagnostic-of-the-identification-issue" title="Permalink to this heading">¶</a></h2>
<p>In this section, we show how to diagnose the identification problem.</p>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterPosterior" title="openturns.CalibrationResult.getParameterPosterior"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterPosterior()</span></code></a> method returns
the posterior normal distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">distributionPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">distributionPosterior</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Normal(mu = [2.94129e+09,-3.26646e+24,-3.26646e+24], sigma = [3.03385e+28,2.38506e+34,2.38506e+34], R = [[  1           4.9106e-26 -4.9106e-26 ]
 [  4.9106e-26  1           1          ]
 [ -4.9106e-26  1           1          ]])
</pre></div>
</div>
<p>We see that there is a large covariance matrix diagonal.</p>
<p>Let us compute a 95% confidence interval for the solution <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAANBAMAAABSlfMXAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABlSURBVAjXY2BgEDJhYBBgYGBgMnBl4DAAMtwY+BgvTwaywhn6GDofMjBwvGDwY+gsZ2Bgn8CgxqDBzsDAlmw8iwEE+DYwJIEZfg0sD8CMPQzMF8AMN4aeBjCDjWE1mGbgVt8ApgH8XxDmKHijlwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">distributionPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span>
        <span class="mf">0.95</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[-6.78405e+28, 6.78405e+28]
[-5.33329e+34, 5.33329e+34]
[-5.33329e+34, 5.33329e+34]
</pre></div>
</div>
<p>The confidence interval is <em>very</em> large.
In order to clarify the situation, we compute the Jacobian matrix of the
model at the candidate point.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mycf</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="n">thetaPrior</span><span class="p">)</span>
<span class="n">thetaDim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">thetaPrior</span><span class="p">)</span>
<span class="n">jacobianMatrix</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="n">nbobs</span><span class="p">,</span> <span class="n">thetaDim</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbobs</span><span class="p">):</span>
    <span class="n">jacobianMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mycf</span><span class="o">.</span><span class="n">parameterGradient</span><span class="p">(</span><span class="n">Qobs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jacobianMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>5x3
[[ -0.0314759  0.15738   -0.15738   ]
 [ -0.0731439  0.365719  -0.365719  ]
 [ -0.104466   0.52233   -0.52233   ]
 [ -0.131005   0.655027  -0.655027  ]
 [ -0.153845   0.769225  -0.769225  ]]
</pre></div>
</div>
<p>The rank of the problem can be seen from the singular values of the Jacobian
matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jacobianMatrix</span><span class="o">.</span><span class="n">computeSingularValues</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[3.8102,5.32438e-11,3.00517e-26]
</pre></div>
</div>
<p>We can see that there are two singular values which are relatively close to zero.</p>
<p>This explains why the Jacobian matrix is close to being rank-degenerate.</p>
<p>Moreover, this allows one to compute the actual dimensionality of the problem.
The algorithm we use computes the singular values in descending order.
Moreover, by definition, the singular values are nonnegative.
We see that the first singular value is close to <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAMBAMAAAB2C0uMAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAYOlIMp0Yr8+L3XS/+7yxHmYAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABbSURBVAjXY2AQMmBgEJ0uwMDgamfAwKzAoMLAwMBnwMC1gSEGwgIiWQjLzoHBLgHMknMAcaBichCWnwHDPogsnwDDXqgpExgiQCwBBsYFIJPT+9QNGLZuF2AAABwUD0KTZvWDAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="10" style="vertical-align: 0px"/>
and the others are very close to <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMBAMAAABCcoqQAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAYJ2Lr0jpMt10v/sYz0tjMykAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABISURBVAjXY2AQMhFgYGBNYEhnYOCYwKDFwMAXwCDNwBBXwBB3gEGuAMwoADHqAhjmHWDgE2CYDVRpwKDLwMDYANLFMGmKAAMAoA0Mam7T+AEAAAAKdEVYdERlcHRoAAAAAAAnI+EMAAAAAElFTkSuQmCC" alt="0" style="vertical-align: 0px"/> in comparison.
This implies that the (numerical) rank of the Jacobian matrix is 1,
even if there are 3 parameters.</p>
<p>Hence, only one parameter can be identified, be it <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAQBAMAAAAL9CkWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQI12NgYBD67MDgr8oABmwJDAyuECYDfwADSwGUXV/A0AllMsQzzIAxGZaxb4ezt57ZDGPyfr4gD2NzfGC43wBlcz1gYHsAZXMLMLB8B0p7ANn3DzAwADUXchQwMOavYWD8b8BQvxxuMAO7NIK5gAvO5uxpZwAAMp0ZVwjna2YAAAAKdEVYdERlcHRoAAAAAAO+KrC2AAAAAElFTkSuQmCC" alt="K_s" style="vertical-align: -3px"/>, <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQBAMAAADpKDJvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAbUlEQVQI12NgYPxk4vKVAQSYEhhYKsCsWQwM+w+AWRsYeL4xQMH0BVAGhyJMiDcAxhJqgDK4KhnYIKz3Dxi4wAzO3wwMpxg2cygwtDsw8GhyMzUEMNwXEY5XYJgKtAACVjEkQFlufDCjJu5jAADmYRY0Jy22YAAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="Z_v" style="vertical-align: -3px"/>
or <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAQBAMAAAAPAfkrAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQI12NgYPxk4vKVAQqYEhhYKmCcWQwM+w/AOBsYeL4xIMD0BQg2hyKSBG8AEkeoAcHmqmRgg3PeP2DggrE5fzMwnOJY8kxymwMDQ7sDA48mN/+BtQwKDAz3RYTjFRjOMthxKMAUr2LQYBOAcWw4FJhfwzgXeBy41jAAAL5tGZE1SZVEAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="Z_m" style="vertical-align: -3px"/>.
The choice of the particular parameter to identify is free.
However, in hydraulic studies, the parameter <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAQBAMAAAAL9CkWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQI12NgYBD67MDgr8oABmwJDAyuECYDfwADSwGUXV/A0AllMsQzzIAxGZaxb4ezt57ZDGPyfr4gD2NzfGC43wBlcz1gYHsAZXMLMLB8B0p7ANn3DzAwADUXchQwMOavYWD8b8BQvxxuMAO7NIK5gAvO5uxpZwAAMp0ZVwjna2YAAAAKdEVYdERlcHRoAAAAAAO+KrC2AAAAAElFTkSuQmCC" alt="K_s" style="vertical-align: -3px"/> is classically
calibrated while <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQBAMAAADpKDJvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAbUlEQVQI12NgYPxk4vKVAQSYEhhYKsCsWQwM+w+AWRsYeL4xQMH0BVAGhyJMiDcAxhJqgDK4KhnYIKz3Dxi4wAzO3wwMpxg2cygwtDsw8GhyMzUEMNwXEY5XYJgKtAACVjEkQFlufDCjJu5jAADmYRY0Jy22YAAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="Z_v" style="vertical-align: -3px"/> and <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAQBAMAAAAPAfkrAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQI12NgYPxk4vKVAQqYEhhYKmCcWQwM+w/AOBsYeL4xIMD0BQg2hyKSBG8AEkeoAcHmqmRgg3PeP2DggrE5fzMwnOJY8kxymwMDQ7sDA48mN/+BtQwKDAz3RYTjFRjOMthxKMAUr2LQYBOAcWw4FJhfwzgXeBy41jAAAL5tGZE1SZVEAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="Z_m" style="vertical-align: -3px"/> are left constant.</p>
</section>
<section id="conclusion-of-the-linear-least-squares-calibration">
<h2>Conclusion of the linear least squares calibration<a class="headerlink" href="#conclusion-of-the-linear-least-squares-calibration" title="Permalink to this heading">¶</a></h2>
<p>There are several methods to solve the problem.</p>
<ul class="simple">
<li><p>Given that the problem is not identifiable, we can use some regularization
method. Two methods are provided in the library: the Gaussian linear least
squares <cite>GaussianLinearCalibration</cite> and the Gaussian non linear least
squares <cite>GaussianNonlinearCalibration</cite>.</p></li>
<li><p>We can change the problem, replacing it with a problem which is identifiable.
In the flooding model, we can view <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQBAMAAADpKDJvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAbUlEQVQI12NgYPxk4vKVAQSYEhhYKsCsWQwM+w+AWRsYeL4xQMH0BVAGhyJMiDcAxhJqgDK4KhnYIKz3Dxi4wAzO3wwMpxg2cygwtDsw8GhyMzUEMNwXEY5XYJgKtAACVjEkQFlufDCjJu5jAADmYRY0Jy22YAAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="Z_v" style="vertical-align: -3px"/> and <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAQBAMAAAAPAfkrAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/PPr+l0+xgynYtI3WBzLvw+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQI12NgYPxk4vKVAQqYEhhYKmCcWQwM+w/AOBsYeL4xIMD0BQg2hyKSBG8AEkeoAcHmqmRgg3PeP2DggrE5fzMwnOJY8kxymwMDQ7sDA48mN/+BtQwKDAz3RYTjFRjOMthxKMAUr2LQYBOAcWw4FJhfwzgXeBy41jAAAL5tGZE1SZVEAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="Z_m" style="vertical-align: -3px"/> as
constants and calibrate <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAQBAMAAAAL9CkWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQI12NgYBD67MDgr8oABmwJDAyuECYDfwADSwGUXV/A0AllMsQzzIAxGZaxb4ezt57ZDGPyfr4gD2NzfGC43wBlcz1gYHsAZXMLMLB8B0p7ANn3DzAwADUXchQwMOavYWD8b8BQvxxuMAO7NIK5gAvO5uxpZwAAMp0ZVwjna2YAAAAKdEVYdERlcHRoAAAAAAO+KrC2AAAAAElFTkSuQmCC" alt="K_s" style="vertical-align: -3px"/> only.</p></li>
</ul>
<p>In this example, we do not change the problem and see how the different
methods perform.</p>
</section>
<section id="calibration-with-non-linear-least-squares">
<h2>Calibration with non linear least squares<a class="headerlink" href="#calibration-with-non-linear-least-squares" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.NonLinearLeastSquaresCalibration.html#openturns.NonLinearLeastSquaresCalibration" title="openturns.NonLinearLeastSquaresCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">NonLinearLeastSquaresCalibration</span></code></a> class performs the
non linear least squares calibration by minimizing the squared Euclidian norm
between the predictions and the observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">NonLinearLeastSquaresCalibration</span><span class="p">(</span><span class="n">mycf</span><span class="p">,</span> <span class="n">Qobs</span><span class="p">,</span> <span class="n">Hobs</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.NonLinearLeastSquaresCalibration.html#openturns.NonLinearLeastSquaresCalibration.run" title="openturns.NonLinearLeastSquaresCalibration.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> method computes
the solution of the problem.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#analysis-of-the-results" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterMAP" title="openturns.CalibrationResult.getParameterMAP"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterMAP()</span></code></a> method returns the
maximum of the posterior distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">thetaMAP</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[27.566,47.0918,52.9082]
</pre></div>
</div>
<p>We can compute a 95% confidence interval of the parameter <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAANBAMAAABSlfMXAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABlSURBVAjXY2BgEDJhYBBgYGBgMnBl4DAAMtwY+BgvTwaywhn6GDofMjBwvGDwY+gsZ2Bgn8CgxqDBzsDAlmw8iwEE+DYwJIEZfg0sD8CMPQzMF8AMN4aeBjCDjWE1mGbgVt8ApgH8XxDmKHijlwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<p>This confidence interval is based on bootstrap, based on a sample size equal
to 100 (as long as the value of the <a class="reference internal" href="../../user_manual/_generated/openturns.ResourceMap.html#openturns.ResourceMap" title="openturns.ResourceMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceMap</span></code></a> key
“NonLinearLeastSquaresCalibration-BootstrapSize” is unchanged).
This confidence interval reflects the sensitivity of the optimum
to the variability in the observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">GetAsUnsignedInteger</span><span class="p">(</span>
        <span class="s2">&quot;NonLinearLeastSquaresCalibration-BootstrapSize&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thetaPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">thetaPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[27.2377, 28.1072]
[46.863, 47.2304]
[52.7696, 53.137]
</pre></div>
</div>
<p>In this case, the values of the parameters are quite accurately
computed.</p>
<p>Increase the default number of points in the plots.
This produces smoother spiky distributions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsUnsignedInteger</span><span class="p">(</span><span class="s2">&quot;Distribution-DefaultPointNumber&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_002.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_002.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>We see that there is a good fit after calibration, since the predictions after calibration
are close to the observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_003.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_003.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>We see that there is a much better fit after calibration, since the
predictions are close to the diagonal of the graphics.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">observationError</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">observationError</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Normal(mu = 0.0185511, sigma = 0.110646)
</pre></div>
</div>
<p>We can see that the observation error has a sample mean close to zero and a
sample standard deviation approximately equal to 0.11.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_number = 5</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_004.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_004.png" alt="Residual analysis" class = "sphx-glr-single-img"/><p>The analysis of the residuals shows that the distribution is centered on
zero and symmetric.
This indicates that the calibration performed well.
Moreover, the distribution of the residuals is close to being Gaussian.
This is an important hypothesis of the least squares method so that
checking that this hypothesis occurs in the study is an important
verification.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_005.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_005.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plotDistributionGridPDF</span><span class="p">(</span><span class="n">distribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the marginal and bi-dimensional iso-PDF on a grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    distribution : ot.Distribution</span>
<span class="sd">        The distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    grid : ot.GridLayout(dimension, dimension)</span>
<span class="sd">        The grid of plots.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dimension</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GridLayout</span><span class="p">(</span><span class="n">dimension</span><span class="p">,</span> <span class="n">dimension</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">distributionI</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="n">distributionI</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">distributionJI</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">([</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="n">distributionJI</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dimension</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">setXTitle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">setYTitle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">setGraph</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Iso-PDF values&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
<p>Plot the PDF values of the distribution of the optimum parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">plotDistributionGridPDF</span><span class="p">(</span><span class="n">thetaPosterior</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">grid</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plot_space</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_006.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_006.png" alt="Iso-PDF values" class = "sphx-glr-single-img"/></section>
<section id="gaussian-linear-calibration">
<h2>Gaussian linear calibration<a class="headerlink" href="#gaussian-linear-calibration" title="Permalink to this heading">¶</a></h2>
<p>The standard deviation of the observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sigmaH</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># (m^2)</span>
</pre></div>
</div>
<p>Define the covariance matrix of the output Y of the model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">errorCovariance</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">errorCovariance</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaH</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Define the covariance matrix of the parameters <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/> to calibrate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sigmaKs</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">sigmaZv</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">sigmaZm</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1">#</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaKs</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaZv</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaZm</span> <span class="o">**</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[ 25  0  0 ]
 [  0  1  0 ]
 [  0  0  1 ]]
</pre></div>
</div>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.GaussianLinearCalibration.html#openturns.GaussianLinearCalibration" title="openturns.GaussianLinearCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussianLinearCalibration</span></code></a> class performs Gaussian
linear calibration by linearizing the model in the neighbourhood of the prior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussianLinearCalibration</span><span class="p">(</span>
    <span class="n">mycf</span><span class="p">,</span> <span class="n">Qobs</span><span class="p">,</span> <span class="n">Hobs</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">errorCovariance</span><span class="p">,</span> <span class="s2">&quot;SVD&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.GaussianLinearCalibration.html#openturns.GaussianLinearCalibration.run" title="openturns.GaussianLinearCalibration.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> method computes
the solution of the problem.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>Analysis of the results<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterMAP" title="openturns.CalibrationResult.getParameterMAP"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterMAP()</span></code></a> method returns the
maximum of the posterior distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">thetaMAP</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[24.4058,48.1188,51.8812]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_007.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_007.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>We see that the output of the model after calibration is closer to the
observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_008.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_008.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>In this case, the fit is satisfactory after calibration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_009.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_009.png" alt="Residual analysis" class = "sphx-glr-single-img"/><p>We see that the distribution of the residual is centered on zero after
calibration.</p>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterPosterior" title="openturns.CalibrationResult.getParameterPosterior"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterPosterior()</span></code></a> method
returns the posterior normal distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">distributionPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">distributionPosterior</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Normal(mu = [24.4058,48.1188,51.8812], sigma = [4.09428,0.818856,0.818856], R = [[  1         0.491369 -0.491369 ]
 [  0.491369  1         0.491369 ]
 [ -0.491369  0.491369  1        ]])
</pre></div>
</div>
<p>We can compute a 95% credibility interval of the parameter <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAANBAMAAABSlfMXAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABlSURBVAjXY2BgEDJhYBBgYGBgMnBl4DAAMtwY+BgvTwaywhn6GDofMjBwvGDwY+gsZ2Bgn8CgxqDBzsDAlmw8iwEE+DYwJIEZfg0sD8CMPQzMF8AMN4aeBjCDjWE1mGbgVt8ApgH8XxDmKHijlwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">distributionPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span>
        <span class="mf">0.95</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[14.8044, 34.0072]
[46.1986, 50.0391]
[49.9609, 53.8014]
</pre></div>
</div>
<p>We see that there is a large uncertainty on the value of the parameter
<img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAQBAMAAAAL9CkWAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/dJ3dSIsYz/tgMunYU1txAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQI12NgYBD67MDgr8oABmwJDAyuECYDfwADSwGUXV/A0AllMsQzzIAxGZaxb4ezt57ZDGPyfr4gD2NzfGC43wBlcz1gYHsAZXMLMLB8B0p7ANn3DzAwADUXchQwMOavYWD8b8BQvxxuMAO7NIK5gAvO5uxpZwAAMp0ZVwjna2YAAAAKdEVYdERlcHRoAAAAAAO+KrC2AAAAAElFTkSuQmCC" alt="K_s" style="vertical-align: -3px"/> which can be as small as <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAMBAMAAAB2C0uMAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAYOlIMp0Yr8/zv4vd+w1vtygAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABHSURBVAjXY2AQMmBgYGAuYGBwtQOxOBcACT4QaweMxWwFY3FzwVgbYCxmAxiLmwHG2lVeqW4ANYUHLCYAZaX3ASWYa687AABZwhAygNu/mQAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="14" style="vertical-align: 0px"/> and as large as <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAMBAMAAACdPPCPAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAi53Pr937GOm/SDJ089M1CdcAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABnSURBVAjXY2AQVFZgYGBYwsDAIsDwCMi6CWQFMCQzMDBaAnkM7A8ZGFbNBLGYGhgYBEAsRiDByAAWYwxnWAVhMUQwCIBYzAsY5hVOcbnhxbDvAIMdUDwSaF4BexKExaCifABoWZo3ADRuFDKdkudEAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="34" style="vertical-align: 0px"/>.</p>
<p>We can compare the prior and posterior distributions of the marginals of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_010.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_010.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>The two distributions are different, which shows that the calibration is
sensitive to the observations (if the observations were not sensitive, the
two distributions were superimposed).
Moreover, the two distributions are quite close, which implies that the prior
distribution has played a role in the calibration (otherwise the two
distributions would be completely different,
indicating that only the observations were taken into account).</p>
<p>Plot the PDF values of the distribution of the optimum parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">plotDistributionGridPDF</span><span class="p">(</span><span class="n">thetaPosterior</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">grid</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plot_space</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_011.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_011.png" alt="Iso-PDF values" class = "sphx-glr-single-img"/></section>
<section id="gaussian-nonlinear-calibration">
<h2>Gaussian nonlinear calibration<a class="headerlink" href="#gaussian-nonlinear-calibration" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.GaussianNonLinearCalibration.html#openturns.GaussianNonLinearCalibration" title="openturns.GaussianNonLinearCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussianNonLinearCalibration</span></code></a> class performs Gaussian
nonlinear calibration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussianNonLinearCalibration</span><span class="p">(</span>
    <span class="n">mycf</span><span class="p">,</span> <span class="n">Qobs</span><span class="p">,</span> <span class="n">Hobs</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">errorCovariance</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.GaussianNonLinearCalibration.html#openturns.GaussianNonLinearCalibration.run" title="openturns.GaussianNonLinearCalibration.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> method computes the
solution of the problem.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>Analysis of the results<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterMAP" title="openturns.CalibrationResult.getParameterMAP"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterMAP()</span></code></a> method returns the
maximum of the posterior distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">thetaMAP</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[29.4528,47.7599,52.2401]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_012.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_012.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>We see that the output of the model after calibration is in the middle of the
observations: the calibration seems correct.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_013.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_013.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>The fit is excellent after calibration. Indeed, the cloud of points after calibration is on the diagonal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_014.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_014.png" alt="Residual analysis" class = "sphx-glr-single-img"/><p>We see that the distribution of the residual is centered on zero.
This is a proof that the calibration did perform correctly.</p>
<p>The <a class="reference internal" href="../../user_manual/_generated/openturns.CalibrationResult.html#openturns.CalibrationResult.getParameterPosterior" title="openturns.CalibrationResult.getParameterPosterior"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getParameterPosterior()</span></code></a> method
returns the posterior normal distribution of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">distributionPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
</pre></div>
</div>
<p>We can compute a 95% credibility interval of the parameter <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAANBAMAAABSlfMXAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABlSURBVAjXY2BgEDJhYBBgYGBgMnBl4DAAMtwY+BgvTwaywhn6GDofMjBwvGDwY+gsZ2Bgn8CgxqDBzsDAlmw8iwEE+DYwJIEZfg0sD8CMPQzMF8AMN4aeBjCDjWE1mGbgVt8ApgH8XxDmKHijlwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">distributionPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span>
        <span class="mf">0.95</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[29.9114, 30.9625]
[47.5676, 47.7]
[52.3, 52.4324]
</pre></div>
</div>
<p>We see that there is a small uncertainty on the value of all parameters.</p>
<p>We can compare the prior and posterior distributions of the marginals of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdIuvMt3znRjpz2D7v9Xui1gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABQSURBVAjXY2BgEDJhYGBgMnAFkm4MfEAynKGPgYHjBYMfAwP7BAY1Bga2ZONZDAx8GxiSGBj8GlgeMDDsYWC+AFLe0wCUZVgN1MStvoGBAQCe2gxuywa9BwAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_015.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_015.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>The two distributions are very different, with a spiky posterior distribution.
This shows that the calibration is very sensitive to the observations.</p>
<p>Plot the PDF values of the distribution of the optimum parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">plotDistributionGridPDF</span><span class="p">(</span><span class="n">thetaPosterior</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">grid</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plot_space</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_016.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_016.png" alt="Iso-PDF values" class = "sphx-glr-single-img"/></section>
<section id="tuning-the-posterior-distribution-estimation">
<h2>Tuning the posterior distribution estimation<a class="headerlink" href="#tuning-the-posterior-distribution-estimation" title="Permalink to this heading">¶</a></h2>
<p>The “GaussianNonLinearCalibration-BootstrapSize” key of the
<a class="reference internal" href="../../user_manual/_generated/openturns.ResourceMap.html#openturns.ResourceMap" title="openturns.ResourceMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceMap</span></code></a> controls the posterior distribution estimation.</p>
<ul class="simple">
<li><p>If “GaussianNonLinearCalibration-BootstrapSize” &gt; 0 (by default it is equal to 100),
then a bootstrap resample algorithm is used to see the dispersion of the MAP estimator.
This allows one to see the variability of the estimator with respect to
the finite noisy observation sample.</p></li>
<li><p>If “GaussianNonLinearCalibration-BootstrapSize” is zero, then the
Gaussian linear calibration estimator is used (i.e. the <a class="reference internal" href="../../user_manual/_generated/openturns.GaussianLinearCalibration.html#openturns.GaussianLinearCalibration" title="openturns.GaussianLinearCalibration"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussianLinearCalibration</span></code></a>
class) at the optimum. This is called the Laplace approximation.</p></li>
</ul>
<p>The default value of the key is nonzero, meaning that bootstrap is used.
This can be costly in some cases, because it requires to repeat the
optimization several times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">GetAsUnsignedInteger</span><span class="p">(</span><span class="s2">&quot;GaussianNonLinearCalibration-BootstrapSize&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
<p>We must configure the key before creating the object (otherwise changing
the parameter does not change the result).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsUnsignedInteger</span><span class="p">(</span><span class="s2">&quot;GaussianNonLinearCalibration-BootstrapSize&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussianNonLinearCalibration</span><span class="p">(</span>
    <span class="n">mycf</span><span class="p">,</span> <span class="n">Qobs</span><span class="p">,</span> <span class="n">Hobs</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">errorCovariance</span>
<span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_017.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_017.png" alt="plot calibration flooding" class = "sphx-glr-single-img"/><p>As we can see, this does not change much the posterior distribution, which remains spiky.</p>
<p>Plot the PDF values of the distribution of the optimum parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">plotDistributionGridPDF</span><span class="p">(</span><span class="n">thetaPosterior</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">grid</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plot_space</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">plot_space</span><span class="p">)</span>

<span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">ShowAll</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_calibration_flooding_018.png" srcset="../../_images/sphx_glr_plot_calibration_flooding_018.png" alt="Iso-PDF values" class = "sphx-glr-single-img"/><p>Reset default settings</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">Reload</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  8.891 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-calibration-least-squares-and-gaussian-calibration-plot-calibration-flooding-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/6caf8ab6cf6fefe73b8f4c85fd8eff29/plot_calibration_flooding.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_calibration_flooding.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/629c52e2da312a64d768ebe2e0d766e5/plot_calibration_flooding.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_calibration_flooding.ipynb</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_calibration_chaboche.html" title="Calibration of the Chaboche mechanical model"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_calibration_deflection_tube.html" title="Calibration of the deflection of a tube"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.22dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Calibration</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Least squares and gaussian calibration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Calibration of the flooding model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 01, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>