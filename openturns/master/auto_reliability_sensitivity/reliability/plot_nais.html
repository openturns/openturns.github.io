
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Non parametric Adaptive Importance Sampling (NAIS) &#8212; OpenTURNS 1.20dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Create a domain event" href="plot_create_domain_event.html" />
    <link rel="prev" title="Use the FORM algorithm in case of several design points" href="plot_multi_form.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_create_domain_event.html" title="Create a domain event"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_multi_form.html" title="Use the FORM algorithm in case of several design points"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Reliability &amp; Sensitivity</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Reliability</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Non parametric Adaptive Importance Sampling (NAIS)</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Non parametric Adaptive Importance Sampling (NAIS)</a><ul>
<li><a class="reference internal" href="#create-the-probabilistic-model-y-g-vect-x">Create the probabilistic model <img class="math" src="../../_images/math/24fa7d24f798cd0f18f836f5860358fa7888faf3.svg" alt="Y = g(\vect{X})"/></a></li>
<li><a class="reference internal" href="#create-the-event-y-g-vect-x-leq-0">Create the event <img class="math" src="../../_images/math/d9e6b2a29b9ba0d72f0dc7b1d7e38fb723ecf00c.svg" alt="\{ Y = g(\vect{X}) \leq 0 \}"/></a></li>
<li><a class="reference internal" href="#evaluate-the-probability-with-the-nais-technique">Evaluate the probability with the NAIS technique</a></li>
<li><a class="reference internal" href="#draw-the-nais-samples-used-by-the-algorithm">Draw the NAIS samples used by the algorithm</a></li>
<li><a class="reference internal" href="#draw-the-frontiers-only">Draw the frontiers only</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_multi_form.html"
                          title="previous chapter">Use the FORM algorithm in case of several design points</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_create_domain_event.html"
                          title="next chapter">Create a domain event</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_reliability_sensitivity/reliability/plot_nais.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-reliability-sensitivity-reliability-plot-nais-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="non-parametric-adaptive-importance-sampling-nais">
<span id="sphx-glr-auto-reliability-sensitivity-reliability-plot-nais-py"></span><h1>Non parametric Adaptive Importance Sampling (NAIS)<a class="headerlink" href="#non-parametric-adaptive-importance-sampling-nais" title="Permalink to this heading">¶</a></h1>
<p>The objective is to evaluate a probability from the Non parametric Adaptive Importance Sampling (NAIS) technique.</p>
<p>We consider the four-branch function <img class="math" src="../../_images/math/d030aa6ccdeefba50c4009c2ec4186a44f8ae882.svg" alt="g : \mathbb{R}^2 \rightarrow \mathbb{R}"/> defined by:</p>
<div class="math">
<p><img src="../../_images/math/981a6c8ca7aa5f7dd5dd5d6f082d8248b22f662c.svg" alt="\begin{align*}
g(\vect{X}) = \min \begin{pmatrix}5+0.1(x_1-x_2)^2-\frac{(x_1+x_2)}{\sqrt{2}}\\
5+0.1(x_1-x_2)^2+\frac{(x_1+x_2)}{\sqrt{2}}\\
(x_1-x_2)+ \frac{9}{\sqrt{2}}\\
(x_2-x_1)+ \frac{9}{\sqrt{2}}
\end{pmatrix}
\end{align*}"/></p>
</div><p>and the input random vector <img class="math" src="../../_images/math/bd84177dda504a60c9499dd868ea97b38d5a1481.svg" alt="\vect{X} = (X_1, X_2)"/> which follows the standard 2-dimensional Normal distribution:</p>
<div class="math">
<p><img src="../../_images/math/d83cde10e0a4552637e52ca6f13d016baeb2601c.svg" alt="\begin{align*}
\vect{X} \sim  \mathcal{N}(\mu = [0, 0], \sigma = [1,1], corr = \mat{I}_2)
\end{align*}"/></p>
</div><p>We want to evaluate the probability:</p>
<div class="math">
<p><img src="../../_images/math/39b318ade449f866e11c407efd609c708ae6dfbd.svg" alt="\begin{align*}
p = \mathbb{P} ( g(\vect{X}) \leq 0 )
\end{align*}"/></p>
</div><p>First, import the python modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">from</span> <span class="nn">openturns.viewer</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
<section id="create-the-probabilistic-model-y-g-vect-x">
<h2>Create the probabilistic model <img class="math" src="../../_images/math/24fa7d24f798cd0f18f836f5860358fa7888faf3.svg" alt="Y = g(\vect{X})"/><a class="headerlink" href="#create-the-probabilistic-model-y-g-vect-x" title="Permalink to this heading">¶</a></h2>
<p>Create the input random vector <img class="math" src="../../_images/math/2bcbd5b2b78ef65f3c1a1987095a65863870aa77.svg" alt="\vect{X}"/>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">RandomVector</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Create the function <img class="math" src="../../_images/math/658ae44ee69111e3048325f416f44d6080707928.svg" alt="g"/> from a <a class="reference internal" href="../../user_manual/_generated/openturns.PythonFunction.html#openturns.PythonFunction" title="openturns.PythonFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonFunction</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fourBranch</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">g1</span> <span class="o">=</span> <span class="mi">5</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="n">x1</span><span class="o">+</span><span class="n">x2</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="mi">5</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">x1</span><span class="o">+</span><span class="n">x2</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">g3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="mi">9</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">g4</span> <span class="o">=</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="mi">9</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="nb">min</span><span class="p">((</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">g3</span><span class="p">,</span><span class="n">g4</span><span class="p">))]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">fourBranch</span><span class="p">)</span>
</pre></div>
</div>
<p>Draw the function <img class="math" src="../../_images/math/658ae44ee69111e3048325f416f44d6080707928.svg" alt="g"/> to help to understand the shape of the limit state function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s1">&#39;Four Branch function&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;topright&#39;</span><span class="p">)</span>
<span class="n">drawfunction</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">draw</span><span class="p">([</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,[</span><span class="mi">8</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,[</span><span class="mi">100</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">drawfunction</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_nais_001.png" srcset="../../_images/sphx_glr_plot_nais_001.png" alt="Four Branch function" class = "sphx-glr-single-img"/><p>In order to be able to get the NAIS samples used in the algorithm, it is necessary to transform the <a class="reference internal" href="../../user_manual/_generated/openturns.PythonFunction.html#openturns.PythonFunction" title="openturns.PythonFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonFunction</span></code></a> into a <a class="reference internal" href="../../user_manual/_generated/openturns.MemoizeFunction.html#openturns.MemoizeFunction" title="openturns.MemoizeFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoizeFunction</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MemoizeFunction</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
<p>Create the output random vector <img class="math" src="../../_images/math/24fa7d24f798cd0f18f836f5860358fa7888faf3.svg" alt="Y = g(\vect{X})"/>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CompositeRandomVector</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-the-event-y-g-vect-x-leq-0">
<h2>Create the event <img class="math" src="../../_images/math/d9e6b2a29b9ba0d72f0dc7b1d7e38fb723ecf00c.svg" alt="\{ Y = g(\vect{X}) \leq 0 \}"/><a class="headerlink" href="#create-the-event-y-g-vect-x-leq-0" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">myEvent</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ThresholdEvent</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">ot</span><span class="o">.</span><span class="n">Less</span><span class="p">(),</span> <span class="n">threshold</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="evaluate-the-probability-with-the-nais-technique">
<h2>Evaluate the probability with the NAIS technique<a class="headerlink" href="#evaluate-the-probability-with-the-nais-technique" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rhoQuantile</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">NAIS</span><span class="p">(</span><span class="n">myEvent</span><span class="p">,</span><span class="n">rhoQuantile</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you can run the algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">proba</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getProbabilityEstimate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Proba NAIS = &#39;</span><span class="p">,</span>  <span class="n">proba</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current coefficient of variation = &#39;</span><span class="p">,</span>
      <span class="n">result</span><span class="o">.</span><span class="n">getCoefficientOfVariation</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Proba NAIS =  7.021998687102318e-06
Current coefficient of variation =  0.10101452954018557
</pre></div>
</div>
<p>The length of the confidence interval of level <img class="math" src="../../_images/math/af5b302a8efbd76e3ad008f98b7af1dce9a7862d.svg" alt="95\%"/> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">length95</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getConfidenceLength</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confidence length (0.95) = &#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">getConfidenceLength</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Confidence length (0.95) =  2.7804985704804375e-06
</pre></div>
</div>
<p>which enables to build the confidence interval:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confidence interval (0.95) = [&#39;</span><span class="p">,</span> <span class="n">proba</span> <span class="o">-</span>
      <span class="n">length95</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">proba</span> <span class="o">+</span> <span class="n">length95</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Confidence interval (0.95) = [ 5.6317494018621e-06 ,  8.412247972342536e-06 ]
</pre></div>
</div>
</section>
<section id="draw-the-nais-samples-used-by-the-algorithm">
<h2>Draw the NAIS samples used by the algorithm<a class="headerlink" href="#draw-the-nais-samples-used-by-the-algorithm" title="Permalink to this heading">¶</a></h2>
<p>The following manipulations are possible only if you have created a <a class="reference internal" href="../../user_manual/_generated/openturns.MemoizeFunction.html#openturns.MemoizeFunction" title="openturns.MemoizeFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoizeFunction</span></code></a> that enables to store all the inputs and outputs of the function <img class="math" src="../../_images/math/658ae44ee69111e3048325f416f44d6080707928.svg" alt="g"/>.</p>
<p>Get all the inputs and outputs where <img class="math" src="../../_images/math/658ae44ee69111e3048325f416f44d6080707928.svg" alt="g"/> were evaluated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inputNAIS</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getInputHistory</span><span class="p">()</span>
<span class="n">outputNAIS</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getOutputHistory</span><span class="p">()</span>
<span class="n">nTotal</span> <span class="o">=</span> <span class="n">inputNAIS</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of evaluations of g = &#39;</span><span class="p">,</span> <span class="n">nTotal</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Number of evaluations of g =  4000
</pre></div>
</div>
<p>Within each step of the algorithm, a sample of size <img class="math" src="../../_images/math/6bed8a44f63e1eb8e61608a5c93374a505943eec.svg" alt="N"/> is created, where:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getMaximumOuterSampling</span><span class="p">()</span><span class="o">*</span><span class="n">algo</span><span class="o">.</span><span class="n">getBlockSize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Size of each subset = &#39;</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Size of each subset =  1000
</pre></div>
</div>
<p>You can get the number <img class="math" src="../../_images/math/10e591697956b926686ed7684a7638ebadbf2434.svg" alt="N_s"/> of steps with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ns</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="n">nTotal</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of steps = &#39;</span><span class="p">,</span> <span class="n">Ns</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Number of steps =  4
</pre></div>
</div>
<p>Now, we can split the initial sample into NAIS samples of size <img class="math" src="../../_images/math/10e591697956b926686ed7684a7638ebadbf2434.svg" alt="N_s"/>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">listNAISSamples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">listOutputNAISSamples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
    <span class="n">listNAISSamples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputNAIS</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="n">N</span> <span class="o">+</span> <span class="n">N</span><span class="p">])</span>
    <span class="n">listOutputNAISSamples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputNAIS</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="n">N</span> <span class="o">+</span> <span class="n">N</span><span class="p">])</span>
</pre></div>
</div>
<p>And get all the levels defining the intermediate and final thresholds given by the empirical quantiles of each NAIS output sample:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">levels</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Point</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">levels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">listOutputNAISSamples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">computeQuantile</span><span class="p">(</span><span class="n">rhoQuantile</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">levels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</pre></div>
</div>
<p>The following graph draws each NAIS sample and the frontier <img class="math" src="../../_images/math/f3ea213950f76b622c00586f3505236940dc2248.svg" alt="g(x_1, x_2) = l_i"/> where <img class="math" src="../../_images/math/b41d7b07e1ad3fa3bebf65540b3a42e70081dd8c.svg" alt="l_i"/> is the threshold at the step <img class="math" src="../../_images/math/bc9e0812a00024d261751577fdd3d3b800392b97.svg" alt="i"/>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s1">&#39;NAIS samples&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;bottomleft&#39;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setGrid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Add all the NAIS samples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">listNAISSamples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="p">()</span><span class="o">.</span><span class="n">BuildDefaultPalette</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
<p>Add the frontiers <img class="math" src="../../_images/math/f3ea213950f76b622c00586f3505236940dc2248.svg" alt="g(x_1, x_2) = l_i"/> where <img class="math" src="../../_images/math/b41d7b07e1ad3fa3bebf65540b3a42e70081dd8c.svg" alt="l_i"/> is the threshold at the step <img class="math" src="../../_images/math/bc9e0812a00024d261751577fdd3d3b800392b97.svg" alt="i"/>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gIsoLines</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">draw</span><span class="p">([</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">128</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">gIsoLines</span><span class="o">.</span><span class="n">getDrawable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="o">.</span><span class="n">getSize</span><span class="p">()):</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLevels</span><span class="p">([</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s1">&#39;solid&#39;</span><span class="p">)</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$g(X) = $&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_nais_002.png" srcset="../../_images/sphx_glr_plot_nais_002.png" alt="NAIS samples" class = "sphx-glr-single-img"/></section>
<section id="draw-the-frontiers-only">
<h2>Draw the frontiers only<a class="headerlink" href="#draw-the-frontiers-only" title="Permalink to this heading">¶</a></h2>
<p>The following graph enables to understand the progression of the algorithm from the mean value of the initial distribution to the limit state function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s1">&#39;NAIS thresholds&#39;</span><span class="p">,</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;bottomleft&#39;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setGrid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">gIsoLines</span><span class="o">.</span><span class="n">getDrawable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="o">.</span><span class="n">getSize</span><span class="p">()):</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLevels</span><span class="p">([</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s1">&#39;solid&#39;</span><span class="p">)</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$g(X) = $&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span>

<span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_nais_003.png" srcset="../../_images/sphx_glr_plot_nais_003.png" alt="NAIS thresholds" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.492 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-reliability-sensitivity-reliability-plot-nais-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/f6ae28c1a237f6decc9385265d5edc53/plot_nais.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_nais.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/22f8ab9d416a8b8e143fbc52b064158d/plot_nais.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_nais.ipynb</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_create_domain_event.html" title="Create a domain event"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_multi_form.html" title="Use the FORM algorithm in case of several design points"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Reliability &amp; Sensitivity</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Reliability</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Non parametric Adaptive Importance Sampling (NAIS)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 01, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3.
    </div>
  </body>
</html>