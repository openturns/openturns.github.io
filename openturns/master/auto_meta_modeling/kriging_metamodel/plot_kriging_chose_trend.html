
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Kriging : choose a trend vector space &#8212; OpenTURNS 1.20dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Kriging : draw covariance models" href="plot_draw_covariance_models.html" />
    <link rel="prev" title="Kriging :configure the optimization solver" href="plot_kriging_hyperparameters_optimization.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_draw_covariance_models.html" title="Kriging : draw covariance models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_kriging_hyperparameters_optimization.html" title="Kriging :configure the optimization solver"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Kriging metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Kriging : choose a trend vector space</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Kriging : choose a trend vector space</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#a-constant-basis">A constant basis</a></li>
<li><a class="reference internal" href="#linear-basis">Linear basis</a></li>
<li><a class="reference internal" href="#quadratic-basis">Quadratic basis</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_kriging_hyperparameters_optimization.html"
                          title="previous chapter">Kriging :configure the optimization solver</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_draw_covariance_models.html"
                          title="next chapter">Kriging : draw covariance models</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/kriging_metamodel/plot_kriging_chose_trend.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-kriging-metamodel-plot-kriging-chose-trend-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="kriging-choose-a-trend-vector-space">
<span id="sphx-glr-auto-meta-modeling-kriging-metamodel-plot-kriging-chose-trend-py"></span><h1>Kriging : choose a trend vector space<a class="headerlink" href="#kriging-choose-a-trend-vector-space" title="Permalink to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>In this example we present the basic trends which we may use in the kriging metamodel procedure :</p>
<blockquote>
<div><ul class="simple">
<li><p>ConstantBasis ;</p></li>
<li><p>LinearBasis ;</p></li>
<li><p>QuadraticBasis ;</p></li>
</ul>
</div></blockquote>
<p>The model is the simple real function defined by</p>
<div class="math">
<p><img src="../../_images/math/c59002c75275367c150a5eb8693b34c6a8330925.svg" alt="f : x \mapsto x \left( \sin \frac{x}{2} \right)"/></p>
</div><p>which we study on the <img class="math" src="../../_images/math/4931a19658d7e6ae1356fbd48d2796aa96cea88c.svg" alt="[0,10]"/> interval.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The focus being on the trend we assume a given squared exponential covariance kernel :</p>
<div class="math">
<p><img src="../../_images/math/b4bf6d91a480dc38ddfc81a62863959e1e6bf02e.svg" alt="C_{\theta}(s,t) = \sigma^2 e^{ - \frac{(t-s)^2}{2\rho^2} }"/></p>
</div><p>where <img class="math" src="../../_images/math/952ea42075145ad97f688b05f4e0f8d2bc1b9538.svg" alt="\theta = (\sigma, \rho)"/> is the hyperparameters vectors. The nature of the covariance
model is fixed but its parameters are calibrated during the kriging process. We want to choose them
so as to best fit our data.</p>
<p>Eventually the kriging (meta)model <img class="math" src="../../_images/math/f1c4a94b1a15e4ef139bca3c57d07b3cee73c629.svg" alt="\hat{Y}(x)"/> reads as</p>
<div class="math">
<p><img src="../../_images/math/6d3bea6baed2d763e46ef42d6df8243f6a6356ca.svg" alt="\hat{Y}(x) = m(x) + Z(x)"/></p>
</div><p>where <img class="math" src="../../_images/math/71be5d9d0a017481d63ab2582d3b0b2a7ad4d21c.svg" alt="m(.)"/> is the trend and <img class="math" src="../../_images/math/6e4e1c5b8ab258287b0ad2bf443d3d43c84cdd1c.svg" alt="Z(.)"/> is a gaussian process with zero-mean and its covariance matrix is <img class="math" src="../../_images/math/b37dc2cb8e8c7d8d2f85e0e7fc9e45dfedb80cff.svg" alt="C_{\theta}(s,t)"/>. The trend is deterministic and the gaussian process is probabilistc but they both contribute to the metamodel.
A special feature of the kriging is the interpolation property : the metamodel is exact at the
trainig data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
</pre></div>
</div>
<p>We define our exact model with a <cite>SymbolicFunction</cite> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;x*sin(0.5*x)&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>We use the following sample to train our metamodel :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nTrain</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Xtrain</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.6</span><span class="p">],</span> <span class="p">[</span><span class="mf">8.9</span><span class="p">]])</span>
</pre></div>
</div>
<p>The values of the exact model are also needed for training :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ytrain</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">)</span>
</pre></div>
</div>
<p>We shall test the model on a set of points and use a regular grid for this matter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nTest</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">RegularGrid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">nTest</span><span class="p">)</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()</span>
</pre></div>
</div>
<p>We draw the training points and the model at the testing points. We encapsulate it into a function to use it again later.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_exact_model</span><span class="p">():</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
    <span class="n">curveModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="n">curveModel</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;solid&quot;</span><span class="p">)</span>
    <span class="n">curveModel</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curveModel</span><span class="p">)</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">)</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="s2">&quot;fsquare&quot;</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">plot_exact_model</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging : exact model&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_001.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_001.png" alt="1D Kriging : exact model" class = "sphx-glr-single-img"/><p>A common pre-processing step is to apply a transform on the input data before performing the kriging.
To do so we write a linear transform of our input data : we make it unit centered at its mean. Then we fix the mean and the standard deviation to their values with the <cite>ParametricFunction</cite>. We build the inverse transform as well.</p>
<p>We first compute the mean and standard deviation of the input data :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">Xtrain</span><span class="o">.</span><span class="n">computeMean</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">stdDev</span> <span class="o">=</span> <span class="n">Xtrain</span><span class="o">.</span><span class="n">computeStandardDeviation</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Xtrain, mean : </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mean</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Xtrain, standard deviation : </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stdDev</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Xtrain, mean : 3.740
Xtrain, standard deviation : 3.476
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tf</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;(x-mu)/sigma&#39;</span><span class="p">])</span>
<span class="n">itf</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;sigma*x+mu&#39;</span><span class="p">])</span>
<span class="n">myInverseTransform</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">itf</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">stdDev</span><span class="p">])</span>
<span class="n">myTransform</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">stdDev</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="a-constant-basis">
<h2>A constant basis<a class="headerlink" href="#a-constant-basis" title="Permalink to this heading">¶</a></h2>
<p>In this paragraph we choose a basis constant for the kriging. There is only one unknown which is the
value of the constant. The basis is built with the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.ConstantBasisFactory.html#openturns.ConstantBasisFactory" title="openturns.ConstantBasisFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConstantBasisFactory</span></code></a> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ConstantBasisFactory</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>We build the kriging algorithm by giving it the transformed data, the output data, the covariance
model and the basis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">myTransform</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">),</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
<p>We can run the algorithm and store the result :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<p>The metamodel is the following <a class="reference internal" href="../../user_manual/_generated/openturns.ComposedFunction.html#openturns.ComposedFunction" title="openturns.ComposedFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">ComposedFunction</span></code></a> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metamodel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedFunction</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">(),</span> <span class="n">myTransform</span><span class="p">)</span>
</pre></div>
</div>
<p>We can draw the metamodel and the exact model on the same graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">plot_exact_model</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">metamodel</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span> <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging : exact model and metamodel&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_002.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_002.png" alt="1D Kriging : exact model and metamodel" class = "sphx-glr-single-img"/><p>We can retrieve the calibrated trend coefficient :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c0</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getTrendCoefficients</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The trend is the curve m(x) = </span><span class="si">%.6e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>The trend is the curve m(x) = -2.596622e+00
</pre></div>
</div>
<p>We also pay attention to the trained covariance model and observe the values
of the hyperparameters :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span><span class="o">.</span><span class="n">getScale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scale parameter : </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">)</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span><span class="o">.</span><span class="n">getAmplitude</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Amplitude parameter : </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Scale parameter : 9.060e-01
Amplitude parameter : 5.942e+00
</pre></div>
</div>
<p>We build the trend from the coefficient :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">constantTrend</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="n">myTrend</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">constantTrend</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<p>We draw the trend found by the kriging procedure :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span> <span class="o">=</span> <span class="n">myTrend</span><span class="p">(</span><span class="n">myTransform</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;dotdash&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">,</span> <span class="s1">&#39;constant trend&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging with a constant trend&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_003.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_003.png" alt="1D Kriging with a constant trend" class = "sphx-glr-single-img"/><p>We create a small function returning bounds of the 68% confidence interval <img class="math" src="../../_images/math/06ee4d1e4747d2b940b77608f18fe6940770fb68.svg" alt="[-sigma,sigma]"/> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_ICBounds</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nTest</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="n">vUp</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x_test</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTest</span><span class="p">)]</span>
    <span class="n">vLow</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x_test</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sigma</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTest</span><span class="p">)]</span>
    <span class="n">polyData</span> <span class="o">=</span> <span class="p">[[</span><span class="n">vLow</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">vLow</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">vUp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">vUp</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTest</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">polygonList</span> <span class="o">=</span> <span class="p">[</span><span class="n">ot</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">polyData</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="s2">&quot;grey&quot;</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTest</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">boundsPoly</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PolygonArray</span><span class="p">(</span><span class="n">polygonList</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">boundsPoly</span>
</pre></div>
</div>
<p>We now draw it :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">boundsPoly</span> <span class="o">=</span> <span class="n">plot_ICBounds</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nTest</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">boundsPoly</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span> <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;constant trend&#39;</span><span class="p">,</span> <span class="s1">&#39;68</span><span class="si">% - c</span><span class="s1">onfidence interval&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging with a constant trend&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_004.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_004.png" alt="1D Kriging with a constant trend" class = "sphx-glr-single-img"/><p>As expected with a constant basis, the trend obtained is an horizontal line amidst data points.
The main idea is that at any point <img class="math" src="../../_images/math/465ca6ac10519324f8a5d51b6e4485f9833730a6.svg" alt="x_0"/>, the gaussian term <img class="math" src="../../_images/math/5d5833252521d47e9807e9ae6c339e3df9ce2678.svg" alt="Z(x_0)"/> helps to find a
good value of <img class="math" src="../../_images/math/879dc4a2275a01a23ff97eee365d278c829eadce.svg" alt="\hat{Y}(x_0)"/> thanks to the high value of the amplitude <img class="math" src="../../_images/math/c407acdc527ca1937ae333fa8475cb95384c8087.svg" alt="\sigma"/>
(<img class="math" src="../../_images/math/1e0f98b45552eccc7ca57c12aeb9c6d422391827.svg" alt="\sigma \approx 6.359"/>) far away from the mean <img class="math" src="../../_images/math/965f09870698cf425aa09d896b5c250679840343.svg" alt="m(x)"/>. As a consequence the 68%
confidence interval is wide.</p>
</section>
<section id="linear-basis">
<h2>Linear basis<a class="headerlink" href="#linear-basis" title="Permalink to this heading">¶</a></h2>
<p>With a linear basis, the vector space is defined by the basis <img class="math" src="../../_images/math/611f52c14dfd36b520b7065cdd210f0545c7125e.svg" alt="\{1, X\}"/> : that is
all the lines of the form <img class="math" src="../../_images/math/8c8ab100d2fed2e2d30ce4bafaa6c3f663889593.svg" alt="y(X) = aX + b"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearBasisFactory</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>We run the kriging analysis and store the result :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">myTransform</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">),</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">metamodel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedFunction</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">(),</span> <span class="n">myTransform</span><span class="p">)</span>
</pre></div>
</div>
<p>We can draw the metamodel and the exact model on the same graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">plot_exact_model</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">metamodel</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span> <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging : exact model and metamodel&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_005.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_005.png" alt="1D Kriging : exact model and metamodel" class = "sphx-glr-single-img"/><p>We can retrieve the calibrated trend coefficients with <cite>getTrendCoefficients</cite> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c0</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getTrendCoefficients</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trend is the curve m(X) = </span><span class="si">%.6e</span><span class="s2"> X + </span><span class="si">%.6e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Trend is the curve m(X) = -3.855374e+00 X + -1.953373e+00
</pre></div>
</div>
<p>We also pay attention to the trained covariance model and observe the values
of the hyperparameters :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span><span class="o">.</span><span class="n">getScale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scale parameter : </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">)</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span><span class="o">.</span><span class="n">getAmplitude</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Amplitude parameter : </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Scale parameter : 8.942e-01
Amplitude parameter : 5.174e+00
</pre></div>
</div>
<p>We draw the linear trend that we are interested in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">linearTrend</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a*x+b&#39;</span><span class="p">])</span>
<span class="n">myTrend</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">linearTrend</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">myTrend</span><span class="p">(</span><span class="n">myTransform</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;dotdash&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">,</span> <span class="s1">&#39;linear trend&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging with a linear trend&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_006.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_006.png" alt="1D Kriging with a linear trend" class = "sphx-glr-single-img"/><p>The same graphic with the 68% confidence interval :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">boundsPoly</span> <span class="o">=</span> <span class="n">plot_ICBounds</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nTest</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">boundsPoly</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span> <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;linear trend&#39;</span><span class="p">,</span> <span class="s1">&#39;68</span><span class="si">% - c</span><span class="s1">onfidence interval&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging with a linear trend&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_007.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_007.png" alt="1D Kriging with a linear trend" class = "sphx-glr-single-img"/><p>The trend obtained is decreasing on the interval of study : that is the general trend we observe
from the exact model. It is still nowhere close to the exact model but as in the constant case the
gaussian part will do the job of building a correct (visually at least) metamodel.
We note that the values of the amplitude and the scale parameters are similar to the previous constant case. As it can be seen on the previous figure the metamodel is interpolating (see the last data point).</p>
</section>
<section id="quadratic-basis">
<h2>Quadratic basis<a class="headerlink" href="#quadratic-basis" title="Permalink to this heading">¶</a></h2>
<p>In this last paragraph we turn to the quadratic basis. All subsequent analysis should remain the same.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">QuadraticBasisFactory</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>We run the kriging analysis and store the result :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">myTransform</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">),</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">metamodel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedFunction</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">(),</span> <span class="n">myTransform</span><span class="p">)</span>
</pre></div>
</div>
<p>We can draw the metamodel and the exact model on the same graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">plot_exact_model</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">metamodel</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span> <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging : exact model and metamodel&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_008.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_008.png" alt="1D Kriging : exact model and metamodel" class = "sphx-glr-single-img"/><p>We can retrieve the calibrated trend coefficients with <cite>getTrendCoefficients</cite> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c0</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getTrendCoefficients</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trend is the curve m(X) = </span><span class="si">%.6e</span><span class="s2"> X**2 + </span><span class="si">%.6e</span><span class="s2"> X + </span><span class="si">%.6e</span><span class="s2">&quot;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Trend is the curve m(X) = -4.804137e+00 X**2 + -6.654850e-01 X + 3.128888e+00
</pre></div>
</div>
<p>We also pay attention to the trained covariance model and observe the values
of the hyperparameters :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span><span class="o">.</span><span class="n">getScale</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scale parameter : </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rho</span><span class="p">)</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span><span class="o">.</span><span class="n">getAmplitude</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Amplitude parameter : </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Scale parameter : 1.000e-02
Amplitude parameter : 6.843e-01
</pre></div>
</div>
<p>The quadratic linear trend obtained is :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">quadraticTrend</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a*x^2 + b*x + c&#39;</span><span class="p">])</span>
<span class="n">myTrend</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">quadraticTrend</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span>
                                <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<p>In this case we restrict ourselves to the <img class="math" src="../../_images/math/4fa40b6aa6ddda3095ec2688df5a1418f6a2f102.svg" alt="[0,6] \times [-2.5,4]"/> for visualization.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span> <span class="o">=</span> <span class="n">myTrend</span><span class="p">(</span><span class="n">myTransform</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="s2">&quot;dotdash&quot;</span><span class="p">)</span>
<span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">,</span> <span class="s1">&#39;quadratic trend&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging with a quadratic trend&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">getAxes</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_009.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_009.png" alt="1D Kriging with a quadratic trend" class = "sphx-glr-single-img"/><p>sphinx_gallery_thumbnail_number = 10
The same graphic with the 68% confidence interval.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">boundsPoly</span> <span class="o">=</span> <span class="n">plot_ICBounds</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">nTest</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">boundsPoly</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s1">&#39;exact model&#39;</span><span class="p">,</span> <span class="s1">&#39;training data&#39;</span><span class="p">,</span> <span class="s1">&#39;kriging metamodel&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;quadratic trend&#39;</span><span class="p">,</span> <span class="s1">&#39;68</span><span class="si">% - c</span><span class="s1">onfidence interval&#39;</span><span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s1">&#39;1D Kriging with a quadratic trend&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">getAxes</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_kriging_chose_trend_010.png" srcset="../../_images/sphx_glr_plot_kriging_chose_trend_010.png" alt="1D Kriging with a quadratic trend" class = "sphx-glr-single-img"/><p>In this case the analysis is interesting to understand the general behaviour of the kriging process.</p>
<p>From the previous figure we feel that the metamodel is mostly characterized by the trend which is a
good approximate of the exact solution over the interval.
However, to a certain extent, we have lost flexibility by having a too good and rigid trend as we
still have to impose the interpolation property.</p>
<p>We see that the gap between the trend and the exact model is small and the amplitude of the gaussian
process is small as well : <img class="math" src="../../_images/math/06dd9c6288050493f459daa24fc9696d30c4d1aa.svg" alt="\sigma \approx 0.684"/>. Then the confidence interval is more
narrow than before. The scale parameter is small, <img class="math" src="../../_images/math/f87638b8bb24395d8c2ea097e953f8c04bf72090.svg" alt="\rho \approx 0.010"/>, meaning that two
distant points are rapidly independent. The only way to set the interpolation property is to create
small peaks (see the figure). The sad conclusion is that the metamodel loses its smoothness.</p>
<p>In that case one should use a constant or linear basis even if a quadratic trend seems right.</p>
<p>Display figures</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.833 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-kriging-metamodel-plot-kriging-chose-trend-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/84722784f02c1b0fd5811b6c424fc071/plot_kriging_chose_trend.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_kriging_chose_trend.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9addcae1e9959941d5f0d64ff19fe3c5/plot_kriging_chose_trend.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_kriging_chose_trend.ipynb</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_draw_covariance_models.html" title="Kriging : draw covariance models"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_kriging_hyperparameters_optimization.html" title="Kriging :configure the optimization solver"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Kriging metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Kriging : choose a trend vector space</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 01, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>