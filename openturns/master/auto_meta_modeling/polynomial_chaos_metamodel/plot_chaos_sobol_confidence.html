
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Compute Sobol’ indices confidence intervals &#8212; OpenTURNS 1.23dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Kriging metamodel" href="../kriging_metamodel/index.html" />
    <link rel="prev" title="Create a sparse chaos by integration" href="plot_chaos_cleaning_strategy.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../kriging_metamodel/index.html" title="Kriging metamodel"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_chaos_cleaning_strategy.html" title="Create a sparse chaos by integration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.23dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Polynomial chaos metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Compute Sobol’ indices confidence intervals</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_chaos_cleaning_strategy.html"
                          title="previous chapter">Create a sparse chaos by integration</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../kriging_metamodel/index.html"
                          title="next chapter">Kriging metamodel</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/polynomial_chaos_metamodel/plot_chaos_sobol_confidence.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-sobol-confidence-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="compute-sobol-indices-confidence-intervals">
<span id="sphx-glr-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-sobol-confidence-py"></span><h1>Compute Sobol’ indices confidence intervals<a class="headerlink" href="#compute-sobol-indices-confidence-intervals" title="Permalink to this heading">¶</a></h1>
<p>In this example we will estimate confidence intervals for chaos Sobol’ indices by bootstrap.
Unlike estimation by sampling where the confidence intervals are obtained from the asymptotic distributions,
there is currently no known analytical method to compute Sobol’ confidence intervals,
so we can fallback to bootstrap.</p>
<p>Bootstraping the polynomial chaos is presented in <a class="reference internal" href="../../bibliography.html#marelli2018" id="id1"><span>[marelli2018]</span></a> as “full bootstraping”
and referred to as bootstrap-PCE or bPCE.
Full bPCE can be CPU time consuming in some cases, e.g. when the dimension of the input
random vector is large or when the training sample size is large.
In the fast bPCE method, the sparse polynomial basis identified by the LARS algorithm
is computed only once.
Then bootstrapping is applied to the regression step on the sparse basis.
Using fast bPCE is not straightforward, so we use full bPCE in the current example.</p>
<p>To do this, we must simultaneously bootstrap in the input and output samples, so that the
input/output mapping is preserved.
In the example below, we show how to use the <a class="reference internal" href="../../user_manual/_generated/openturns.BootstrapExperiment.html#openturns.BootstrapExperiment" title="openturns.BootstrapExperiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">BootstrapExperiment</span></code></a> class for this purpose.</p>
<p>This involves the following steps:</p>
<ul class="simple">
<li><p>Generate an initial input/output design of experiment.</p></li>
<li><p>Compute a fixed number of bootstrap samples from the original design.</p></li>
<li><p>For each input/output boostrap samples, compute Sobol’ indices by functional chaos.</p></li>
<li><p>Compute quantiles of these Sobol’ indices realizations to get the confidence intervals.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">cantilever_beam</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
</pre></div>
</div>
<p>Load the cantilever beam use-case.
We want to use the independent distribution to get meaningful Sobol’ indices.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span> <span class="o">=</span> <span class="n">cantilever_beam</span><span class="o">.</span><span class="n">CantileverBeam</span><span class="p">()</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">model</span>
<span class="n">distribution</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">independentDistribution</span>
<span class="n">dim_input</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
</pre></div>
</div>
<p>Create the tensorized polynomial basis, with the default linear enumeration function.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">marginals</span> <span class="o">=</span> <span class="p">[</span><span class="n">distribution</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_input</span><span class="p">)]</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">OrthogonalProductPolynomialFactory</span><span class="p">(</span><span class="n">marginals</span><span class="p">)</span>
</pre></div>
</div>
<p>Generate a learning sample with MC simulation (or retrieve the design from experimental data).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ot</span><span class="o">.</span><span class="n">RandomGenerator</span><span class="o">.</span><span class="n">SetSeed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">35</span>  <span class="c1"># size of the experimental design</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeSparseLeastSquaresChaos</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a sparse polynomial chaos with least squares.</span>

<span class="sd">    * Uses the enumeration rule from basis.</span>
<span class="sd">    * Uses LeastSquaresStrategy to compute the coefficients from</span>
<span class="sd">    linear least squares.</span>
<span class="sd">    * Uses LeastSquaresMetaModelSelectionFactory to select the polynomials</span>
<span class="sd">    in the basis using least angle regression stepwise (LARS)</span>
<span class="sd">    * Utilise LeastSquaresStrategy pour calculer les</span>
<span class="sd">    coefficients par moindres carrés.</span>
<span class="sd">    * Uses FixedStrategy to keep all coefficients that LARS has selected,</span>
<span class="sd">    up to the given maximum total degree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : Sample(n)</span>
<span class="sd">        The input training design of experiments with n points</span>
<span class="sd">    Y : Sample(n)</span>
<span class="sd">        The input training design of experiments with n points</span>
<span class="sd">    basis : Basis</span>
<span class="sd">        The multivariate orthogonal polynomial basis</span>
<span class="sd">    total_degree : int</span>
<span class="sd">        The maximum total polynomial degree</span>
<span class="sd">    distribution : Distribution</span>
<span class="sd">        The distribution of the input random vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : FunctionalChaosResult</span>
<span class="sd">        The polynomial chaos result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selectionAlgorithm</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LeastSquaresMetaModelSelectionFactory</span><span class="p">()</span>
    <span class="n">projectionStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LeastSquaresStrategy</span><span class="p">(</span><span class="n">selectionAlgorithm</span><span class="p">)</span>
    <span class="n">enum_func</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">getEnumerateFunction</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">enum_func</span><span class="o">.</span><span class="n">getBasisSizeFromTotalDegree</span><span class="p">(</span><span class="n">total_degree</span><span class="p">)</span>
    <span class="n">adaptiveStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FixedStrategy</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosAlgorithm</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">adaptiveStrategy</span><span class="p">,</span> <span class="n">projectionStrategy</span>
    <span class="p">)</span>
    <span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Build the chaos metamodel on the design of experiment.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">total_degree</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">computeSparseLeastSquaresChaos</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">)</span>
<span class="n">metamodel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
</pre></div>
</div>
<p>Generate a validation sample independent of the training sample.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">n_valid</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">n_valid</span><span class="p">)</span>
<span class="n">Y_test</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<p>The MetaModelValidation class allows one to validate the metamodel on a test sample.
Plot the observed versus the predicted outputs.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">drawValidation</span><span class="p">()</span>
<span class="n">Q2</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chaos validation - Q2=</span><span class="si">{</span><span class="n">Q2</span><span class="o">*</span><span class="mf">100.0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_sobol_confidence_001.png" srcset="../../_images/sphx_glr_plot_chaos_sobol_confidence_001.png" alt="Chaos validation - Q2=99.90%" class = "sphx-glr-single-img"/><p>Retrieve Sobol’ sensitivity measures associated to the polynomial chaos decomposition of the model.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">chaosSI</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosSobolIndices</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">fo_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">chaosSI</span><span class="o">.</span><span class="n">getSobolIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_input</span><span class="p">)]</span>
<span class="n">to_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">chaosSI</span><span class="o">.</span><span class="n">getSobolTotalIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_input</span><span class="p">)]</span>
<span class="n">input_names</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getInputDescription</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SobolIndicesAlgorithm</span><span class="o">.</span><span class="n">DrawSobolIndices</span><span class="p">(</span><span class="n">input_names</span><span class="p">,</span> <span class="n">fo_indices</span><span class="p">,</span> <span class="n">to_indices</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_sobol_confidence_002.png" srcset="../../_images/sphx_glr_plot_chaos_sobol_confidence_002.png" alt="Sobol' indices" class = "sphx-glr-single-img"/><p>We define the <cite>multiBootstrap</cite> function in order to simultaneously bootstrap in the input
and output samples, so that the input/output mapping is preserved.
We use the <cite>GenerateSelection</cite> method of the <a class="reference internal" href="../../user_manual/_generated/openturns.BootstrapExperiment.html#openturns.BootstrapExperiment" title="openturns.BootstrapExperiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">BootstrapExperiment</span></code></a> class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiBootstrap</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bootstrap multiple samples at once.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : sequence of Sample</span>
<span class="sd">        Multiple samples to bootstrap.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data_boot : sequence of Sample</span>
<span class="sd">        The bootstrap samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;empty list&quot;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">BootstrapExperiment</span><span class="o">.</span><span class="n">GenerateSelection</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Z</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="k">for</span> <span class="n">Z</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</pre></div>
</div>
<p>Generate input/output bootstrap samples from the initial design.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">X_boot</span><span class="p">,</span> <span class="n">Y_boot</span> <span class="o">=</span> <span class="n">multiBootstrap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_boot</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y_boot</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    [ E             F             L             I             ]
0 : [   7.09376e+10 305.568         2.55637       1.34556e-07 ]
1 : [   6.5963e+10  228.332         2.57804       1.53991e-07 ]
2 : [   6.60008e+10 325.25          2.5146        1.45825e-07 ]
3 : [   6.52443e+10 320.71          2.54539       1.40993e-07 ]
4 : [   6.86026e+10 282.187         2.59881       1.42475e-07 ]
    [ y0       ]
0 : [ 0.178271 ]
1 : [ 0.128386 ]
2 : [ 0.179111 ]
3 : [ 0.191651 ]
4 : [ 0.168912 ]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeChaosSensitivity</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the first and total order Sobol&#39; indices from a polynomial chaos.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X, Y : Sample</span>
<span class="sd">        Input/Output design</span>
<span class="sd">    basis : Basis</span>
<span class="sd">        Tensorized basis</span>
<span class="sd">    total_degree : int</span>
<span class="sd">        Maximal total degree</span>
<span class="sd">    distribution : Distribution</span>
<span class="sd">        Input distribution</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    first_order, total_order: list of float</span>
<span class="sd">        The first and total order indices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dim_input</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">computeSparseLeastSquaresChaos</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">)</span>
    <span class="n">chaosSI</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosSobolIndices</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">first_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">chaosSI</span><span class="o">.</span><span class="n">getSobolIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_input</span><span class="p">)]</span>
    <span class="n">total_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">chaosSI</span><span class="o">.</span><span class="n">getSobolTotalIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_input</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">first_order</span><span class="p">,</span> <span class="n">total_order</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeBootstrapChaosSobolIndices</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">bootstrap_size</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes a bootstrap sample of first and total order indices from polynomial chaos.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X, Y : Sample</span>
<span class="sd">        Input/Output design</span>
<span class="sd">    basis : Basis</span>
<span class="sd">        Tensorized basis</span>
<span class="sd">    total_degree : int</span>
<span class="sd">        Maximal total degree</span>
<span class="sd">    distribution : Distribution</span>
<span class="sd">        Input distribution</span>
<span class="sd">    bootstrap_size : interval</span>
<span class="sd">        The bootstrap sample size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dim_input</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
    <span class="n">fo_sample</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim_input</span><span class="p">)</span>
    <span class="n">to_sample</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim_input</span><span class="p">)</span>
    <span class="n">unit_eps</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">([</span><span class="mf">1e-9</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bootstrap_size</span><span class="p">):</span>
        <span class="n">X_boot</span><span class="p">,</span> <span class="n">Y_boot</span> <span class="o">=</span> <span class="n">multiBootstrap</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="n">first_order</span><span class="p">,</span> <span class="n">total_order</span> <span class="o">=</span> <span class="n">computeChaosSensitivity</span><span class="p">(</span>
            <span class="n">X_boot</span><span class="p">,</span> <span class="n">Y_boot</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">unit_eps</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">first_order</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unit_eps</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">total_order</span><span class="p">):</span>
            <span class="n">fo_sample</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">first_order</span><span class="p">)</span>
            <span class="n">to_sample</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">total_order</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fo_sample</span><span class="p">,</span> <span class="n">to_sample</span>
</pre></div>
</div>
<p>Compute sample of Sobol’ indices by boostrap.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bootstrap_size</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fo_sample</span><span class="p">,</span> <span class="n">to_sample</span> <span class="o">=</span> <span class="n">computeBootstrapChaosSobolIndices</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">bootstrap_size</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeSobolIndicesConfidenceInterval</span><span class="p">(</span><span class="n">fo_sample</span><span class="p">,</span> <span class="n">to_sample</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    From a sample of first or total order indices,</span>
<span class="sd">    compute a bilateral confidence interval of level alpha.</span>

<span class="sd">    Estimates the distribution of the first and total order Sobol&#39; indices</span>
<span class="sd">    from a bootstrap estimation.</span>
<span class="sd">    Then computes a bilateral confidence interval for each marginal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fo_sample: ot.Sample(n, dim_input)</span>
<span class="sd">        The first order indices</span>
<span class="sd">    to_sample: ot.Sample(n, dim_input)</span>
<span class="sd">        The total order indices</span>
<span class="sd">    alpha : float</span>
<span class="sd">        The confidence level</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fo_interval : ot.Interval</span>
<span class="sd">        The confidence interval of first order Sobol&#39; indices</span>
<span class="sd">    to_interval : ot.Interval</span>
<span class="sd">        The confidence interval of total order Sobol&#39; indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dim_input</span> <span class="o">=</span> <span class="n">fo_sample</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
    <span class="n">fo_lb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span>
    <span class="n">fo_ub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span>
    <span class="n">to_lb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span>
    <span class="n">to_ub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_input</span><span class="p">):</span>
        <span class="n">fo_i</span> <span class="o">=</span> <span class="n">fo_sample</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">to_i</span> <span class="o">=</span> <span class="n">to_sample</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">fo_lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo_i</span><span class="o">.</span><span class="n">computeQuantile</span><span class="p">(</span><span class="n">beta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fo_ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo_i</span><span class="o">.</span><span class="n">computeQuantile</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">to_lb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_i</span><span class="o">.</span><span class="n">computeQuantile</span><span class="p">(</span><span class="n">beta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">to_ub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_i</span><span class="o">.</span><span class="n">computeQuantile</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create intervals</span>
    <span class="n">fo_interval</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="n">fo_lb</span><span class="p">,</span> <span class="n">fo_ub</span><span class="p">)</span>
    <span class="n">to_interval</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="n">to_lb</span><span class="p">,</span> <span class="n">to_ub</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fo_interval</span><span class="p">,</span> <span class="n">to_interval</span>
</pre></div>
</div>
<p>Compute confidence intervals from the indices samples.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fo_interval</span><span class="p">,</span> <span class="n">to_interval</span> <span class="o">=</span> <span class="n">computeSobolIndicesConfidenceInterval</span><span class="p">(</span><span class="n">fo_sample</span><span class="p">,</span> <span class="n">to_sample</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeAndDrawSobolIndices</span><span class="p">(</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">bootstrap_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute and draw Sobol&#39; indices from a polynomial chaos based on a</span>
<span class="sd">    given sample size.</span>
<span class="sd">    Compute confidence intervals at level alpha from bootstrap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">fo_sample</span><span class="p">,</span> <span class="n">to_sample</span> <span class="o">=</span> <span class="n">computeBootstrapChaosSobolIndices</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">bootstrap_size</span>
    <span class="p">)</span>

    <span class="n">fo_interval</span><span class="p">,</span> <span class="n">to_interval</span> <span class="o">=</span> <span class="n">computeSobolIndicesConfidenceInterval</span><span class="p">(</span>
        <span class="n">fo_sample</span><span class="p">,</span> <span class="n">to_sample</span><span class="p">,</span> <span class="n">alpha</span>
    <span class="p">)</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SobolIndicesAlgorithm</span><span class="o">.</span><span class="n">DrawSobolIndices</span><span class="p">(</span>
        <span class="n">input_names</span><span class="p">,</span>
        <span class="n">fo_sample</span><span class="o">.</span><span class="n">computeMean</span><span class="p">(),</span>
        <span class="n">to_sample</span><span class="o">.</span><span class="n">computeMean</span><span class="p">(),</span>
        <span class="n">fo_interval</span><span class="p">,</span>
        <span class="n">to_interval</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sobol&#39; indices - N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setIntegerXTick</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span>
</pre></div>
</div>
<p>Plot the boostrap Sobol’ indices mean and the confidence intervals.
The confidence length will shrink if we increase the initial sample size.</p>
<p>sphinx_gallery_thumbnail_number = 3</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">computeAndDrawSobolIndices</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">total_degree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">ShowAll</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_sobol_confidence_003.png" srcset="../../_images/sphx_glr_plot_chaos_sobol_confidence_003.png" alt="Sobol' indices - N=30" class = "sphx-glr-single-img"/><p>We see that the variable F has the highest sensitivity indices and that confidence intervals
do not change this conclusion.
The confidence intervals of the sensitivity indices of the variables L and I are similar
so that we cannot say which of L or I is more significant than the other: both variables have
similar sensitivity indices.
The least sensitive variable is E, but the confidence intervals do not cross the X axis.
Hence, there is no evidence that the Sobol’ indices of E are zero.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.766 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-sobol-confidence-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/2f39c4817c38238394a16becc0dd7534/plot_chaos_sobol_confidence.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_chaos_sobol_confidence.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/700ed0839afd003e1ddc222b510cad21/plot_chaos_sobol_confidence.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_chaos_sobol_confidence.py</span></code></a></p>
</div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../kriging_metamodel/index.html" title="Kriging metamodel"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_chaos_cleaning_strategy.html" title="Create a sparse chaos by integration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.23dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Polynomial chaos metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Compute Sobol’ indices confidence intervals</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 01, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>