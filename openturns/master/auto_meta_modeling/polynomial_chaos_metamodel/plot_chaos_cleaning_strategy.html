
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Create a sparse chaos by integration &#8212; OpenTURNS 1.20dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Kriging metamodel" href="../kriging_metamodel/index.html" />
    <link rel="prev" title="Polynomial chaos is sensitive to the degree" href="plot_chaos_beam_sensitivity_degree.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../kriging_metamodel/index.html" title="Kriging metamodel"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_chaos_beam_sensitivity_degree.html" title="Polynomial chaos is sensitive to the degree"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Polynomial chaos metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Create a sparse chaos by integration</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Create a sparse chaos by integration</a><ul>
<li><a class="reference internal" href="#polynomial-chaos-expansion">Polynomial chaos expansion</a></li>
<li><a class="reference internal" href="#truncated-expansion">Truncated expansion</a></li>
<li><a class="reference internal" href="#low-rank-polynomial-chaos-expansion">Low-rank polynomial chaos expansion</a></li>
<li><a class="reference internal" href="#model-selection">Model selection</a></li>
<li><a class="reference internal" href="#sparsity-index">Sparsity index</a></li>
<li><a class="reference internal" href="#use-a-model-selection-method">Use a model selection method</a></li>
<li><a class="reference internal" href="#intermediate-steps-of-the-algorithm">Intermediate steps of the algorithm</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_chaos_beam_sensitivity_degree.html"
                          title="previous chapter">Polynomial chaos is sensitive to the degree</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../kriging_metamodel/index.html"
                          title="next chapter">Kriging metamodel</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/polynomial_chaos_metamodel/plot_chaos_cleaning_strategy.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-cleaning-strategy-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="create-a-sparse-chaos-by-integration">
<span id="sphx-glr-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-cleaning-strategy-py"></span><h1>Create a sparse chaos by integration<a class="headerlink" href="#create-a-sparse-chaos-by-integration" title="Permalink to this heading">¶</a></h1>
<p>The goal of this example is to show how to create a sparse polynomial chaos
expansion (PCE) when we estimate its coefficients by integration. We show
how to use the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.CleaningStrategy.html#openturns.CleaningStrategy" title="openturns.CleaningStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">CleaningStrategy</span></code></a> class.</p>
<section id="polynomial-chaos-expansion">
<h2>Polynomial chaos expansion<a class="headerlink" href="#polynomial-chaos-expansion" title="Permalink to this heading">¶</a></h2>
<p>Let <img class="math" src="../../_images/math/9e389d0e762a3ab7906dddb6085333864f1699fb.svg" alt="g : \mathcal{X} \rightarrow \mathbb{R}"/> be a function
where <img class="math" src="../../_images/math/329a5cb7014c0ab0ef3d9b6b3ef878edbbc3dc8f.svg" alt="\mathcal{X} \subseteq \mathbb{R}^p"/> is the domain of <img class="math" src="../../_images/math/658ae44ee69111e3048325f416f44d6080707928.svg" alt="g"/>.
Let <img class="math" src="../../_images/math/51916a9aa71f574e1426044f0bc2d637b6160cde.svg" alt="f"/> be a probability density function on <img class="math" src="../../_images/math/8fc71233992861e04e99632e7ee07438b1e04d48.svg" alt="\mathcal{X}"/>.
Let <img class="math" src="../../_images/math/893b95408f6feaa3c0bf7b3d915e498bce7feb0c.svg" alt="T"/> be the iso-probabilistic transformation from the physical
space <img class="math" src="../../_images/math/8fc71233992861e04e99632e7ee07438b1e04d48.svg" alt="\mathcal{X}"/> to the standard space <img class="math" src="../../_images/math/62fa412f66f8d4f4eb3735ae3bf81f573ceba5f7.svg" alt="\mathcal{\bar{X}}"/>:</p>
<div class="math">
<p><img src="../../_images/math/6b2163419470b959976b55cf820051269e400145.svg" alt="\xi = T(\boldsymbol{x}) \in \mathcal{\bar{X}}"/></p>
</div><p>for any <img class="math" src="../../_images/math/54a5ba13f2066ba4a3f91881ba8e6eadb7a6b122.svg" alt="\boldsymbol{x} \in \mathcal{X}"/>.
Let <img class="math" src="../../_images/math/92cb4c95b7fc9b99a0b22cb07c90a732064db084.svg" alt="h"/> be the function defined by the equation :</p>
<div class="math">
<p><img src="../../_images/math/9f42a1047ae990c9a75fc8204e627529fdbf9570.svg" alt="h(\boldsymbol{\xi}) = \left(g \circ T^{-1}\right)(\boldsymbol{\xi})"/></p>
</div><p>for any <img class="math" src="../../_images/math/637f99f21151e3596b6ba2da8db253c8f77a3ee3.svg" alt="\boldsymbol{\xi} \in \mathcal{\bar{X}}"/>.
The polynomial chaos decomposition of <img class="math" src="../../_images/math/92cb4c95b7fc9b99a0b22cb07c90a732064db084.svg" alt="h"/> is (<a class="reference internal" href="../../bibliography.html#blatman2009" id="id1"><span>[blatman2009]</span></a> page 73) :</p>
<div class="math">
<p><img src="../../_images/math/58d9b4f6a55ae8977e448d141345d20f1387f013.svg" alt="h(\boldsymbol{\xi}) = \sum_{\boldsymbol{\alpha} \in \mathbb{N}^p}
a_{\boldsymbol{\alpha}} \psi_{\boldsymbol{\alpha}}(\boldsymbol{\xi}) + \epsilon"/></p>
</div><p>where <img class="math" src="../../_images/math/8c5458769cf39fe76f7f11c1795f4d600f16ff77.svg" alt="\boldsymbol{\alpha} = (\alpha_1, ..., \alpha_p) \in \mathbb{N}^p"/>
is a multiindex, <img class="math" src="../../_images/math/7ec344bd1c7ac41e6010bbde4fa797d0741f4a42.svg" alt="a_{\boldsymbol{\alpha}} \in \mathbb{R}"/> is the
coefficient,  <img class="math" src="../../_images/math/1bd399b3ca43ed6240725b684872addd37f38301.svg" alt="\psi_{\boldsymbol{\alpha}} : \mathcal{\bar{X}} \rightarrow \mathbb{R}"/>
is a multivariate polynomial and <img class="math" src="../../_images/math/0d105e8ee3d8ee933b1f68424693c02a02189d3a.svg" alt="\epsilon"/> is a random variable.</p>
</section>
<section id="truncated-expansion">
<h2>Truncated expansion<a class="headerlink" href="#truncated-expansion" title="Permalink to this heading">¶</a></h2>
<p>In practice, we cannot consider an infinite series and must truncate
the decomposition at a given order. Only a selection of coefficients must
be kept. This leads to a subset of all possible multiindices. In the
remainder of this text, we call this selection the <em>multiindex set</em>.</p>
<p>Several multiindex sets can be considered. A simple method is to truncate
the polynomial up to a given maximum total degree <img class="math" src="../../_images/math/95afa8a1533d685eed0b93fdc3570821554d71a8.svg" alt="d \in \mathbb{N}"/>.
Let <img class="math" src="../../_images/math/b704ed0d38bb156564e3f7637d0e52087a4a555f.svg" alt="\mathcal{A}^{d}"/> be the multi-index set defined by</p>
<div class="math">
<p><img src="../../_images/math/5ed434a40f912ffbe5453e04499fb4a7b567633a.svg" alt="\mathcal{A}^{d} = \left\{ \boldsymbol{\alpha} \in \mathbb{N}^p
\; | \; \|\boldsymbol{\alpha}\|_1 \leq d\right\}"/></p>
</div><p>where</p>
<div class="math">
<p><img src="../../_images/math/bbd2afdb5dd415122f038137376581d2e4fd1814.svg" alt="\|\boldsymbol{\alpha}\|_d = \alpha_1 + ... + \alpha_p"/></p>
</div><p>is the 1-norm of the multi-index <img class="math" src="../../_images/math/4ea0952ea9cf075bf06dc2059afbe23ad727a856.svg" alt="\boldsymbol{\alpha}"/>.
Therefore, the truncated polynomial chaos expansion is:</p>
<div class="math">
<p><img src="../../_images/math/3fb75cd5f18452839840060e95ca15c48badbf07.svg" alt="h(\boldsymbol{\xi}) = \sum_{\boldsymbol{\alpha} \in \mathcal{A}^{d}}
a_{\boldsymbol{\alpha}} \psi_{\boldsymbol{\alpha}}(\boldsymbol{\xi}) + \epsilon."/></p>
</div><p>In order to ensure a low error, we may choose a large value of the
parameter <img class="math" src="../../_images/math/451a3d9a99f2dcc2293b7b30519b42cf46cb38ac.svg" alt="P"/>. This, however, leads to a large number of
coefficients <img class="math" src="../../_images/math/b19ad45c586cc97136a357038fe6f4a2d1de7e94.svg" alt="\boldsymbol{\alpha} \in \mathcal{A}^{d}"/> to
estimate. More precisely, the number of coefficients to estimate
is (<a class="reference internal" href="../../bibliography.html#blatman2009" id="id2"><span>[blatman2009]</span></a> page 73) :</p>
<div class="math">
<p><img src="../../_images/math/d344071d05f5dd430533a479cb80020cde56f991.svg" alt="\textrm{card}\left(\mathcal{A}^{d}\right) = {p + d \choose d}
= \frac{(p + d)!}{p! d!}"/></p>
</div><p>where <img class="math" src="../../_images/math/3e5752580483133661f5cf63df4fe230ff967ff1.svg" alt="p!"/> is the factorial number of <img class="math" src="../../_images/math/17b12496a489ee11edbaa2998e911d495fddf5be.svg" alt="p"/>.</p>
</section>
<section id="low-rank-polynomial-chaos-expansion">
<h2>Low-rank polynomial chaos expansion<a class="headerlink" href="#low-rank-polynomial-chaos-expansion" title="Permalink to this heading">¶</a></h2>
<p>For any <img class="math" src="../../_images/math/e988cff6c2b286f7d9ce17ed5301278eb7704159.svg" alt="\boldsymbol{\alpha} \in \mathbb{N}^p"/>, let
<img class="math" src="../../_images/math/21330e911b8df04be699bf8bd5c4929cd9a0c4f9.svg" alt="\|\boldsymbol{\alpha}\|_0"/> be the rank of the multiindex, that is,
the number of nonzero components:</p>
<div class="math">
<p><img src="../../_images/math/e3ecfd6bbb70ce299e1d71d72d02818727d86cc7.svg" alt="\|\boldsymbol{\alpha}\|_0 = \sum_{i = 1}^p \boldsymbol{1}_{\alpha_i &gt; 0}"/></p>
</div><p>where <img class="math" src="../../_images/math/49f56a35b2bf1e2af288324206e9ff988d9f7211.svg" alt="\boldsymbol{1}"/> is the indicator function.
The multiindex set of maximum total degree <img class="math" src="../../_images/math/95afa8a1533d685eed0b93fdc3570821554d71a8.svg" alt="d \in \mathbb{N}"/>
and maximum rank <img class="math" src="../../_images/math/bcc13e3fa6059a97232b04911a63e2cf0faadbd7.svg" alt="j \in \mathbb{N}"/> is (<a class="reference internal" href="../../bibliography.html#blatman2009" id="id3"><span>[blatman2009]</span></a> page 74):</p>
<div class="math">
<p><img src="../../_images/math/e04db655dd7646d780a5941b4b85cd97b0ef5f09.svg" alt="\mathcal{A}^{d,j} = \left\{ \boldsymbol{\alpha} \in \mathbb{N}^p
\; | \; \|\boldsymbol{\alpha}\|_1 \leq d, \;
\; \|\boldsymbol{\alpha}\|_0 \leq j\right\}."/></p>
</div><p>Therefore, the rank-<cite>j</cite> polynomial chaos expansion is:</p>
<div class="math">
<p><img src="../../_images/math/cf919f24c3fdda107c72fc2da0515c2c578c2564.svg" alt="h(\boldsymbol{\xi}) = \sum_{\boldsymbol{\alpha} \in
\mathcal{A}^{d,j}} a_{\boldsymbol{\alpha}}
\psi_{\boldsymbol{\alpha}}(\boldsymbol{\xi}) + \epsilon."/></p>
</div><p>The rank is now a hyperparameter of the model: <a class="reference internal" href="../../bibliography.html#blatman2009" id="id4"><span>[blatman2009]</span></a> suggests
to use <img class="math" src="../../_images/math/a18af895b708dde7ff43932ed8382d833e755a5b.svg" alt="j = 2, 3, 4"/>. An example of low-rank PCE for the G-Sobol’
function is given in <a class="reference internal" href="../../bibliography.html#blatman2009" id="id5"><span>[blatman2009]</span></a> page 75.</p>
<p><em>Note.</em> It is currently not possible to create a low-rank PCE in OpenTURNS.</p>
</section>
<section id="model-selection">
<h2>Model selection<a class="headerlink" href="#model-selection" title="Permalink to this heading">¶</a></h2>
<p>If <img class="math" src="../../_images/math/c3152dd2cbafce12c2ddf0384ebea5f93bbafb59.svg" alt="\textrm{card}\left(\mathcal{A}^{d}\right)"/> is large, many coefficients
may be poorly estimated, which may reduce the quality of the metamodel. We may
want to select a subset of the coefficients which best predict the output.
In other words, we may compute a subset</p>
<div class="math">
<p><img src="../../_images/math/095c42a4f2beba35f3bea0d5832b622636ae630e.svg" alt="\mathcal{A} \subseteq \mathcal{A}^{d}"/></p>
</div><p>such that (<a class="reference internal" href="../../bibliography.html#blatman2009" id="id6"><span>[blatman2009]</span></a> page 86) :</p>
<div class="math">
<p><img src="../../_images/math/452cbd03d60f184b78100978576299a90f5976ab.svg" alt="h(\boldsymbol{\xi}) = \sum_{\boldsymbol{\alpha} \in \mathcal{A}}
a_{\boldsymbol{\alpha}} \psi_{\boldsymbol{\alpha}}(\boldsymbol{\xi})
+ \epsilon."/></p>
</div><p>An enumeration rule is a function from the set of integers <img class="math" src="../../_images/math/14feef167e3dd938706565e34c0c9ac19065a615.svg" alt="k"/> to
the corresponding set of multiindices <img class="math" src="../../_images/math/4ea0952ea9cf075bf06dc2059afbe23ad727a856.svg" alt="\boldsymbol{\alpha}"/>. More
precisely, let <img class="math" src="../../_images/math/aacde673e3b0960b356afbf728d4a68c6b1981ec.svg" alt="r : \mathbb{N} \rightarrow \mathbb{N}^p"/> be the
function such that :</p>
<div class="math">
<p><img src="../../_images/math/65341f76e61725f601747c792b5772a079243ba8.svg" alt="r(k) = \boldsymbol{\alpha}"/></p>
</div><p>for any <img class="math" src="../../_images/math/bb882839ffa6bca1d0c8657e0d2ed7eb5c14d9ac.svg" alt="k \geq 0"/>.
Let <img class="math" src="../../_images/math/e5cc5fe24937c64a0b381c058942a1abfa0a581d.svg" alt="K \in \mathbb{N}"/> be a parameter representing the number of
coefficients considered in the selection. Given an enumeration rule for
the multiindices <img class="math" src="../../_images/math/4ea0952ea9cf075bf06dc2059afbe23ad727a856.svg" alt="\boldsymbol{\alpha}"/>, at most <img class="math" src="../../_images/math/c55b41eac82c4e5a8d7c5ae98795f4beb74baad1.svg" alt="K"/> multiindices
will be considered. Let <img class="math" src="../../_images/math/6d57860847f7f0d7cf3275b822541ee8f8f348e5.svg" alt="\mathcal{A}_K"/> be the corresponding multiindex set :</p>
<div class="math">
<p><img src="../../_images/math/952fdc193d38820e8d5c3a6d4aa56e5fdd40fb28.svg" alt="\mathcal{A}_K = \left\{ \boldsymbol{\alpha}
\; | \; r^{-1}(\boldsymbol{\alpha}) = k \leq K \right\}."/></p>
</div><p>Let <img class="math" src="../../_images/math/ecb0634603f70b4f1af5a700ee7c6a547110c49b.svg" alt="\epsilon &gt; 0"/> be a parameter representing the minimum relative
value of a significant coefficient <img class="math" src="../../_images/math/89cf2596f5bca7b0c0bf929a26b98ff9518c80fa.svg" alt="a_{\boldsymbol{\alpha}}"/>.
The <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.CleaningStrategy.html#openturns.CleaningStrategy" title="openturns.CleaningStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">CleaningStrategy</span></code></a> uses the following criteria to select the coefficients :</p>
<div class="math">
<p><img src="../../_images/math/06580e49d3db66dd5eb86bb9179aba07f33e99fd.svg" alt="\mathcal{A}_\epsilon =
\left\{
|a_{\boldsymbol{\alpha}}| \geq \epsilon \max_{ a_{\boldsymbol{\alpha}}
\in \mathcal{A}_K } |a_{\boldsymbol{\alpha}}| \right\}"/></p>
</div><p>where <img class="math" src="../../_images/math/0d105e8ee3d8ee933b1f68424693c02a02189d3a.svg" alt="\epsilon"/> is the significance factor, which by default is
<img class="math" src="../../_images/math/7681552ecaa7fa30bb9548b02b875ac34af1348b.svg" alt="\epsilon = 10^{-4}"/>. This rule selects only the coefficients which
are significantly different from zero.</p>
</section>
<section id="sparsity-index">
<h2>Sparsity index<a class="headerlink" href="#sparsity-index" title="Permalink to this heading">¶</a></h2>
<p>The sparsity index of a multiindex set is the ratio of the cardinality of
the multiindex set to the cardinality of the multiindex set of the
equivalent multiindex with maximum total degree. For a given multiindex
set <img class="math" src="../../_images/math/78f186322277d9f705ec0f0a91e7a8a37cfc6ed5.svg" alt="\mathcal{A}"/>, let <img class="math" src="../../_images/math/5da6e6d65e4ae3032c58fe8c94955247fc4ebe22.svg" alt="d"/> be the maximum 1-norm of multiindices
in the set :</p>
<div class="math">
<p><img src="../../_images/math/64e3e59980e489982f1ac2f0af02b5ad1bb3ef0d.svg" alt="d := \textrm{max}_{\boldsymbol{\alpha} \in \mathcal{A}}
\|\boldsymbol{\alpha}\|_1."/></p>
</div><p>The index of sparsity of <img class="math" src="../../_images/math/78f186322277d9f705ec0f0a91e7a8a37cfc6ed5.svg" alt="\mathcal{A}"/> is (<a class="reference internal" href="../../bibliography.html#blatman2009" id="id7"><span>[blatman2009]</span></a>  eq. 4.42 page 86) :</p>
<div class="math">
<p><img src="../../_images/math/2422b874846d1a96fae18b9d81d0ca3f68d0f4fe.svg" alt="\textrm{IS}(\mathcal{A})
= \frac{\textrm{card}(\mathcal{A})}{\textrm{card}\left(\mathcal{A}^d\right)}."/></p>
</div><p><em>Note.</em> The index of sparsity as defined by <a class="reference internal" href="../../bibliography.html#blatman2009" id="id8"><span>[blatman2009]</span></a> is close to zero when
the model is very sparse. The following complementary indicator is close
to 1 when the model is very sparse:</p>
<div class="math">
<p><img src="../../_images/math/795ad79a6f7b3ca544aca89bfc2f198d7c7fbce8.svg" alt="\textrm{IS}_{\textrm{c}}(\mathcal{A})
= 1 - \frac{\textrm{card}(\mathcal{A})}{\textrm{card}\left(\mathcal{A}^d\right)}."/></p>
</div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
<span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">ishigami_function</span>
<span class="kn">import</span> <span class="nn">itertools</span>
</pre></div>
</div>
<p>The following function takes a polynomial chaos result as input and prints a
given maximum number of coefficients of this polynomial. It can take into account
a threshold, so that we can avoid to print coefficients which are very close to zero.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">printCoefficientsTable</span><span class="p">(</span>
    <span class="n">polynomialChaosResult</span><span class="p">,</span> <span class="n">maximum_number_of_printed_coefficients</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the coefficients of the polynomial chaos.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    polynomialChaosResult : ot.FunctionalChaosResult</span>
<span class="sd">        The polynomial chaos expansion.</span>
<span class="sd">    maximum_number_of_printed_coefficients : int</span>
<span class="sd">        The maximum number of printed coefficients.</span>
<span class="sd">    threshold : float, strictly positive</span>
<span class="sd">        If a coefficient has an absolute value strictly greater than the</span>
<span class="sd">        threshold, it is printed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">polynomialChaosResult</span><span class="o">.</span><span class="n">getOrthogonalBasis</span><span class="p">()</span>
    <span class="n">coefficients</span> <span class="o">=</span> <span class="n">polynomialChaosResult</span><span class="o">.</span><span class="n">getCoefficients</span><span class="p">()</span>
    <span class="n">enumerate_function</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">getEnumerateFunction</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">polynomialChaosResult</span><span class="o">.</span><span class="n">getIndices</span><span class="p">()</span>
    <span class="n">nbcoeffs</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of coefficients : &quot;</span><span class="p">,</span> <span class="n">nbcoeffs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Indice, Multi-indice, Degree : Value&quot;</span><span class="p">)</span>
    <span class="n">print_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbcoeffs</span><span class="p">):</span>
        <span class="n">multiindex</span> <span class="o">=</span> <span class="n">enumerate_function</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">multiindex</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">coefficients</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#</span><span class="si">%d</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">multiindex</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
            <span class="n">print_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">print_index</span> <span class="o">&gt;</span> <span class="n">maximum_number_of_printed_coefficients</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>The next function computes the polynomial chaos Q2 score using simple validation
on a test sample generated by Monte-Carlo sampling. The actual computation
is performed by the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.MetaModelValidation.html#openturns.MetaModelValidation" title="openturns.MetaModelValidation"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaModelValidation</span></code></a> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_polynomial_chaos_Q2</span><span class="p">(</span>
    <span class="n">polynomialchaos_result</span><span class="p">,</span> <span class="n">g_function</span><span class="p">,</span> <span class="n">input_distribution</span><span class="p">,</span> <span class="n">n_valid</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Q2 score of the polynomial chaos.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    polynomialChaosResult : ot.FunctionalChaosResult</span>
<span class="sd">        The polynomial chaos expansion.</span>
<span class="sd">    g_function : ot.Function</span>
<span class="sd">        The function.</span>
<span class="sd">    input_distribution : ot.Distribution</span>
<span class="sd">        The input distribution.</span>
<span class="sd">    n_valid : int</span>
<span class="sd">        The number of simulations to compute the Q2 score.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Q2 : float</span>
<span class="sd">        The Q2 score</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">RandomGenerator</span><span class="o">.</span><span class="n">SetSeed</span><span class="p">(</span><span class="mi">1976</span><span class="p">)</span>
    <span class="n">metamodel</span> <span class="o">=</span> <span class="n">polynomialchaos_result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
    <span class="n">inputTest</span> <span class="o">=</span> <span class="n">input_distribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">n_valid</span><span class="p">)</span>
    <span class="n">outputTest</span> <span class="o">=</span> <span class="n">g_function</span><span class="p">(</span><span class="n">inputTest</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">inputTest</span><span class="p">,</span> <span class="n">outputTest</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
    <span class="n">Q2</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Q2</span>
</pre></div>
</div>
<p>The following function creates a validation plot using the
<a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.MetaModelValidation.html#openturns.MetaModelValidation.drawValidation" title="openturns.MetaModelValidation.drawValidation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">drawValidation()</span></code></a> method
of the <cite>MetaModelValidation</cite> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_polynomial_chaos_validation</span><span class="p">(</span>
    <span class="n">polynomialchaos_result</span><span class="p">,</span> <span class="n">g_function</span><span class="p">,</span> <span class="n">input_distribution</span><span class="p">,</span> <span class="n">n_valid</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the polynomial chaos.</span>

<span class="sd">    Create the validation plot.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    polynomialChaosResult : ot.FunctionalChaosResult</span>
<span class="sd">        The polynomial chaos expansion.</span>
<span class="sd">    g_function : ot.Function</span>
<span class="sd">        The function.</span>
<span class="sd">    input_distribution : ot.Distribution</span>
<span class="sd">        The input distribution.</span>
<span class="sd">    n_valid : int</span>
<span class="sd">        The number of simulations to compute the Q2 score.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Q2 : float</span>
<span class="sd">        The Q2 score</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metamodel</span> <span class="o">=</span> <span class="n">polynomialchaos_result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
    <span class="n">inputTest</span> <span class="o">=</span> <span class="n">input_distribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">n_valid</span><span class="p">)</span>
    <span class="n">outputTest</span> <span class="o">=</span> <span class="n">g_function</span><span class="p">(</span><span class="n">inputTest</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">inputTest</span><span class="p">,</span> <span class="n">outputTest</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
    <span class="n">Q2</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">drawValidation</span><span class="p">()</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Q2=</span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Q2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">view</span>
</pre></div>
</div>
<p>We consider the Ishigami model.
Its three inputs are i.i.d. random variables that follow the uniform distribution on the
<img class="math" src="../../_images/math/4f3778d520222634f4a7473d665b710c01ead9a7.svg" alt="[-\pi, \pi]"/> interval. This is an interesting example for our
purpose because it is highly non linear, so that a high polynomial degree
will be required in order to produce a polynomial chaos expansion with Q2
score sufficiently close to 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">im</span> <span class="o">=</span> <span class="n">ishigami_function</span><span class="o">.</span><span class="n">IshigamiModel</span><span class="p">()</span>

<span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;`X_0`&quot;</span><span class="p">,</span> <span class="s2">&quot;`X_1`&quot;</span><span class="p">,</span> <span class="s2">&quot;`X_2`&quot;</span><span class="p">])</span>
<span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setOutputDescription</span><span class="p">([</span><span class="s2">&quot;`Y`&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>ComposedDistribution(Uniform(a = -3.14159, b = 3.14159), Uniform(a = -3.14159, b = 3.14159), Uniform(a = -3.14159, b = 3.14159), IndependentCopula(dimension = 3))
</pre></div>
</div>
<p>Then we create the multivariate basis onto which the function is expanded.
By default, it is associated with the linear enumeration rule. Since our
marginals are uniform, the <a class="reference internal" href="../../user_manual/_generated/openturns.OrthogonalProductPolynomialFactory.html#openturns.OrthogonalProductPolynomialFactory" title="openturns.OrthogonalProductPolynomialFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrthogonalProductPolynomialFactory</span></code></a> class
produces Legendre polynomials.
In order to create the multivariate basis of polynomials, we must specify the
number of functions in the basis. In this particular case, we compute that
number depending on the total degree.
The <a class="reference internal" href="../../user_manual/_generated/openturns.EnumerateFunction.html#openturns.EnumerateFunction.getMaximumDegreeStrataIndex" title="openturns.EnumerateFunction.getMaximumDegreeStrataIndex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getMaximumDegreeStrataIndex()</span></code></a> method
of the enumeration function computes the number of layers necessary to achieve
that total degree. Then the number of functions up to that layer is computed
with the <a class="reference internal" href="../../user_manual/_generated/openturns.EnumerateFunction.html#openturns.EnumerateFunction.getStrataCumulatedCardinal" title="openturns.EnumerateFunction.getStrataCumulatedCardinal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getStrataCumulatedCardinal()</span></code></a> method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
<span class="n">multivariateBasis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">OrthogonalProductPolynomialFactory</span><span class="p">(</span>
    <span class="p">[</span><span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">totalDegree</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Polynomial degree</span>
<span class="n">enumerate_function</span> <span class="o">=</span> <span class="n">multivariateBasis</span><span class="o">.</span><span class="n">getEnumerateFunction</span><span class="p">()</span>
<span class="n">strataIndex</span> <span class="o">=</span> <span class="n">enumerate_function</span><span class="o">.</span><span class="n">getMaximumDegreeStrataIndex</span><span class="p">(</span><span class="n">totalDegree</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;strataIndex = &quot;</span><span class="p">,</span> <span class="n">strataIndex</span><span class="p">)</span>
<span class="n">number_of_terms_in_basis</span> <span class="o">=</span> <span class="n">enumerate_function</span><span class="o">.</span><span class="n">getStrataCumulatedCardinal</span><span class="p">(</span>
    <span class="n">strataIndex</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number_of_terms_in_basis = &quot;</span><span class="p">,</span> <span class="n">number_of_terms_in_basis</span><span class="p">)</span>
<span class="n">adaptiveStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FixedStrategy</span><span class="p">(</span>
    <span class="n">multivariateBasis</span><span class="p">,</span> <span class="n">number_of_terms_in_basis</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adaptiveStrategy</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>strataIndex =  5
number_of_terms_in_basis =  56
class=FixedStrategy derived from class=AdaptiveStrategyImplementation maximumDimension=56
</pre></div>
</div>
<p>We compute the coefficients using a multivariate tensor product Gaussian
quadrature rule. Since the coefficients are computed in the standardized
space, we first use the <cite>getMeasure</cite> method of the multivariate basis in
order to get that standardized distribution. Then we use the
<a class="reference internal" href="../../user_manual/_generated/openturns.GaussProductExperiment.html#openturns.GaussProductExperiment" title="openturns.GaussProductExperiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussProductExperiment</span></code></a> class to create the quadrature,
using 6 nodes on each
of the dimensions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">standard_distribution</span> <span class="o">=</span> <span class="n">multivariateBasis</span><span class="o">.</span><span class="n">getMeasure</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">standard_distribution</span><span class="p">)</span>

<span class="n">marginal_number_of_nodes</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">dim_input</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getInputDimension</span><span class="p">()</span>
<span class="n">marginalDegrees</span> <span class="o">=</span> <span class="p">[</span><span class="n">marginal_number_of_nodes</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_input</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussProductExperiment</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">,</span> <span class="n">marginalDegrees</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">generateWithWeights</span><span class="p">()</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample size = &quot;</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>ComposedDistribution(Uniform(a = -1, b = 1), Uniform(a = -1, b = 1), Uniform(a = -1, b = 1), IndependentCopula(dimension = 3))
Sample size =  216
</pre></div>
</div>
<p>We see that 216 nodes are involved in this quadrature rule, which is the result
of <img class="math" src="../../_images/math/ba096e688abd83f01fbb1d02e83aa2f7f3042529.svg" alt="6^3 = 216"/>.</p>
<p>In the next cell, we compute the coefficients of the polynomial chaos expansion
using integration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">projectionStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">IntegrationStrategy</span><span class="p">()</span>
<span class="n">chaosalgo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosAlgorithm</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">,</span> <span class="n">adaptiveStrategy</span><span class="p">,</span> <span class="n">projectionStrategy</span>
<span class="p">)</span>
<span class="n">chaosalgo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">chaosalgo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<p>We now validate the metamodel by drawing the validation graph. We see that
many points are close to the red test line, which indicates that the
predictions of the polynomial chaos expansion are close to the output
observations from the model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">view</span> <span class="o">=</span> <span class="n">draw_polynomial_chaos_validation</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_cleaning_strategy_001.png" srcset="../../_images/sphx_glr_plot_chaos_cleaning_strategy_001.png" alt="Q2=84.20%" class = "sphx-glr-single-img"/><p>In order to have a closer look on the result, we use the
<cite>printCoefficientsTable</cite> function in order to print the first 10 coefficients.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printCoefficientsTable</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Total number of coefficients :  56
# Indice, Multi-indice, Degree : Value
#0, [0,0,0] (0) : 3.5049783626206237
#1, [1,0,0] (1) : 1.6254291279668338
#2, [0,1,0] (1) : -2.2703193491846463e-15
#3, [0,0,1] (1) : -2.3397082882237186e-15
#4, [2,0,0] (2) : -1.7299529864178709e-15
#5, [1,1,0] (2) : -1.4151006755280804e-15
#6, [1,0,1] (2) : -3.926980268742497e-15
#7, [0,2,0] (2) : -0.6413919098131438
#8, [0,1,1] (2) : -1.3834419720915037e-16
#9, [0,0,2] (2) : -1.3791051634015616e-15
#10, [3,0,0] (3) : -1.2911039486376783
</pre></div>
</div>
<p>We see that there are 56 coefficients in the metamodel and that many of
these coefficients are close to zero.</p>
<p>If we print only coefficients greater than <img class="math" src="../../_images/math/51325ca8163995f8af8d9fe715ba94946f2c7ab9.svg" alt="10^{-14}"/>, we see that
only a fraction of them are significant and that these significant coefficients
have a relatively large polynomial degree.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printCoefficientsTable</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1.0e-14</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Total number of coefficients :  56
# Indice, Multi-indice, Degree : Value
#0, [0,0,0] (0) : 3.5049783626206237
#1, [1,0,0] (1) : 1.6254291279668338
#7, [0,2,0] (2) : -0.6413919098131438
#10, [3,0,0] (3) : -1.2911039486376783
#15, [1,0,2] (3) : 1.372430036055514
#30, [0,4,0] (4) : -1.612274010672512
#35, [5,0,0] (5) : 0.2076061472481225
#40, [3,0,2] (5) : -1.0901427864755064
#49, [1,0,4] (5) : 0.40917958066434534
</pre></div>
</div>
<p>The previous experiments suggest to keep only the coefficients which are
significant in the model: this is the topic of the next section.</p>
</section>
<section id="use-a-model-selection-method">
<h2>Use a model selection method<a class="headerlink" href="#use-a-model-selection-method" title="Permalink to this heading">¶</a></h2>
<p>The <cite>CleaningStrategy</cite> has the following algorithm. On input, it considers
only the first <cite>maximumConsideredTerms</cite> coefficients
<img class="math" src="../../_images/math/89cf2596f5bca7b0c0bf929a26b98ff9518c80fa.svg" alt="a_{\boldsymbol{\alpha}}"/>. On output it selects the <cite>mostSignificant</cite>
most significant coefficients. To do this, it uses the
<cite>significanceFactor</cite> parameter.</p>
<p>The following function will help to create a sparse PCE using the
<cite>CleaningStrategy</cite>. It takes into account the number of considered coefficients
in the expansion, the number of significant coefficients to keep and the
relative factor and returns the Q2 score.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_cleaning_PCE</span><span class="p">(</span>
    <span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">,</span> <span class="n">significanceFactor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a PCE using CleaningStrategy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    maximumConsideredTerms : int</span>
<span class="sd">        The maximum number of coefficients considered by the algorithm during</span>
<span class="sd">        intermediate steps.</span>

<span class="sd">    mostSignificant : int</span>
<span class="sd">        The maximum number of coefficients selected by the algorithm in</span>
<span class="sd">        the final PCE.</span>

<span class="sd">    significanceFactor : float</span>
<span class="sd">        The relative part of any coefficient with respect to the maximum</span>
<span class="sd">        coefficient.</span>

<span class="sd">    verbose : bool</span>
<span class="sd">        If set to True, print intermediate messages.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Q2 : float</span>
<span class="sd">        The Q2 score</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">adaptiveStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CleaningStrategy</span><span class="p">(</span>
        <span class="n">multivariateBasis</span><span class="p">,</span>
        <span class="n">maximumConsideredTerms</span><span class="p">,</span>
        <span class="n">mostSignificant</span><span class="p">,</span>
        <span class="n">significanceFactor</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">chaosalgo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosAlgorithm</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">,</span> <span class="n">adaptiveStrategy</span><span class="p">,</span> <span class="n">projectionStrategy</span>
    <span class="p">)</span>
    <span class="n">chaosalgo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">chaosalgo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="n">score_Q2</span> <span class="o">=</span> <span class="n">compute_polynomial_chaos_Q2</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Q2 = </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">score_Q2</span><span class="p">))</span>
        <span class="n">printCoefficientsTable</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score_Q2</span>
</pre></div>
</div>
<p>In the next cell, we consider at most 500 coefficients and keep only
the 5 most significant coefficients. The factor is set to a relatively low value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maximumConsideredTerms</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">mostSignificant</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">significanceFactor</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">score_Q2</span> <span class="o">=</span> <span class="n">compute_cleaning_PCE</span><span class="p">(</span>
    <span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">,</span> <span class="n">significanceFactor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Q2 = -384.39%
Total number of coefficients :  6
# Indice, Multi-indice, Degree : Value
#0, [0,0,0] (0) : 3.5049783626206237
#1, [11,0,0] (11) : -1.660368443760905
#2, [12,0,0] (12) : -4.269723903959823
#3, [0,12,0] (12) : -4.133953684206096
#4, [0,0,12] (12) : -4.2697239039598225
#5, [5,0,8] (13) : -0.05247121628574973
</pre></div>
</div>
<p>We see that when we keep only 5 coefficients among the first 500 ones,
these coefficients have a very high polynomial degree. Indeed, it occurs that
these poorly estimated coefficients have a high absolute value. Hence, the
criteria selects them as significant coefficients, which leads to a poor metamodel.</p>
<p>Let us reduce the number of considered coefficients and increase the number
of selected coefficients.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maximumConsideredTerms</span> <span class="o">=</span> <span class="mi">56</span>
<span class="n">mostSignificant</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">significanceFactor</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">score_Q2</span> <span class="o">=</span> <span class="n">compute_cleaning_PCE</span><span class="p">(</span>
    <span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">,</span> <span class="n">significanceFactor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Q2 = 85.75%
Total number of coefficients :  9
# Indice, Multi-indice, Degree : Value
#0, [0,0,0] (0) : 3.5049783626206237
#1, [1,0,0] (1) : 1.6254291279668338
#2, [0,2,0] (2) : -0.6413919098131438
#3, [3,0,0] (3) : -1.2911039486376783
#4, [1,0,2] (3) : 1.372430036055514
#5, [0,4,0] (4) : -1.612274010672512
#6, [5,0,0] (5) : 0.2076061472481225
#7, [3,0,2] (5) : -1.0901427864755064
#8, [1,0,4] (5) : 0.40917958066434534
</pre></div>
</div>
<p>When we keep only 10 coefficients among the first 56 ones, the polynomial
chaos metamodel is much better: the coefficients are associated with a low
polynomial degree, so that the quadrature rule estimates them with greater accuracy.</p>
<p>We would like to know which combination is best. In the following loop, we
consider the maximum number of considered coefficients from 1 to 500 and the
number of selected coefficients from 1 to 30. In order to produce the
combinations, we use the <cite>product</cite> function from the <cite>itertools</cite> module.
For each combination, we compute the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score and select the
combination with highest <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> coefficient. As shown in <a class="reference internal" href="../../bibliography.html#muller2016" id="id9"><span>[Muller2016]</span></a>
page 268, the computed <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> may be optimistic, but this is not the
point of the current example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maximumConsideredTerms_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">mostSignificant_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">maximumConsideredTerms_list</span><span class="p">,</span> <span class="n">mostSignificant_list</span><span class="p">)</span>
<span class="n">best_score</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">best_parameters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
    <span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span> <span class="o">=</span> <span class="n">it</span>
    <span class="n">score_Q2</span> <span class="o">=</span> <span class="n">compute_cleaning_PCE</span><span class="p">(</span>
        <span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">,</span> <span class="n">significanceFactor</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">score_Q2</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">score_Q2</span>
        <span class="n">best_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Q2 = </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">best_score</span><span class="p">))</span>

<span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span> <span class="o">=</span> <span class="n">best_parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of considered coefficients : &quot;</span><span class="p">,</span> <span class="n">maximumConsideredTerms</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of selected coefficients : &quot;</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Best Q2 = 86.15%
Number of considered coefficients :  101
Number of selected coefficients :  16
</pre></div>
</div>
<p>We see that the best solution could be to select at most 16 significant
coefficients among the first 101 ones. Let us see the Q2 score and the
coefficients in this situation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">score_Q2</span> <span class="o">=</span> <span class="n">compute_cleaning_PCE</span><span class="p">(</span>
    <span class="n">maximumConsideredTerms</span><span class="p">,</span> <span class="n">mostSignificant</span><span class="p">,</span> <span class="n">significanceFactor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Q2 = 86.15%
Total number of coefficients :  12
# Indice, Multi-indice, Degree : Value
#0, [0,0,0] (0) : 3.5049783626206237
#1, [1,0,0] (1) : 1.6254291279668338
#2, [0,2,0] (2) : -0.6413919098131438
#3, [3,0,0] (3) : -1.2911039486376783
#4, [1,0,2] (3) : 1.372430036055514
#5, [0,4,0] (4) : -1.612274010672512
#6, [5,0,0] (5) : 0.2076061472481225
#7, [3,0,2] (5) : -1.0901427864755064
#8, [1,0,4] (5) : 0.40917958066434534
#9, [7,0,0] (7) : -0.20779864255814526
#10, [5,0,2] (7) : 0.17529211655600668
</pre></div>
</div>
<p>These parameters lead to a total number of coefficients equal to 12. Among
the 16 most significant coefficients, only 12 satisfy the criteria. Most of
the coefficients have a small polynomial degree although some have a total
degree as large as 7.</p>
</section>
<section id="intermediate-steps-of-the-algorithm">
<h2>Intermediate steps of the algorithm<a class="headerlink" href="#intermediate-steps-of-the-algorithm" title="Permalink to this heading">¶</a></h2>
<p>If we set the <cite>verbose</cite> optional input argument of the
<cite>compute_cleaning_PCE</cite> function to <cite>True</cite>, then intermediate messages are
printed in the Terminal. For each step of
the adaptivity algorithm, the code prints some of the internal parameters
of the algorithm. The datastructure uses several variables that we now describe.</p>
<ul class="simple">
<li><p><cite>Psi_k_p_</cite> : the collection of functions in the current active polynomial multiindex set,</p></li>
<li><p><cite>I_p_</cite> : the list of indices of the selected coefficients based according to the enumeration rule,</p></li>
<li><p><cite>addedPsi_k_ranks_</cite> : the list of indices to add the multiindex set,</p></li>
<li><p><cite>removedPsi_k_ranks_</cite> : the list of indices to remove to the multiindex set,</p></li>
<li><p><cite>conservedPsi_k_ranks_</cite> : the index of the first polynomial in the selected multiindex set,</p></li>
<li><p><cite>currentVectorIndex_</cite> : the current value of the index in the full multiindex set, according to the enumeration rule.</p></li>
</ul>
<p>Each time the selection method is called, it is passed a
coefficient <img class="math" src="../../_images/math/89cf2596f5bca7b0c0bf929a26b98ff9518c80fa.svg" alt="a_{\boldsymbol{\alpha}}"/> which is a new candidate to be
considered by the algorithm. The first time the method is evaluated, the
active multiindex set is empty, so that it must be filled with the first
coefficients in the multiindex set, according to the enumeration rule. The
second time (and up to the end of the algorithm), the candidate coefficient
is considered to be added to the multiindex set.</p>
<p>Executing the function prints messages that we can process to produce the
following listing. On each step, we print the list of integers corresponding
to the indices of the coefficients in the active multiindex set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Step</span> <span class="mi">1</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">2</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">3</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">4</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">5</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">6</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">7</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">8</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">9</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">15</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">16</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">20</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">21</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">25</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">26</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">34</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">35</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">69</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">70</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">85</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">74</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">75</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">83</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">98</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">84</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">85</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">86</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">98</span><span class="p">]</span>
<span class="n">Step</span> <span class="mi">87</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">98</span><span class="p">]</span>
</pre></div>
</div>
<p>The previous text (and a detailed analysis of the output file) allows to
understand what exactly happens in the algorithm. To understand each step,
note that the significant threshold is equal to <img class="math" src="../../_images/math/885a16e229619528d05b35c5327644efd530edc6.svg" alt="\epsilon = 10^{-10}"/>.</p>
<ul class="simple">
<li><p>During the initialization, the initial basis is empty and filled with the
indices [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15].
The coefficient with index equal to 0 corrresponds to the mean of the
polynomial chaos expansion. As a result, we always want to select that
coefficient in the active set.
Hence, the calculation of the largest coefficient in absolute value is
performed from the indices from 1 to 15.
The largest coefficient in absolute value is <img class="math" src="../../_images/math/4e1c73a31aa781b169e605a0f5e86874d909ba74.svg" alt="a_1 = 1.625"/>, which leads
to the threshold <img class="math" src="../../_images/math/685f09c91444479c233ecd47ffd7e5dafdc0bea6.svg" alt="\epsilon |a_1| = 1.625 \times 10^{-10}"/>. Most of
the considered coefficient are, however, too close to zero. This is why only
the coefficients [0, 1, 7, 10, 15] are kept in the basis. The
corresponding coefficients are [3.505, 1.625,-0.6414, -1.291, 1.372].</p></li>
<li><p>On step 1, the candidate index 16 is considered. Its coefficient is
<img class="math" src="../../_images/math/5378544a6f529edeb3ddb769563d720c92727639.svg" alt="a_{16} = -1.197 \times 10^{-15}"/>, which is much too low to be
selected. Hence, the basis is unchanged and the active multiindex set
is [0, 1, 7, 10, 15] on the end of this step.</p></li>
<li><p>From the step 3 to the step 15, the active multiindex set is unchanged,
because no considered coefficient becomes greater than the threshold.</p></li>
<li><p>On step 16, the candidate index 30 is considered, with corresponding
coefficient <img class="math" src="../../_images/math/5f8082a3efbf14742a1c23081a59ca9a45bbb688.svg" alt="a_{30} = -1.612"/>. Since this coefficient has an absolute
value greater than the threshold, it gets selected and the active multiindex
set is [0, 1, 7, 10, 15, 30] on the end of this step. From this step to the
end, the index 30 will not leave the active set.</p></li>
<li><p>On the step 20, the index 35 enters the active set.</p></li>
<li><p>On the step 25, the index 40 enters the active set.</p></li>
<li><p>On the step 34, the index 49 enters the active set.</p></li>
<li><p>On the step 69, the index 84 enters the active set.</p></li>
<li><p>On the step 74, the index 89 enters the active set.</p></li>
<li><p>On the step 83, the index 98 enters the active set.</p></li>
<li><p>On the last step, the active multiindex set contains the indices
[0, 1, 7, 10, 15, 30, 35, 40, 49, 84, 89, 98] and the corresponding
coefficients are [3.508, 1.625, -0.6414, -1.291, 1.372, -1.613, 0.2076,
-1.090, 0.4092, -0.2078, 0.1753, -0.3250].</p></li>
</ul>
<p>We see that the algorithm was able so select 12 coefficients in the first
101 coefficients considered by the algorithm. It could have selected
more coefficients since we provided 16 slots to fill thanks to the
<cite>mostSignificant</cite> parameter. The considered coefficients were, however,
too close to zero and were below the threshold.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>We see that the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.CleaningStrategy.html#openturns.CleaningStrategy" title="openturns.CleaningStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">CleaningStrategy</span></code></a> class performs correctly in
this particular case. We have seen how to select the hyperparameters which
produce the best Q2 score.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  2.849 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-cleaning-strategy-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e3fd5d734a0eba35d5c47a04fa2a07ac/plot_chaos_cleaning_strategy.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_chaos_cleaning_strategy.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e3c5da0276dc3c0d01324bd3d1cdcfdc/plot_chaos_cleaning_strategy.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_chaos_cleaning_strategy.ipynb</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../kriging_metamodel/index.html" title="Kriging metamodel"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_chaos_beam_sensitivity_degree.html" title="Polynomial chaos is sensitive to the degree"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Polynomial chaos metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Create a sparse chaos by integration</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 01, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.2.
    </div>
  </body>
</html>