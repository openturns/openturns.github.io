
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Calibration of the Chaboche mecanical model &#8212; OpenTURNS 1.14dev documentation</title>
    <link rel="stylesheet" href="../../_static/openturns.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Calibration of the logistic model" href="calibration_logistic.html" />
    <link rel="prev" title="Calibration of the flooding model" href="calibration_flooding.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="calibration_logistic.html" title="Calibration of the logistic model"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="calibration_flooding.html" title="Calibration of the flooding model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.14dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="calibration.html" accesskey="U">Calibration</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Calibration of the Chaboche mecanical model</a><ul>
<li><a class="reference internal" href="#Deterministic-model">Deterministic model</a></li>
<li><a class="reference internal" href="#Parameters-to-calibrate">Parameters to calibrate</a></li>
<li><a class="reference internal" href="#Observations">Observations</a></li>
<li><a class="reference internal" href="#Thanks-to">Thanks to</a></li>
<li><a class="reference internal" href="#References">References</a></li>
<li><a class="reference internal" href="#Generate-the-observations">Generate the observations</a></li>
<li><a class="reference internal" href="#A-calibration-analysis-class">A calibration analysis class</a></li>
<li><a class="reference internal" href="#Set-the-calibration-parameters">Set the calibration parameters</a></li>
<li><a class="reference internal" href="#Calibration-with-linear-least-squares">Calibration with linear least squares</a></li>
<li><a class="reference internal" href="#Analysis-of-the-results">Analysis of the results</a></li>
<li><a class="reference internal" href="#Calibration-with-nonlinear-least-squares">Calibration with nonlinear least squares</a></li>
<li><a class="reference internal" href="#Analysis-of-the-results">Analysis of the results</a></li>
<li><a class="reference internal" href="#Gaussian-calibration-parameters">Gaussian calibration parameters</a></li>
<li><a class="reference internal" href="#Gaussian-linear-calibration">Gaussian linear calibration</a></li>
<li><a class="reference internal" href="#Analysis-of-the-results">Analysis of the results</a></li>
<li><a class="reference internal" href="#Gaussian-nonlinear-calibration">Gaussian nonlinear calibration</a></li>
<li><a class="reference internal" href="#Analysis-of-the-results">Analysis of the results</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="calibration_flooding.html"
                        title="previous chapter">Calibration of the flooding model</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="calibration_logistic.html"
                        title="next chapter">Calibration of the logistic model</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/calibration/calibration_chaboche.ipynb"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Calibration-of-the-Chaboche-mecanical-model">
<h1>Calibration of the Chaboche mecanical model<a class="headerlink" href="#Calibration-of-the-Chaboche-mecanical-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Deterministic-model">
<h2>Deterministic model<a class="headerlink" href="#Deterministic-model" title="Permalink to this headline">¶</a></h2>
<p>The Chaboche mecanical law predicts the stress depending on the strain:</p>
<div class="math">
<p><img src="../../_images/math/bd7fdc83214b04f9104c6ea7d5a876350a62096c.svg" alt="\sigma = G(\epsilon,R,C,\gamma) = R + \frac{C}{\gamma} (1-\exp(-\gamma\epsilon))"/></p>
</div><p>where</p>
<ul class="simple">
<li><p><img class="math" src="../../_images/math/0d105e8ee3d8ee933b1f68424693c02a02189d3a.svg" alt="\epsilon" style="vertical-align: 0px"/> is the strain,</p></li>
<li><p><img class="math" src="../../_images/math/c407acdc527ca1937ae333fa8475cb95384c8087.svg" alt="\sigma" style="vertical-align: 0px"/> is the stress (Pa),</p></li>
<li><p><img class="math" src="../../_images/math/ddc35335d91f00501b1be972e341ffcba6893269.svg" alt="R" style="vertical-align: 0px"/>, <img class="math" src="../../_images/math/3b3be2405d41848960032b917a9b3d6e64e3ea81.svg" alt="C" style="vertical-align: 0px"/>, <img class="math" src="../../_images/math/92b1fba2de1ce37c8da793f184e1f3a622ac3afa.svg" alt="\gamma" style="vertical-align: -3px"/> are the parameters.</p></li>
</ul>
<p>The variables have the following distributions and are supposed to be independent.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Random var.</p></th>
<th class="head"><p>Distribution</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img class="math" src="../../_images/math/ddc35335d91f00501b1be972e341ffcba6893269.svg" alt="R" style="vertical-align: 0px"/></p></td>
<td><p>Lognormal (<img class="math" src="../../_images/math/c6473d21430daadc5aa560648baab71fc5aea34d.svg" alt="\mu = 750" style="vertical-align: -3px"/> MPa, <img class="math" src="../../_images/math/1869f089fa288608049db3155e3ba0096c8d4cda.svg" alt="\sigma = 11" style="vertical-align: 0px"/>)</p></td>
</tr>
<tr class="row-odd"><td><p><img class="math" src="../../_images/math/3b3be2405d41848960032b917a9b3d6e64e3ea81.svg" alt="C" style="vertical-align: 0px"/></p></td>
<td><p>Normal (<img class="math" src="../../_images/math/422cce3ab83c6d6ba5d743c6aac2f297e17ba2a7.svg" alt="\mu = 2750" style="vertical-align: -3px"/> MPa, <img class="math" src="../../_images/math/e303fd1c1f213d3a07a8c49277d148cb0d5b2180.svg" alt="\sigma = 250" style="vertical-align: 0px"/>)</p></td>
</tr>
<tr class="row-even"><td><p><img class="math" src="../../_images/math/92b1fba2de1ce37c8da793f184e1f3a622ac3afa.svg" alt="\gamma" style="vertical-align: -3px"/></p></td>
<td><p>Normal (<img class="math" src="../../_images/math/f86827601ea87fd03e3262e99493d8c90742c12e.svg" alt="\mu = 10" style="vertical-align: -3px"/>, <img class="math" src="../../_images/math/3942e2944f4378a66b55c2d49c2c34a087b090e2.svg" alt="\sigma = 2" style="vertical-align: 0px"/>)</p></td>
</tr>
<tr class="row-odd"><td><p><img class="math" src="../../_images/math/0d105e8ee3d8ee933b1f68424693c02a02189d3a.svg" alt="\epsilon" style="vertical-align: 0px"/></p></td>
<td><p>Uniform(a=0, b=0.07).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Parameters-to-calibrate">
<h2>Parameters to calibrate<a class="headerlink" href="#Parameters-to-calibrate" title="Permalink to this headline">¶</a></h2>
<p>The vector of parameters to calibrate is:</p>
<div class="math">
<p><img src="../../_images/math/8d115fd798ae574aab5b14d41fdf34d196e001a3.svg" alt="\theta = (R,C,\gamma)."/></p>
</div><p>We set :</p>
<ul class="simple">
<li><p><img class="math" src="../../_images/math/e913f3951b14fd1db7c9a0d19ba3346cc85f7934.svg" alt="R = 750\times 10^6" style="vertical-align: -1px"/>,</p></li>
<li><p><img class="math" src="../../_images/math/69b1ae5d366276e60ac6f8e664639882bab211e0.svg" alt="C = 2750\times 10^6" style="vertical-align: -1px"/>,</p></li>
<li><p><img class="math" src="../../_images/math/b92c5ba9194d807f880a872331ec50c85d79e574.svg" alt="\gamma = 10" style="vertical-align: -3px"/>.</p></li>
</ul>
</div>
<div class="section" id="Observations">
<h2>Observations<a class="headerlink" href="#Observations" title="Permalink to this headline">¶</a></h2>
<p>In order to create a calibration problem, we make the hypothesis that the strain has the following distribution:</p>
<div class="math">
<p><img src="../../_images/math/1ec616c0942470f99bd452523b2227b7fff5fff8.svg" alt="\epsilon \sim Uniform(0,0.07)."/></p>
</div><p>Moreover, we consider a gaussian noise on the observed constraint:</p>
<div class="math">
<p><img src="../../_images/math/45ef50774c0e89232d48b8aa2711bf6d5ccbfd0f.svg" alt="\epsilon_\sigma \sim \mathcal{N} \left(0,40\times 10^6\right)"/></p>
</div><p>and we make the hypothesis that the observation errors are independent. We set the number of observations to:</p>
<div class="math">
<p><img src="../../_images/math/298af68dada19e561b2b0514a66eea21824936e6.svg" alt="n = 100."/></p>
</div><p>We generate a Monte-Carlo samplg with size <img class="math" src="../../_images/math/80b394abd4fb264a3879675f92f191c3e346c3a0.svg" alt="n" style="vertical-align: 0px"/>:</p>
<div class="math">
<p><img src="../../_images/math/c8a71bc5b72ba0b3c0178f6815ba31991c6e89af.svg" alt="\sigma_i = G(\epsilon_i,R,C,\gamma) + (\epsilon_\sigma)_i,"/></p>
</div><p>for <img class="math" src="../../_images/math/bc47943f393ac295e9660a3a3ec9191cef7a1704.svg" alt="i = 1,..., n" style="vertical-align: -3px"/>. The observations are the pairs <img class="math" src="../../_images/math/d4b243df3fa42f032026f015480b6381573f482e.svg" alt="\{(\epsilon_i,\sigma_i)\}_{i=1,...,n}" style="vertical-align: -5px"/>, i.e. each observation is a couple made of the strain and the corresponding stress.</p>
</div>
<div class="section" id="Thanks-to">
<h2>Thanks to<a class="headerlink" href="#Thanks-to" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Antoine Dumas, Phimeca</p></li>
</ul>
</div>
<div class="section" id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><ol class="upperalpha simple" start="10">
<li><p>Lemaitre and J. L. Chaboche (2002) “Mechanics of solid materials” Cambridge University Press.</p></li>
</ol>
</li>
</ul>
</div>
<div class="section" id="Generate-the-observations">
<h2>Generate the observations<a class="headerlink" href="#Generate-the-observations" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="kn">as</span> <span class="nn">ot</span>
</pre></div>
</div>
</div>
<p>Define the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">modelChaboche</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">strain</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">strain</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">stress</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Create the Python function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">g</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">modelChaboche</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Define the random vector.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Strain</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.07</span><span class="p">)</span>
<span class="n">unknownR</span> <span class="o">=</span> <span class="mf">750e6</span>
<span class="n">unknownC</span> <span class="o">=</span> <span class="mf">2750e6</span>
<span class="n">unknownGamma</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Dirac</span><span class="p">(</span><span class="n">unknownR</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Dirac</span><span class="p">(</span><span class="n">unknownC</span><span class="p">)</span>
<span class="n">Gamma</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Dirac</span><span class="p">(</span><span class="n">unknownGamma</span><span class="p">)</span>

<span class="n">Strain</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;Strain&quot;</span><span class="p">])</span>
<span class="n">R</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;R&quot;</span><span class="p">])</span>
<span class="n">C</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">])</span>
<span class="n">Gamma</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;Gamma&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Create the joint input distribution function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">inputRandomVector</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">([</span><span class="n">Strain</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Create the Monte-Carlo sample.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampleSize</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">inputSample</span> <span class="o">=</span> <span class="n">inputRandomVector</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">)</span>
<span class="n">outputStress</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span>
<span class="n">outputStress</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<TABLE><TR><TD></TD><TH>y0</TH></TR>
<TR><TD>0</TD><TD>1730517161.8555112</TD></TR>
<TR><TD>1</TD><TD>2017637268.4224534</TD></TR>
<TR><TD>2</TD><TD>998457688.8730125</TD></TR>
<TR><TD>3</TD><TD>811861394.6134877</TD></TR>
<TR><TD>4</TD><TD>1343123774.9833345</TD></TR>
</TABLE></div>
</div>
<p>Plot the histogram of the output.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">histoGraph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">HistogramFactory</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">outputStress</span><span class="o">/</span><span class="mf">1.e6</span><span class="p">)</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
<span class="n">histoGraph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Histogram of the sample stress&quot;</span><span class="p">)</span>
<span class="n">histoGraph</span><span class="o">.</span><span class="n">setXTitle</span><span class="p">(</span><span class="s2">&quot;Stress (MPa)&quot;</span><span class="p">)</span>
<span class="n">histoGraph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
<span class="n">histoGraph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_14_0.png" src="../../_images/examples_calibration_calibration_chaboche_14_0.png" />
</div>
</div>
<p>Generate observation noise.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stressObservationNoiseSigma</span> <span class="o">=</span> <span class="mf">40.e6</span> <span class="c1"># (Pa)</span>
<span class="n">noiseSigma</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">stressObservationNoiseSigma</span><span class="p">)</span>
<span class="n">sampleNoiseH</span> <span class="o">=</span> <span class="n">noiseSigma</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">)</span>
<span class="n">observedStress</span> <span class="o">=</span> <span class="n">outputStress</span> <span class="o">+</span> <span class="n">sampleNoiseH</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">observedStrain</span> <span class="o">=</span> <span class="n">inputSample</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span><span class="s2">&quot;Strain&quot;</span><span class="p">,</span><span class="s2">&quot;Stress (MPa)&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">observedStrain</span><span class="p">,</span><span class="n">observedStress</span><span class="o">/</span><span class="mf">1.e6</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_18_0.png" src="../../_images/examples_calibration_calibration_chaboche_18_0.png" />
</div>
</div>
</div>
<div class="section" id="A-calibration-analysis-class">
<h2>A calibration analysis class<a class="headerlink" href="#A-calibration-analysis-class" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A graphics class to analyze the results of calibration.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="kn">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="kn">as</span> <span class="nn">otv</span>

<span class="k">class</span> <span class="nc">CalibrationAnalysis</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">calibrationResult</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the prior and posterior distribution of the calibrated parameter theta.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        calibrationResult : :class:`~openturns.calibrationResult`</span>
<span class="sd">            The result of a calibration.</span>

<span class="sd">        model : 2-d sequence of float</span>
<span class="sd">            The function to calibrate.</span>

<span class="sd">        inputObservations : :class:`~openturns.Sample`</span>
<span class="sd">            The sample of input values of the model linked to the observations.</span>

<span class="sd">        outputObservations : 2-d sequence of float</span>
<span class="sd">            The sample of output values of the model linked to the observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">calibrationResult</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observationColor</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priorColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posteriorColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span> <span class="o">=</span> <span class="n">inputObservations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span> <span class="o">=</span> <span class="n">outputObservations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># inch</span>
        <span class="c1"># Compute yAtPrior</span>
        <span class="n">meanPrior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPrior</span><span class="p">()</span><span class="o">.</span><span class="n">getMean</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="n">meanPrior</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">)</span>
        <span class="c1"># Compute yAtPosterior</span>
        <span class="n">meanPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span><span class="o">.</span><span class="n">getMean</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="n">meanPosterior</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">drawParameterDistributions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the prior and posterior distribution of the calibrated parameter theta.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thetaPrior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPrior</span><span class="p">()</span>
        <span class="n">thetaDescription</span> <span class="o">=</span> <span class="n">thetaPrior</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="n">thetaPosterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
        <span class="n">thetaDim</span> <span class="o">=</span> <span class="n">thetaPosterior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thetaDim</span><span class="p">):</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">thetaDescription</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">&quot;PDF&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;topright&quot;</span><span class="p">)</span>
            <span class="c1"># Prior distribution</span>
            <span class="n">thetaPrior_i</span> <span class="o">=</span> <span class="n">thetaPrior</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">priorPDF</span> <span class="o">=</span> <span class="n">thetaPrior_i</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="n">priorPDF</span><span class="o">.</span><span class="n">setColors</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">priorColor</span><span class="p">])</span>
            <span class="n">priorPDF</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Prior&quot;</span><span class="p">])</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">priorPDF</span><span class="p">)</span>
            <span class="c1"># Posterior distribution</span>
            <span class="n">thetaPosterior_i</span> <span class="o">=</span> <span class="n">thetaPosterior</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">postPDF</span> <span class="o">=</span> <span class="n">thetaPosterior_i</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="n">postPDF</span><span class="o">.</span><span class="n">setColors</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriorColor</span><span class="p">])</span>
            <span class="n">postPDF</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Posterior&quot;</span><span class="p">])</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">postPDF</span><span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            If the prior is a Dirac, set the vertical axis bounds to the posterior.</span>
<span class="sd">            Otherwise, the Dirac set to [0,1], where the 1 can be much larger</span>
<span class="sd">            than the maximum PDF of the posterior.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">thetaPrior_i</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;Dirac&quot;</span><span class="p">):</span>
                <span class="c1"># The vertical (PDF) bounds of the posterior</span>
                <span class="n">postbb</span> <span class="o">=</span> <span class="n">postPDF</span><span class="o">.</span><span class="n">getBoundingBox</span><span class="p">()</span>
                <span class="n">pdf_upper</span> <span class="o">=</span> <span class="n">postbb</span><span class="o">.</span><span class="n">getUpperBound</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pdf_lower</span> <span class="o">=</span> <span class="n">postbb</span><span class="o">.</span><span class="n">getLowerBound</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Set these bounds to the graph</span>
                <span class="n">bb</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">getBoundingBox</span><span class="p">()</span>
                <span class="n">graph_upper</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getUpperBound</span><span class="p">()</span>
                <span class="n">graph_upper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf_upper</span>
                <span class="n">bb</span><span class="o">.</span><span class="n">setUpperBound</span><span class="p">(</span><span class="n">graph_upper</span><span class="p">)</span>
                <span class="n">graph_lower</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getLowerBound</span><span class="p">()</span>
                <span class="n">graph_lower</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf_lower</span>
                <span class="n">bb</span><span class="o">.</span><span class="n">setLowerBound</span><span class="p">(</span><span class="n">graph_lower</span><span class="p">)</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">setBoundingBox</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
            <span class="c1"># Add it to the graphics</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">thetaDim</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">drawObservationsVsPredictions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the output of the model depending</span>
<span class="sd">        on the output observations before and after calibration.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ySize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="n">yDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span><span class="s2">&quot;Predictions&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
        <span class="c1"># Plot the diagonal</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawObservationsVsPredictions1Dimension</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ySize</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">outputObservations</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputAtPrior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawObservationsVsPredictions1Dimension</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span><span class="o">*</span><span class="n">yDim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yDim</span><span class="p">):</span>
                <span class="n">outputObservations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">outputAtPrior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawObservationsVsPredictions1Dimension</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">)</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yDim</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">_drawObservationsVsPredictions1Dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the output of the model depending</span>
<span class="sd">        on the output observations before and after calibration.</span>
<span class="sd">        Can manage only 1D samples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">yDim</span> <span class="o">=</span> <span class="n">outputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">ydescription</span> <span class="o">=</span> <span class="n">outputObservations</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Observations&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ydescription</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Predictions&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ydescription</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="n">ylabel</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
        <span class="c1"># Plot the diagonal</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span> <span class="n">outputObservations</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observationColor</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output observations are not 1D.&#39;</span><span class="p">)</span>
        <span class="c1"># Plot the predictions before</span>
        <span class="n">yPriorDim</span> <span class="o">=</span> <span class="n">outputAtPrior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yPriorDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span> <span class="n">outputAtPrior</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">priorColor</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Prior&quot;</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output prior predictions are not 1D.&#39;</span><span class="p">)</span>
        <span class="c1"># Plot the predictions after</span>
        <span class="n">yPosteriorDim</span> <span class="o">=</span> <span class="n">outputAtPosterior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yPosteriorDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span> <span class="n">outputAtPosterior</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriorColor</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Posterior&quot;</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output posterior predictions are not 1D.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">drawResiduals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of the residuals and</span>
<span class="sd">        the distribution of the observation errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ySize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="n">yDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">yPriorSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="n">yPriorDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">observationsError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawResiduals1Dimension</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">,</span><span class="n">observationsError</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ySize</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">outputObservations</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputAtPrior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">observationsError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
            <span class="c1"># In this case, we cannot draw observationsError ; just</span>
            <span class="c1"># pass the required input argument, but it is not actually used.</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawResiduals1Dimension</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">,</span><span class="n">observationsError</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observationsError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span><span class="o">*</span><span class="n">yDim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yDim</span><span class="p">):</span>
                <span class="n">outputObservations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">outputAtPrior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">observationsErrorYi</span> <span class="o">=</span> <span class="n">observationsError</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawResiduals1Dimension</span><span class="p">(</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">,</span><span class="n">observationsErrorYi</span><span class="p">)</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">yDim</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">_drawResiduals1Dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">,</span><span class="n">observationsError</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of the residuals and</span>
<span class="sd">        the distribution of the observation errors.</span>
<span class="sd">        Can manage only 1D samples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ydescription</span> <span class="o">=</span> <span class="n">outputObservations</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Residuals&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ydescription</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Residuals analysis&quot;</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="s2">&quot;Probability distribution function&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;topright&quot;</span><span class="p">)</span>
        <span class="n">yDim</span> <span class="o">=</span> <span class="n">outputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">yPriorDim</span> <span class="o">=</span> <span class="n">outputAtPrior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">yPosteriorDim</span> <span class="o">=</span> <span class="n">outputAtPrior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">yPriorDim</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">posteriorResiduals</span> <span class="o">=</span> <span class="n">outputObservations</span> <span class="o">-</span> <span class="n">outputAtPrior</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KernelSmoothing</span><span class="p">()</span>
            <span class="n">fittedDist</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">posteriorResiduals</span><span class="p">)</span>
            <span class="n">residualPDF</span> <span class="o">=</span> <span class="n">fittedDist</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="n">residualPDF</span><span class="o">.</span><span class="n">setColors</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">priorColor</span><span class="p">])</span>
            <span class="n">residualPDF</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Prior&quot;</span><span class="p">])</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">residualPDF</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output prior observations are not 1D.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">yPosteriorDim</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">posteriorResiduals</span> <span class="o">=</span> <span class="n">outputObservations</span> <span class="o">-</span> <span class="n">outputAtPosterior</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KernelSmoothing</span><span class="p">()</span>
            <span class="n">fittedDist</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">posteriorResiduals</span><span class="p">)</span>
            <span class="n">residualPDF</span> <span class="o">=</span> <span class="n">fittedDist</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="n">residualPDF</span><span class="o">.</span><span class="n">setColors</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriorColor</span><span class="p">])</span>
            <span class="n">residualPDF</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Posterior&quot;</span><span class="p">])</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">residualPDF</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output posterior observations are not 1D.&#39;</span><span class="p">)</span>
        <span class="c1"># Plot the distribution of the observation errors</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">observationsError</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># In the other case, we just do not plot</span>
            <span class="n">obserrgraph</span> <span class="o">=</span> <span class="n">observationsError</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
            <span class="n">obserrgraph</span><span class="o">.</span><span class="n">setColors</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">observationColor</span><span class="p">])</span>
            <span class="n">obserrgraph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Observation errors&quot;</span><span class="p">])</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obserrgraph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">drawObservationsVsInputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the observed output of the model depending</span>
<span class="sd">        on the observed input before and after calibration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="n">ySize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="n">xDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">yDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">xdescription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="n">ydescription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="c1"># Observations</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xDim</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawObservationsVsInputs1Dimension</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">xSize</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ySize</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">inputObservations</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputObservations</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputAtPrior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawObservationsVsInputs1Dimension</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">xDim</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span><span class="p">,</span> <span class="n">yDim</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unitlength</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xDim</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yDim</span><span class="p">):</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">xDim</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="n">i</span>
                    <span class="n">inputObservations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputObservations</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">outputObservations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputObservations</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">outputAtPrior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPrior</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">outputAtPosterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputAtPosterior</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawObservationsVsInputs1Dimension</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">)</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">yDim</span><span class="p">,</span> <span class="n">xDim</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">_drawObservationsVsInputs1Dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the observed output of the model depending</span>
<span class="sd">        on the observed input before and after calibration.</span>
<span class="sd">        Can manage only 1D samples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xDim</span> <span class="o">=</span> <span class="n">inputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xDim</span><span class="o">!=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input observations are not 1D.&#39;</span><span class="p">)</span>
        <span class="n">yDim</span> <span class="o">=</span> <span class="n">outputObservations</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="n">xdescription</span> <span class="o">=</span> <span class="n">inputObservations</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="n">ydescription</span> <span class="o">=</span> <span class="n">outputObservations</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">xdescription</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ydescription</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;topright&quot;</span><span class="p">)</span>
        <span class="c1"># Observations</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputObservations</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observationColor</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Observations&quot;</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output observations are not 1D.&#39;</span><span class="p">)</span>
        <span class="c1"># Model outputs before calibration</span>
        <span class="n">yPriorDim</span> <span class="o">=</span> <span class="n">outputAtPrior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yPriorDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputAtPrior</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">priorColor</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Prior&quot;</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output prior predictions are not 1D.&#39;</span><span class="p">)</span>
        <span class="c1"># Model outputs after calibration</span>
        <span class="n">yPosteriorDim</span> <span class="o">=</span> <span class="n">outputAtPosterior</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yPosteriorDim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputObservations</span><span class="p">,</span><span class="n">outputAtPosterior</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriorColor</span><span class="p">)</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Posterior&quot;</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Output posterior predictions are not 1D.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Set-the-calibration-parameters">
<h2>Set the calibration parameters<a class="headerlink" href="#Set-the-calibration-parameters" title="Permalink to this headline">¶</a></h2>
<p>Define the value of the reference values of the <img class="math" src="../../_images/math/7e3e48300089e25fc3edb19ddc60fb5e8bbfea3d.svg" alt="\theta" style="vertical-align: 0px"/> parameter. In the bayesian framework, this is called the mean of the <em>prior</em> gaussian distribution. In the data assimilation framework, this is called the <em>background</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">R</span> <span class="o">=</span> <span class="mf">700e6</span> <span class="c1"># Exact : 750e6</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">2500e6</span> <span class="c1"># Exact : 2750e6</span>
<span class="n">Gamma</span> <span class="o">=</span> <span class="mf">8.</span> <span class="c1"># Exact : 10</span>
<span class="n">thetaPrior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Point</span><span class="p">([</span><span class="n">R</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">Gamma</span><span class="p">])</span>

</pre></div>
</div>
</div>
<p>The following statement create the calibrated function from the model. The calibrated parameters Ks, Zv, Zm are at indices 1, 2, 3 in the inputs arguments of the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibratedIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">mycf</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ParametricFunction</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">calibratedIndices</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Calibration-with-linear-least-squares">
<h2>Calibration with linear least squares<a class="headerlink" href="#Calibration-with-linear-least-squares" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">LinearLeastSquaresCalibration</span></code> class performs the linear least squares calibration by linearizing the model in the neighbourhood of the reference point.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearLeastSquaresCalibration</span><span class="p">(</span><span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span><span class="s2">&quot;SVD&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> method computes the solution of the problem.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#Analysis-of-the-results" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">getParameterMAP</span></code> method returns the maximum of the posterior distribution of <img class="math" src="../../_images/math/7e3e48300089e25fc3edb19ddc60fb5e8bbfea3d.svg" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="n">thetaMAP</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7.46352e+08,2.71632e+09,10.2126]</p></div>
</div>
<p>We can compute a 95% confidence interval of the parameter <img class="math" src="../../_images/math/b57c014f32c1e20b3d05757fc29e0d77fec3cb67.svg" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="n">thetaPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7.10731e+08, 7.81973e+08]<br>
[1.93186e+09, 3.50079e+09]<br>
[-774.441, 794.867]</p></div>
</div>
<p>We can see that all three parameters are estimated with a large confidence interval.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span> <span class="o">=</span> <span class="n">CalibrationAnalysis</span><span class="p">(</span><span class="n">calibrationResult</span><span class="p">,</span> <span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_39_0.png" src="../../_images/examples_calibration_calibration_chaboche_39_0.png" />
</div>
</div>
<p>We see that there is a good fit after calibration, since the predictions after calibration (i.e. the green crosses) are close to the observations (i.e. the blue crosses).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_41_0.png" src="../../_images/examples_calibration_calibration_chaboche_41_0.png" />
</div>
</div>
<p>We see that there is a much better fit after calibration, since the predictions are close to the diagonal of the graphics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">observationError</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
<span class="n">observationError</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>Normal(mu = 0, sigma = 4.4426e+07)</p></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_44_0.png" src="../../_images/examples_calibration_calibration_chaboche_44_0.png" />
</div>
</div>
<p>The analysis of the residuals shows that the distribution is centered on zero and symmetric. This indicates that the calibration performed well.</p>
<p>Moreover, the distribution of the residuals is close to being gaussian.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_46_0.png" src="../../_images/examples_calibration_calibration_chaboche_46_0.png" />
</div>
</div>
</div>
<div class="section" id="Calibration-with-nonlinear-least-squares">
<h2>Calibration with nonlinear least squares<a class="headerlink" href="#Calibration-with-nonlinear-least-squares" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">NonLinearLeastSquaresCalibration</span></code> class performs the non linear least squares calibration by minimizing the squared euclidian norm between the predictions and the observations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">NonLinearLeastSquaresCalibration</span><span class="p">(</span><span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> method computes the solution of the problem.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#Analysis-of-the-results" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">getParameterMAP</span></code> method returns the maximum of the posterior distribution of <img class="math" src="../../_images/math/7e3e48300089e25fc3edb19ddc60fb5e8bbfea3d.svg" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="n">thetaMAP</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7.46745e+08,2.82138e+09,9.65458]</p></div>
</div>
<p>We can compute a 95% confidence interval of the parameter <img class="math" src="../../_images/math/b57c014f32c1e20b3d05757fc29e0d77fec3cb67.svg" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="n">thetaPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7.11003e+08, 7.79964e+08]<br>
[2.31024e+09, 3.38452e+09]<br>
[7.35939, 12.9378]</p></div>
</div>
<p>We can see that all three parameters are estimated with a large confidence interval.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span> <span class="o">=</span> <span class="n">CalibrationAnalysis</span><span class="p">(</span><span class="n">calibrationResult</span><span class="p">,</span><span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_60_0.png" src="../../_images/examples_calibration_calibration_chaboche_60_0.png" />
</div>
</div>
<p>We see that there is a good fit after calibration, since the predictions after calibration (i.e. the green crosses) are close to the observations (i.e. the blue crosses).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_62_0.png" src="../../_images/examples_calibration_calibration_chaboche_62_0.png" />
</div>
</div>
<p>We see that there is a much better fit after calibration, since the predictions are close to the diagonal of the graphics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">observationError</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
<span class="n">observationError</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>Normal(mu = -37300.8, sigma = 4.39724e+07)</p></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">observationError</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_65_0.png" src="../../_images/examples_calibration_calibration_chaboche_65_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_66_0.png" src="../../_images/examples_calibration_calibration_chaboche_66_0.png" />
</div>
</div>
<p>The analysis of the residuals shows that the distribution is centered on zero and symmetric. This indicates that the calibration performed well.</p>
<p>Moreover, the distribution of the residuals is close to being gaussian. This indicates that the observation error might be gaussian.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_68_0.png" src="../../_images/examples_calibration_calibration_chaboche_68_0.png" />
</div>
</div>
</div>
<div class="section" id="Gaussian-calibration-parameters">
<h2>Gaussian calibration parameters<a class="headerlink" href="#Gaussian-calibration-parameters" title="Permalink to this headline">¶</a></h2>
<p>The standard deviation of the observations errors.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sigmaStress</span> <span class="o">=</span> <span class="mf">1.e7</span> <span class="c1"># (Pa)</span>
</pre></div>
</div>
</div>
<p>Define the covariance matrix of the output Y of the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">errorCovariance</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">errorCovariance</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaStress</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<p>Define the covariance matrix of the parameters <img class="math" src="../../_images/math/7e3e48300089e25fc3edb19ddc60fb5e8bbfea3d.svg" alt="\theta" style="vertical-align: 0px"/> to calibrate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sigmaR</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">R</span>
<span class="n">sigmaC</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">C</span>
<span class="n">sigmaGamma</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Gamma</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaR</span><span class="o">**</span><span class="mi">2</span>
<span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaC</span><span class="o">**</span><span class="mi">2</span>
<span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigmaGamma</span><span class="o">**</span><span class="mi">2</span>
<span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[[ 4.9e+15  0        0        ]<br>
 [ 0        6.25e+16 0        ]<br>
 [ 0        0        0.64     ]]</p></div>
</div>
</div>
<div class="section" id="Gaussian-linear-calibration">
<h2>Gaussian linear calibration<a class="headerlink" href="#Gaussian-linear-calibration" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">GaussianLinearCalibration</span></code> class performs the gaussian linear calibration by linearizing the model in the neighbourhood of the prior.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussianLinearCalibration</span><span class="p">(</span><span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">errorCovariance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> method computes the solution of the problem.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#Analysis-of-the-results" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">getParameterMAP</span></code> method returns the maximum of the posterior distribution of <img class="math" src="../../_images/math/7e3e48300089e25fc3edb19ddc60fb5e8bbfea3d.svg" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="n">thetaMAP</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7e+08,2.5e+09,11.6727]</p></div>
</div>
<p>We can compute a 95% confidence interval of the parameter <img class="math" src="../../_images/math/b57c014f32c1e20b3d05757fc29e0d77fec3cb67.svg" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="n">thetaPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[5.45374e+08, 8.54626e+08]<br>
[1.94776e+09, 3.05224e+09]<br>
[8.69845, 14.647]</p></div>
</div>
<p>We can see that all three parameters are estimated with a large confidence interval.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span> <span class="o">=</span> <span class="n">CalibrationAnalysis</span><span class="p">(</span><span class="n">calibrationResult</span><span class="p">,</span><span class="n">mycf</span><span class="p">,</span><span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_90_0.png" src="../../_images/examples_calibration_calibration_chaboche_90_0.png" />
</div>
</div>
<p>We see that there is a good fit after calibration, since the predictions after calibration (i.e. the green crosses) are close to the observations (i.e. the blue crosses).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_92_0.png" src="../../_images/examples_calibration_calibration_chaboche_92_0.png" />
</div>
</div>
<p>We see that there is a much better fit after calibration, since the predictions are close to the diagonal of the graphics.</p>
<p>The observation error is predicted by linearizing the problem at the prior.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">observationError</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
<span class="n">observationError</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>Normal(mu = 0, sigma = 1e+07)</p></div>
</div>
<p>This can be compared to the residuals distribution, which is computed at the posterior.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_97_0.png" src="../../_images/examples_calibration_calibration_chaboche_97_0.png" />
</div>
</div>
<p>The analysis of the distribution of the residuals (the blue line) shows that the distribution is centered on zero and symmetric. This indicates that the calibration performed well. Moreover, the distribution of the residuals is close to being gaussian.</p>
<p>The observation error distribution (in green) is much narrower than the actual residuals distribution. This shows that the prior observations error underestimated the actual error distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_99_0.png" src="../../_images/examples_calibration_calibration_chaboche_99_0.png" />
</div>
</div>
<p>We see that the prior and posterior distribution are close to each other for the <img class="math" src="../../_images/math/3b3be2405d41848960032b917a9b3d6e64e3ea81.svg" alt="C" style="vertical-align: 0px"/> variable: the observations did not convey much information for this variable.</p>
</div>
<div class="section" id="Gaussian-nonlinear-calibration">
<h2>Gaussian nonlinear calibration<a class="headerlink" href="#Gaussian-nonlinear-calibration" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">GaussianNonLinearCalibration</span></code> class performs the gaussian nonlinear calibration.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussianNonLinearCalibration</span><span class="p">(</span><span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">,</span> <span class="n">thetaPrior</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">errorCovariance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> method computes the solution of the problem.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrationResult</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Analysis-of-the-results">
<h2>Analysis of the results<a class="headerlink" href="#Analysis-of-the-results" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">getParameterMAP</span></code> method returns the maximum of the posterior distribution of <img class="math" src="../../_images/math/7e3e48300089e25fc3edb19ddc60fb5e8bbfea3d.svg" alt="\theta" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaMAP</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterMAP</span><span class="p">()</span>
<span class="n">thetaMAP</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7.48474e+08,2.85698e+09,9.47817]</p></div>
</div>
<p>We can compute a 95% confidence interval of the parameter <img class="math" src="../../_images/math/b57c014f32c1e20b3d05757fc29e0d77fec3cb67.svg" alt="\theta^\star" style="vertical-align: 0px"/>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">thetaPosterior</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getParameterPosterior</span><span class="p">()</span>
<span class="n">thetaPosterior</span><span class="o">.</span><span class="n">computeBilateralConfidenceIntervalWithMarginalProbability</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>[7.13061e+08, 7.78661e+08]<br>
[2.39992e+09, 3.49179e+09]<br>
[7.10121, 11.9421]</p></div>
</div>
<p>We can see that all three parameters are estimated with a large confidence interval.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span> <span class="o">=</span> <span class="n">CalibrationAnalysis</span><span class="p">(</span><span class="n">calibrationResult</span><span class="p">,</span><span class="n">mycf</span><span class="p">,</span> <span class="n">observedStrain</span><span class="p">,</span> <span class="n">observedStress</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsInputs</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topleft&quot;</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_114_0.png" src="../../_images/examples_calibration_calibration_chaboche_114_0.png" />
</div>
</div>
<p>We see that there is a good fit after calibration, since the predictions after calibration (i.e. the green crosses) are close to the observations (i.e. the blue crosses).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span><span class="o">.</span><span class="n">drawObservationsVsPredictions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_116_0.png" src="../../_images/examples_calibration_calibration_chaboche_116_0.png" />
</div>
</div>
<p>We see that there is a much better fit after calibration, since the predictions are close to the diagonal of the graphics.</p>
<p>The observation error is predicted by bootstraping the problem at the posterior.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">observationError</span> <span class="o">=</span> <span class="n">calibrationResult</span><span class="o">.</span><span class="n">getObservationsError</span><span class="p">()</span>
<span class="n">observationError</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<p>Normal(mu = 0, sigma = 1e+07)</p></div>
</div>
<p>This can be compared to the residuals distribution, which is computed at the posterior.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypcr</span><span class="o">.</span><span class="n">drawResiduals</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_121_0.png" src="../../_images/examples_calibration_calibration_chaboche_121_0.png" />
</div>
</div>
<p>The analysis of the distribution of the residuals (the blue line) shows that the distribution is approximately centered on zero and symmetric. This indicates that the calibration performed well. Moreover, the distribution of the residuals is close to being gaussian.</p>
<p>The prior observation error distribution (in green) is much narrower than the actual residuals distribution. This shows that the prior observation error distribution underestimated the actual errors.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mypcr</span><span class="o">.</span><span class="n">drawParameterDistributions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_calibration_calibration_chaboche_123_0.png" src="../../_images/examples_calibration_calibration_chaboche_123_0.png" />
</div>
</div>
<p>We see that the prior and posterior distribution are close to each other, but not superimposed: the observations significantly brought information during the calibration.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="calibration_logistic.html" title="Calibration of the logistic model"
             >next</a> |</li>
        <li class="right" >
          <a href="calibration_flooding.html" title="Calibration of the flooding model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.14dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="calibration.html" >Calibration</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2018 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 01, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0+/4491bbaa1.
    </div>
  </body>
</html>