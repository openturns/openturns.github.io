
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>EfficientGlobalOptimization examples &#8212; OpenTURNS 1.22 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Iterative statistics" href="../iterative_statistics/index.html" />
    <link rel="prev" title="Optimization using dlib" href="plot_optimization_dlib.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../iterative_statistics/index.html" title="Iterative statistics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_optimization_dlib.html" title="Optimization using dlib"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Numerical methods</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Optimization</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">EfficientGlobalOptimization examples</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">EfficientGlobalOptimization examples</a><ul>
<li><a class="reference internal" href="#ackley-test-case">Ackley test-case</a><ul>
<li><a class="reference internal" href="#define-the-problem">Define the problem</a></li>
<li><a class="reference internal" href="#create-the-initial-kriging">Create the initial kriging</a></li>
<li><a class="reference internal" href="#create-the-optimization-problem">Create the optimization problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#branin-test-case">Branin test-case</a><ul>
<li><a class="reference internal" href="#id1">Define the problem</a></li>
<li><a class="reference internal" href="#id2">Create the initial kriging</a></li>
<li><a class="reference internal" href="#create-and-solve-the-problem">Create and solve the problem</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_optimization_dlib.html"
                          title="previous chapter">Optimization using dlib</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../iterative_statistics/index.html"
                          title="next chapter">Iterative statistics</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_numerical_methods/optimization/plot_ego.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-numerical-methods-optimization-plot-ego-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="efficientglobaloptimization-examples">
<span id="sphx-glr-auto-numerical-methods-optimization-plot-ego-py"></span><h1>EfficientGlobalOptimization examples<a class="headerlink" href="#efficientglobaloptimization-examples" title="Permalink to this heading">¶</a></h1>
<p>The EGO algorithm (Jones, 1998) is an adaptative optimization method based on
kriging.</p>
<p>An initial design of experiment is used to build a first metamodel.
At each iteration a new point that maximizes a criterion is chosen as
optimizer candidate.</p>
<p>The criterion uses a tradeoff between the metamodel value and the conditional
variance.</p>
<p>Then the new point is evaluated using the original model and the metamodel is
relearnt on the extended design of experiment.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">branin_function</span>
<span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">ackley_function</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">viewer</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">ot</span><span class="o">.</span><span class="n">RandomGenerator</span><span class="o">.</span><span class="n">SetSeed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsString</span><span class="p">(</span><span class="s2">&quot;KrigingAlgorithm-LinearAlgebra&quot;</span><span class="p">,</span> <span class="s2">&quot;LAPACK&quot;</span><span class="p">)</span>
<span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
</pre></div>
</div>
<section id="ackley-test-case">
<h2>Ackley test-case<a class="headerlink" href="#ackley-test-case" title="Permalink to this heading">¶</a></h2>
<p>We first apply the EGO algorithm on the <a class="reference internal" href="../../usecases/use_case_ackley.html#use-case-ackley"><span class="std std-ref">Ackley function</span></a>.</p>
<section id="define-the-problem">
<h3>Define the problem<a class="headerlink" href="#define-the-problem" title="Permalink to this heading">¶</a></h3>
<p>The Ackley model is defined in the usecases module in a data class <cite>AckleyModel</cite> :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">am</span> <span class="o">=</span> <span class="n">ackley_function</span><span class="o">.</span><span class="n">AckleyModel</span><span class="p">()</span>
</pre></div>
</div>
<p>We get the Ackley function :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">model</span>
</pre></div>
</div>
<p>We specify the domain of the model :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dim</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">dim</span>
<span class="n">lowerbound</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">4.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span>
<span class="n">upperbound</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span>
</pre></div>
</div>
<p>We know that the global minimum is at the center of the domain. It is stored in the <cite>AckleyModel</cite> data class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">xexact</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="n">x0</span>
</pre></div>
</div>
<p>The minimum value attained <cite>fexact</cite> is :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fexact</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">xexact</span><span class="p">)</span>
<span class="n">fexact</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=1 values=[4.44089e-16]
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">upperbound</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Ackley function&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_001.png" srcset="../../_images/sphx_glr_plot_ego_001.png" alt="Ackley function" class = "sphx-glr-single-img"/><p>We see that the Ackley function has many local minimas. The global minimum, however, is unique and located at the center of the domain.</p>
</section>
<section id="create-the-initial-kriging">
<h3>Create the initial kriging<a class="headerlink" href="#create-the-initial-kriging" title="Permalink to this heading">¶</a></h3>
<p>Before using the EGO algorithm, we must create an initial kriging.
In order to do this, we must create a design of experiment which fills the space.
In this situation, the <cite>LHSExperiment</cite> is a good place to start (but other design of experiments may allow one to better fill the space).
We use a uniform distribution in order to create a LHS design with 50 points.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">listUniformDistributions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">upperbound</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">distribution</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">(</span><span class="n">listUniformDistributions</span><span class="p">)</span>
<span class="n">sampleSize</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LHSExperiment</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">sampleSize</span><span class="p">)</span>
<span class="n">inputSample</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
<span class="n">outputSample</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
    <span class="s2">&quot;Initial LHS design of experiment - n=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sampleSize</span><span class="p">),</span> <span class="s2">&quot;$x_0$&quot;</span><span class="p">,</span> <span class="s2">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="kc">True</span>
<span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_002.png" srcset="../../_images/sphx_glr_plot_ego_002.png" alt="Initial LHS design of experiment - n=50" class = "sphx-glr-single-img"/><p>We now create the kriging metamodel. We selected the <cite>SquaredExponential</cite> covariance model with a constant basis (the <cite>MaternModel</cite> may perform better in this case).
We use default settings (1.0) for the scale parameters of the covariance model, but configure the amplitude to 0.1, which better corresponds to the properties of the Ackley function.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">])</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ConstantBasisFactory</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">kriging</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">inputSample</span><span class="p">,</span> <span class="n">outputSample</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">kriging</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="create-the-optimization-problem">
<h3>Create the optimization problem<a class="headerlink" href="#create-the-optimization-problem" title="Permalink to this heading">¶</a></h3>
<p>We finally create the <cite>OptimizationProblem</cite> and solve it with <cite>EfficientGlobalOptimization</cite>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">OptimizationProblem</span><span class="p">()</span>
<span class="n">problem</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">upperbound</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">setBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to show the various options, we configure them all, even if most could be left to default settings in this case.</p>
<p>The most important method is <cite>setMaximumEvaluationNumber</cite> which limits the number of iterations that the algorithm can perform.
In the Ackley example, we choose to perform 10 iterations of the algorithm.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">EfficientGlobalOptimization</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">kriging</span><span class="o">.</span><span class="n">getResult</span><span class="p">())</span>
<span class="n">algo</span><span class="o">.</span><span class="n">setMaximumEvaluationNumber</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getIterationNumber</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getOptimalPoint</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=2 values=[0.0119045,0.17423]
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getOptimalValue</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=1 values=[1.13576]
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fexact</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=1 values=[4.44089e-16]
</div>
<br />
<br /><p>Compared to the minimum function value, we see that the EGO algorithm
provides solution which is not very accurate.
However, the optimal point is in the neighbourhood of the exact solution,
and this is quite an impressive success given the limited amount of function
evaluations: only 60 evaluations for the initial DOE and 10 iterations of
the EGO algorithm, for a total equal to 70 function evaluations.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">drawOptimalValueHistory</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_003.png" srcset="../../_images/sphx_glr_plot_ego_003.png" alt="Optimal value history" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">inputHistory</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getInputSample</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">upperbound</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Ackley function&quot;</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputSample</span><span class="p">,</span> <span class="s2">&quot;initial&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="s2">&quot;bullet&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputHistory</span><span class="p">,</span> <span class="s2">&quot;solution&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="s2">&quot;diamond&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;forestgreen&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_004.png" srcset="../../_images/sphx_glr_plot_ego_004.png" alt="Ackley function" class = "sphx-glr-single-img"/><p>We see that the initial (black) points are dispersed in the whole domain,
while the solution points are much closer to the solution.</p>
<p>However, the final solution produced by the EGO algorithm is not very accurate.
This is why we finalize the process by adding a local optimization step.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">algo2</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">NLopt</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="s2">&quot;LD_LBFGS&quot;</span><span class="p">)</span>
<span class="n">algo2</span><span class="o">.</span><span class="n">setStartingPoint</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">getOptimalPoint</span><span class="p">())</span>
<span class="n">algo2</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo2</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getOptimalPoint</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=2 values=[1.0076e-07,-1.09416e-06]
</div>
<br />
<br /><p>The corrected solution is now extremely accurate.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">drawOptimalValueHistory</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_005.png" srcset="../../_images/sphx_glr_plot_ego_005.png" alt="Optimal value history" class = "sphx-glr-single-img"/></section>
</section>
<section id="branin-test-case">
<h2>Branin test-case<a class="headerlink" href="#branin-test-case" title="Permalink to this heading">¶</a></h2>
<p>We now take a look at the <a class="reference internal" href="../../usecases/use_case_branin.html#use-case-branin"><span class="std std-ref">Branin-Hoo</span></a> function.</p>
<section id="id1">
<h3>Define the problem<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>The Branin model is defined in the usecases module in a data class <cite>BraninModel</cite> :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bm</span> <span class="o">=</span> <span class="n">branin_function</span><span class="o">.</span><span class="n">BraninModel</span><span class="p">()</span>
</pre></div>
</div>
<p>We load the dimension,</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dim</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">dim</span>
</pre></div>
</div>
<p>the domain boundaries,</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">lowerbound</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">lowerbound</span>
<span class="n">upperbound</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">upperbound</span>
</pre></div>
</div>
<p>and we load the model function and its noise :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">objectiveFunction</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">model</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">bm</span><span class="o">.</span><span class="n">noiseModel</span>
</pre></div>
</div>
<p>We build a sample out of the three minima :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">xexact</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">([</span><span class="n">bm</span><span class="o">.</span><span class="n">xexact1</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">xexact2</span><span class="p">,</span> <span class="n">bm</span><span class="o">.</span><span class="n">xexact3</span><span class="p">])</span>
</pre></div>
</div>
<p>The minimum value attained <cite>fexact</cite> is :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fexact</span> <span class="o">=</span> <span class="n">objectiveFunction</span><span class="p">(</span><span class="n">xexact</span><span class="p">)</span>
<span class="n">fexact</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<table>
  <tr><td></td><th>y0</th></tr>
  <tr><th>0</th><td>-1.04741</td></tr>
  <tr><th>1</th><td>-1.04741</td></tr>
  <tr><th>2</th><td>-1.04741</td></tr>
</table>
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">objectiveFunction</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">upperbound</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Branin function&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_006.png" srcset="../../_images/sphx_glr_plot_ego_006.png" alt="Branin function" class = "sphx-glr-single-img"/><p>The Branin function has three local minimas.</p>
</section>
<section id="id2">
<h3>Create the initial kriging<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">distribution</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">([</span><span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">sampleSize</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LHSExperiment</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">sampleSize</span><span class="p">)</span>
<span class="n">inputSample</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
<span class="n">outputSample</span> <span class="o">=</span> <span class="n">objectiveFunction</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span>
<span class="n">noiseSample</span> <span class="o">=</span> <span class="n">noise</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
    <span class="s2">&quot;Initial LHS design of experiment - n=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sampleSize</span><span class="p">),</span> <span class="s2">&quot;$x_0$&quot;</span><span class="p">,</span> <span class="s2">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="kc">True</span>
<span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_007.png" srcset="../../_images/sphx_glr_plot_ego_007.png" alt="Initial LHS design of experiment - n=50" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ConstantBasisFactory</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">kriging</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">inputSample</span><span class="p">,</span> <span class="n">outputSample</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">kriging</span><span class="o">.</span><span class="n">setNoise</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">noiseSample</span><span class="p">])</span>
<span class="n">kriging</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="create-and-solve-the-problem">
<h3>Create and solve the problem<a class="headerlink" href="#create-and-solve-the-problem" title="Permalink to this heading">¶</a></h3>
<p>We define the problem :</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">OptimizationProblem</span><span class="p">()</span>
<span class="n">problem</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">objectiveFunction</span><span class="p">)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">upperbound</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">setBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
<p>We configure the algorithm, with the model noise:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">EfficientGlobalOptimization</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">kriging</span><span class="o">.</span><span class="n">getResult</span><span class="p">(),</span> <span class="n">noise</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">setMaximumEvaluationNumber</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>We run the algorithm and get the result:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getIterationNumber</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>20
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getOptimalPoint</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=2 values=[0.547929,0.166692]
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getOptimalValue</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
class=Point name=Unnamed dimension=1 values=[-1.04529]
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fexact</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<table>
  <tr><td></td><th>y0</th></tr>
  <tr><th>0</th><td>-1.04741</td></tr>
  <tr><th>1</th><td>-1.04741</td></tr>
  <tr><th>2</th><td>-1.04741</td></tr>
</table>
</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">inputHistory</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getInputSample</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">objectiveFunction</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">upperbound</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Branin function&quot;</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputSample</span><span class="p">,</span> <span class="s2">&quot;initial&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="s2">&quot;bullet&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">inputHistory</span><span class="p">,</span> <span class="s2">&quot;solution&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="s2">&quot;diamond&quot;</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s2">&quot;forestgreen&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_008.png" srcset="../../_images/sphx_glr_plot_ego_008.png" alt="Branin function" class = "sphx-glr-single-img"/><p>We see that the EGO algorithm found the second local minimum.
Given the limited number of function evaluations, the other local minimas have not been explored.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">drawOptimalValueHistory</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">axes_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">getIterationNumber</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_ego_009.png" srcset="../../_images/sphx_glr_plot_ego_009.png" alt="Optimal value history" class = "sphx-glr-single-img"/><p>Reset default settings</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">Reload</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.444 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-numerical-methods-optimization-plot-ego-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/b663e1b1b3c4d94b9641214799794e94/plot_ego.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_ego.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4346f1b4e6973c226ebe5a1caa84d80e/plot_ego.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_ego.py</span></code></a></p>
</div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../iterative_statistics/index.html" title="Iterative statistics"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_optimization_dlib.html" title="Optimization using dlib"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Numerical methods</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Optimization</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">EfficientGlobalOptimization examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2023 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 13, 2024.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>