
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Posterior sampling using a PythonDistribution &#8212; OpenTURNS 1.20rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customize your Metropolis-Hastings algorithm" href="plot_ackley_distribution.html" />
    <link rel="prev" title="Bayesian calibration of the flooding model" href="plot_bayesian_calibration_flooding.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_ackley_distribution.html" title="Customize your Metropolis-Hastings algorithm"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_bayesian_calibration_flooding.html" title="Bayesian calibration of the flooding model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Calibration</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Bayesian calibration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Posterior sampling using a PythonDistribution</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Posterior sampling using a PythonDistribution</a><ul>
<li><a class="reference internal" href="#set-up-the-pythondistribution">Set up the PythonDistribution</a></li>
<li><a class="reference internal" href="#observations-prior-initial-point-and-proposal-distributions">Observations, prior, initial point and proposal distributions</a></li>
<li><a class="reference internal" href="#sample-from-the-posterior-distribution">Sample from the posterior distribution</a></li>
<li><a class="reference internal" href="#define-an-improper-prior">Define an improper prior</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_bayesian_calibration_flooding.html"
                          title="previous chapter">Bayesian calibration of the flooding model</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_ackley_distribution.html"
                          title="next chapter">Customize your Metropolis-Hastings algorithm</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_calibration/bayesian_calibration/plot_rwmh_python_distribution.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-calibration-bayesian-calibration-plot-rwmh-python-distribution-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="posterior-sampling-using-a-pythondistribution">
<span id="sphx-glr-auto-calibration-bayesian-calibration-plot-rwmh-python-distribution-py"></span><h1>Posterior sampling using a PythonDistribution<a class="headerlink" href="#posterior-sampling-using-a-pythondistribution" title="Permalink to this heading">Â¶</a></h1>
<p>In this example we are going to show how to do Bayesian inference using the <a class="reference internal" href="../../user_manual/_generated/openturns.RandomWalkMetropolisHastings.html#openturns.RandomWalkMetropolisHastings" title="openturns.RandomWalkMetropolisHastings"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomWalkMetropolisHastings</span></code></a> algorithm in a statistical model defined through a <a class="reference internal" href="../../user_manual/_generated/openturns.PythonDistribution.html#openturns.PythonDistribution" title="openturns.PythonDistribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonDistribution</span></code></a>.</p>
<p>This method is illustrated on a simple lifetime study test-case, which involves censored data, as described hereafter.</p>
<p>In the following, we assume that the lifetime <img class="math" src="_images/math/f6c3e1d7741065d7e251473d0e8b92613674a081.svg" alt="T_i"/> of an industrial component follows the Weibull distribution <img class="math" src="_images/math/e5f7c53cf81f79ddf61386bbdb6feb752495d7b1.svg" alt="\mathcal W(\alpha, \beta)"/>, with CDF  given by <img class="math" src="_images/math/766181a4239d6b978c9181d62fb3dbf59a589204.svg" alt="F(t|\alpha,\beta)= 1 - e^{-\left( \frac{t}{\beta} \right)^\alpha}"/>.</p>
<p>Our goal is to estimate the model parameters <img class="math" src="_images/math/bf56a11d36fbf4065e0875b84ddca00a1ced3f60.svg" alt="\alpha, \beta"/> based on
a dataset of recorded failures <img class="math" src="_images/math/7548b2f4fbceac2a1f69d9bf79aeb7257762984c.svg" alt="(t_1, \ldots, t_n),"/> some of which
correspond to actual failures, and the remaining are right-censored.
Let <img class="math" src="_images/math/8a545531b28d6961a898f7a3dbeef8d93a6d347d.svg" alt="(f_1, \ldots, f_n) \in \{0,1\}^n"/> represent the nature of each
datum, <img class="math" src="_images/math/5db77b45bd2f6edf85fbe58f76ab13f4f6a289fb.svg" alt="f_i=1"/> if <img class="math" src="_images/math/fcb3cfa69252d24756c9e4dcb6d35afce8fbae12.svg" alt="t_i"/> corresponds to an actual failure,
<img class="math" src="_images/math/48c8b4bf0624e2f08cb871fe2df9d43bc8f4ba49.svg" alt="f_i=0"/> if it is right-censored.</p>
<p>Note that the likelihood of each recorded failure is given by the Weibull density:</p>
<div class="math">
<p><img src="_images/math/f550e6ba2073e2aa903b47924ec7765af92b6b5a.svg" alt="\mathcal L(t_i | f_i=1, \alpha, \beta) = \frac{\alpha}{\beta}\left( \frac{t_i}{\beta} \right)^{\alpha-1} e^{-\left( \frac{t_i}{\beta} \right)^\alpha}."/></p>
</div><p>On the other hand, the likelihood of each right-censored observation is given by:</p>
<div class="math">
<p><img src="_images/math/5f62d6197dd00656f155bb9a0e4e62351fc24204.svg" alt="\mathcal L(t_i | f_i=0, \alpha, \beta) = e^{-\left( \frac{t_i}{\beta} \right)^\alpha}."/></p>
</div><p>Furthermore, assume that the prior information available on <img class="math" src="_images/math/bf56a11d36fbf4065e0875b84ddca00a1ced3f60.svg" alt="\alpha, \beta"/> is represented by independent prior laws, whose respective densities are denoted by <img class="math" src="_images/math/7e1e963e2f794e8d4675731a2bf984c00e02bbcf.svg" alt="\pi(\alpha)"/> and <img class="math" src="_images/math/e8e577ea1b73fd5f377feac339483a32d3983a34.svg" alt="\pi(\beta)."/></p>
<p>The posterior distribution of <img class="math" src="_images/math/93b25032ea0a7d49d2bed0a84cad46beddf7ad27.svg" alt="(\alpha, \beta)"/> represents the update of the prior information on <img class="math" src="_images/math/93b25032ea0a7d49d2bed0a84cad46beddf7ad27.svg" alt="(\alpha, \beta)"/> given the dataset.
Its PDF is known up to a multiplicative constant:</p>
<div class="math">
<p><img src="_images/math/6db4b719840eaf4fc123770a416178a5c5b0c070.svg" alt="\pi(\alpha, \beta | (t_1, f_1), \ldots, (t_n, f_n) ) \propto \pi(\alpha)\pi(\beta) \left(\frac{\alpha}{\beta}\right)^{\sum_i f_i} \left(\prod_{f_i = 1} \frac{t_i}{\beta}\right)^{\alpha-1} \exp\left[-\sum_{i=1}^n\left(\frac{t_i}{\beta}\right)^\alpha\right]."/></p>
</div><p>The <a class="reference internal" href="../../user_manual/_generated/openturns.RandomWalkMetropolisHastings.html#openturns.RandomWalkMetropolisHastings" title="openturns.RandomWalkMetropolisHastings"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomWalkMetropolisHastings</span></code></a> class can be used to sample from the posterior distribution. It relies on the following objects:</p>
<ul class="simple">
<li><p>The prior probability density <img class="math" src="_images/math/ff30759ee1e0e76e3742bd99291f8787b7bfa51e.svg" alt="\pi(\vect{\theta})"/> reflects beliefs about the possible values
of <img class="math" src="_images/math/ede2e03babfe0983a8522abf9f5f6783c3ac8c55.svg" alt="\vect{\theta} = (\alpha, \beta)"/> before the experimental data are considered.</p></li>
<li><p>Initial values <img class="math" src="_images/math/99b1a0d3c100010764c1c978cb0f316635dc42f4.svg" alt="\vect{\theta}_0"/> of the parameters.</p></li>
<li><p>An proposal distribution used to update parameters.</p></li>
</ul>
<p>Additionnaly we want to define the likelihood term defined by these objects:</p>
<ul class="simple">
<li><p>The conditional density <img class="math" src="_images/math/fb0716823fc0c1ba8ff926481b6883318b04c38a.svg" alt="p(t_{1:n}|f_{1:n}, \alpha, \beta)"/> will be defined as a <a class="reference internal" href="../../user_manual/_generated/openturns.PythonDistribution.html#openturns.PythonDistribution" title="openturns.PythonDistribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonDistribution</span></code></a>.</p></li>
<li><p>The sample of observations acting as the parameters of the conditional density</p></li>
</ul>
<section id="set-up-the-pythondistribution">
<h2>Set up the PythonDistribution<a class="headerlink" href="#set-up-the-pythondistribution" title="Permalink to this heading">Â¶</a></h2>
<p>The censured Weibuill likelihood is outside the usual catalog of probability distributions in OpenTURNS, hence we need to define it using the <a class="reference internal" href="../../user_manual/_generated/openturns.PythonDistribution.html#openturns.PythonDistribution" title="openturns.PythonDistribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonDistribution</span></code></a> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">from</span> <span class="nn">openturns.viewer</span> <span class="kn">import</span> <span class="n">View</span>

<span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
<span class="n">ot</span><span class="o">.</span><span class="n">RandomGenerator</span><span class="o">.</span><span class="n">SetSeed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
<p>The following methods must be defined:</p>
<ul class="simple">
<li><p><cite>getRange</cite>: required for conversion to the <a class="reference internal" href="../../user_manual/_generated/openturns.Distribution.html#openturns.Distribution" title="openturns.Distribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">Distribution</span></code></a> format</p></li>
<li><p><cite>computeLogPDF</cite>: used by <a class="reference internal" href="../../user_manual/_generated/openturns.RandomWalkMetropolisHastings.html#openturns.RandomWalkMetropolisHastings" title="openturns.RandomWalkMetropolisHastings"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomWalkMetropolisHastings</span></code></a> to evaluate the posterior density</p></li>
<li><p><cite>setParameter</cite> used by <a class="reference internal" href="../../user_manual/_generated/openturns.RandomWalkMetropolisHastings.html#openturns.RandomWalkMetropolisHastings" title="openturns.RandomWalkMetropolisHastings"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomWalkMetropolisHastings</span></code></a> to test new parameter values</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We formally define a bivariate distribution on the <img class="math" src="_images/math/d8077652d6f9fde27494ecd5ddd11c085550b6db.svg" alt="(t_i, f_i)"/> couple, even though <img class="math" src="_images/math/b3502feb800e7dbad184ce52cc259b6245a9426a.svg" alt="f_i"/> has no distribution (it is simply a covariate).
This is not an issue, since the sole purpose of this <a class="reference internal" href="../../user_manual/_generated/openturns.PythonDistribution.html#openturns.PythonDistribution" title="openturns.PythonDistribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">PythonDistribution</span></code></a> object is to pass the likelihood calculation over to <a class="reference internal" href="../../user_manual/_generated/openturns.RandomWalkMetropolisHastings.html#openturns.RandomWalkMetropolisHastings" title="openturns.RandomWalkMetropolisHastings"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomWalkMetropolisHastings</span></code></a>.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CensoredWeibull</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">PythonDistribution</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Right-censored Weibull log-PDF calculation</span>
<span class="sd">    Each data point x is assumed 2D, with:</span>
<span class="sd">        x[0]: observed functioning time</span>
<span class="sd">        x[1]: nature of x[0]:</span>
<span class="sd">            if x[1]=0: x[0] is a censoring time</span>
<span class="sd">            if x[1]=1: x[0] is a time-to failure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CensoredWeibull</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>

    <span class="k">def</span> <span class="nf">getRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">computeLogPDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">log_pdf</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log_pdf</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">log_pdf</span>

    <span class="k">def</span> <span class="nf">setParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">]</span>
</pre></div>
</div>
<p>Convert to <a class="reference internal" href="../../user_manual/_generated/openturns.Distribution.html#openturns.Distribution" title="openturns.Distribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">Distribution</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conditional</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Distribution</span><span class="p">(</span><span class="n">CensoredWeibull</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="observations-prior-initial-point-and-proposal-distributions">
<h2>Observations, prior, initial point and proposal distributions<a class="headerlink" href="#observations-prior-initial-point-and-proposal-distributions" title="Permalink to this heading">Â¶</a></h2>
<p>Define the observations</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Tobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4380</span><span class="p">,</span> <span class="mi">1791</span><span class="p">,</span> <span class="mi">1611</span><span class="p">,</span> <span class="mi">1291</span><span class="p">,</span> <span class="mi">6132</span><span class="p">,</span> <span class="mi">5694</span><span class="p">,</span> <span class="mi">5296</span><span class="p">,</span> <span class="mi">4818</span><span class="p">,</span> <span class="mi">4818</span><span class="p">,</span> <span class="mi">4380</span><span class="p">])</span>
<span class="n">fail</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">Tobs</span><span class="p">,</span> <span class="n">fail</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<p>Define a uniform prior distribution for <img class="math" src="_images/math/586e8e332570955fa6dfcb1ba54f5ce2823c0fb7.svg" alt="\alpha"/> and a Gamma prior distribution for <img class="math" src="_images/math/233b263354a1b8b4463fe36dd42563b01bed21f3.svg" alt="\beta"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alpha_min</span><span class="p">,</span> <span class="n">alpha_max</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.8</span>
<span class="n">a_beta</span><span class="p">,</span> <span class="n">b_beta</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2e-4</span>

<span class="n">priorCopula</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">IndependentCopula</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># prior independence</span>
<span class="n">priorMarginals</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># prior marginals</span>
<span class="n">priorMarginals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Gamma</span><span class="p">(</span><span class="n">a_beta</span><span class="p">,</span> <span class="n">b_beta</span><span class="p">))</span>  <span class="c1"># Gamma prior for beta</span>
<span class="n">priorMarginals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">alpha_min</span><span class="p">,</span> <span class="n">alpha_max</span><span class="p">))</span>  <span class="c1"># uniform prior for alpha</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">(</span><span class="n">priorMarginals</span><span class="p">,</span> <span class="n">priorCopula</span><span class="p">)</span>
<span class="n">prior</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>We select prior means as the initial point of the Metropolis-Hastings algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">initialState</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_beta</span> <span class="o">/</span> <span class="n">b_beta</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha_max</span> <span class="o">-</span> <span class="n">alpha_min</span><span class="p">)]</span>
</pre></div>
</div>
<p>For our random walk proposal distributions, we choose normal steps, with standard deviation equal to roughly <img class="math" src="_images/math/fbac0dcee38c1fc243e883fee312ca7a7d9d318d.svg" alt="10\%"/> of the prior range (for the uniform prior) or standard deviation (for the normal prior).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proposal</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">proposal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_beta</span> <span class="o">/</span> <span class="n">b_beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">proposal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha_max</span> <span class="o">-</span> <span class="n">alpha_min</span><span class="p">)))</span>
<span class="n">proposal</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sample-from-the-posterior-distribution">
<h2>Sample from the posterior distribution<a class="headerlink" href="#sample-from-the-posterior-distribution" title="Permalink to this heading">Â¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">RandomWalkMetropolisHastings</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">initialState</span><span class="p">,</span> <span class="n">proposal</span><span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">setLikelihood</span><span class="p">(</span><span class="n">conditional</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">sampleSize</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">)</span>
<span class="c1"># compute acceptance rate</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Acceptance rate: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">getAcceptanceRate</span><span class="p">()))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Acceptance rate: 0.7194
</pre></div>
</div>
<p>Plot prior to posterior marginal plots.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kernel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KernelSmoothing</span><span class="p">()</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GridLayout</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Bayesian inference&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">parameter_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">parameter_index</span><span class="p">)</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
    <span class="n">priorGraph</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">parameter_index</span><span class="p">)</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">priorGraph</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="o">.</span><span class="n">BuildDefaultPalette</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Posterior&quot;</span><span class="p">,</span> <span class="s2">&quot;Prior&quot;</span><span class="p">])</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">setGraph</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parameter_index</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_rwmh_python_distribution_001.png" srcset="../../_images/sphx_glr_plot_rwmh_python_distribution_001.png" alt="Bayesian inference" class = "sphx-glr-single-img"/></section>
<section id="define-an-improper-prior">
<h2>Define an improper prior<a class="headerlink" href="#define-an-improper-prior" title="Permalink to this heading">Â¶</a></h2>
<p>Now, define an improper prior:</p>
<div class="math">
<p><img src="_images/math/cc8e460b7b158c274a6b39ef4aed629ce3277d19.svg" alt="\mathcal \pi(\beta, \alpha) \propto \frac{1}{\beta}."/></p>
</div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">logpdf</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;-log(beta)&quot;</span><span class="p">])</span>
<span class="n">support</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Interval</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">support</span><span class="o">.</span><span class="n">setFiniteUpperBound</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Sample from the posterior distribution</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampler2</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">RandomWalkMetropolisHastings</span><span class="p">(</span><span class="n">logpdf</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">initialState</span><span class="p">,</span> <span class="n">proposal</span><span class="p">)</span>
<span class="n">sampler2</span><span class="o">.</span><span class="n">setLikelihood</span><span class="p">(</span><span class="n">conditional</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">sample2</span> <span class="o">=</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Acceptance rate: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sampler2</span><span class="o">.</span><span class="n">getAcceptanceRate</span><span class="p">()))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Acceptance rate: 0.729
</pre></div>
</div>
<p>Plot posterior marginal plots only as prior cannot be drawn meaningfully.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kernel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KernelSmoothing</span><span class="p">()</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GridLayout</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Bayesian inference (with log-pdf)&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">parameter_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">parameter_index</span><span class="p">)</span><span class="o">.</span><span class="n">drawPDF</span><span class="p">()</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="o">.</span><span class="n">BuildDefaultPalette</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setLegends</span><span class="p">([</span><span class="s2">&quot;Posterior&quot;</span><span class="p">])</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">setGraph</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parameter_index</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

<span class="n">View</span><span class="o">.</span><span class="n">ShowAll</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_rwmh_python_distribution_002.png" srcset="../../_images/sphx_glr_plot_rwmh_python_distribution_002.png" alt="Bayesian inference (with log-pdf)" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  7.037 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-calibration-bayesian-calibration-plot-rwmh-python-distribution-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/8e126c6456a3c1920cbd867d4b8d3e20/plot_rwmh_python_distribution.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_rwmh_python_distribution.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/941ea6116c4e723b549c21ca31a783eb/plot_rwmh_python_distribution.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_rwmh_python_distribution.ipynb</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_ackley_distribution.html" title="Customize your Metropolis-Hastings algorithm"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_bayesian_calibration_flooding.html" title="Bayesian calibration of the flooding model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Calibration</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Bayesian calibration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Posterior sampling using a PythonDistribution</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Oct 27, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>