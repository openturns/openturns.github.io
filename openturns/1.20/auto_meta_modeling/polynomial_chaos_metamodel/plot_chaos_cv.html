
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Chaos cross-validation &#8212; OpenTURNS 1.20rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Polynomial chaos is sensitive to the degree" href="plot_chaos_beam_sensitivity_degree.html" />
    <link rel="prev" title="Plot enumeration rules" href="plot_enumeratefunction.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_chaos_beam_sensitivity_degree.html" title="Polynomial chaos is sensitive to the degree"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_enumeratefunction.html" title="Plot enumeration rules"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Polynomial chaos metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Chaos cross-validation</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_enumeratefunction.html"
                          title="previous chapter">Plot enumeration rules</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_chaos_beam_sensitivity_degree.html"
                          title="next chapter">Polynomial chaos is sensitive to the degree</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/polynomial_chaos_metamodel/plot_chaos_cv.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-cv-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="chaos-cross-validation">
<span id="sphx-glr-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-cv-py"></span><h1>Chaos cross-validation<a class="headerlink" href="#chaos-cross-validation" title="Permalink to this heading">Â¶</a></h1>
<p>In this example, we show how to perform the cross-validation of the
<a class="reference internal" href="../../usecases/use_case_ishigami.html#use-case-ishigami"><span class="std std-ref">Ishigami model</span></a> using polynomial chaos expansion.
More precisely, we use the methods suggested in <a class="reference internal" href="../../bibliography.html#muller2016" id="id1"><span>[muller2016]</span></a>, chapter 5, page 257.
We make the assumption that a dataset is given and we create a metamodel using this data.
Once done, we want to assess the quality of the metamodel using the data we have.</p>
<p>We compare several methods:</p>
<ul class="simple">
<li><p>split the data into two subsets, one for training and one for testing,</p></li>
<li><p>use k-fold validation.</p></li>
</ul>
<p>The split of the data is performed by the <cite>compute_Q2_score_by_splitting</cite> function below.
It uses 75% of the data to estimate the coefficients of the metamodel (this is the training step)
and use 25% of the data to estimate the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score (this is the validation step).
To do this, we use the <cite>split</cite> method of the <a class="reference internal" href="../../user_manual/_generated/openturns.Sample.html#openturns.Sample" title="openturns.Sample"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sample</span></code></a>.</p>
<p>The K-Fold validation is performed by the <cite>compute_Q2_score_by_kfold</cite> function below.
It uses the K-Fold method with <img class="math" src="../../_images/math/bab022bfbcc475983bf779c0cc791fcdaf7ad424.svg" alt="k = 5"/>.
The code uses the <a class="reference internal" href="../../user_manual/_generated/openturns.KFoldSplitter.html#openturns.KFoldSplitter" title="openturns.KFoldSplitter"><code class="xref py py-class docutils literal notranslate"><span class="pre">KFoldSplitter</span></code></a> class, which computes the appropriate indices.
Similar results can be obtained with <a class="reference internal" href="../../user_manual/_generated/openturns.LeaveOneOutSplitter.html#openturns.LeaveOneOutSplitter" title="openturns.LeaveOneOutSplitter"><code class="xref py py-class docutils literal notranslate"><span class="pre">LeaveOneOutSplitter</span></code></a> at a higher cost.</p>
<p>This cross-validation method is used here to see which polynomial degree
leads to an accurate metamodel of the Ishigami test function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
<span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">ishigami_function</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_sparse_least_squares_chaos</span><span class="p">(</span>
    <span class="n">inputTrain</span><span class="p">,</span> <span class="n">outputTrain</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">distribution</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a sparse polynomial chaos based on least squares.</span>

<span class="sd">    * Uses the enumerate rule in basis.</span>
<span class="sd">    * Uses the LeastSquaresStrategy to compute the coefficients based on</span>
<span class="sd">      least squares.</span>
<span class="sd">    * Uses LeastSquaresMetaModelSelectionFactory to use the LARS selection method.</span>
<span class="sd">    * Uses FixedStrategy in order to keep all the coefficients that the</span>
<span class="sd">      LARS method selected.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    inputTrain : Sample</span>
<span class="sd">        The input design of experiments.</span>
<span class="sd">    outputTrain : Sample</span>
<span class="sd">        The output design of experiments.</span>
<span class="sd">    basis : Basis</span>
<span class="sd">        The multivariate chaos basis.</span>
<span class="sd">    totalDegree : int</span>
<span class="sd">        The total degree of the chaos polynomial.</span>
<span class="sd">    distribution : Distribution.</span>
<span class="sd">        The distribution of the input variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : PolynomialChaosResult</span>
<span class="sd">        The estimated polynomial chaos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selectionAlgorithm</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LeastSquaresMetaModelSelectionFactory</span><span class="p">()</span>
    <span class="n">projectionStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LeastSquaresStrategy</span><span class="p">(</span>
        <span class="n">inputTrain</span><span class="p">,</span> <span class="n">outputTrain</span><span class="p">,</span> <span class="n">selectionAlgorithm</span>
    <span class="p">)</span>
    <span class="n">enumfunc</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">getEnumerateFunction</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">enumfunc</span><span class="o">.</span><span class="n">getStrataCumulatedCardinal</span><span class="p">(</span><span class="n">totalDegree</span><span class="p">)</span>
    <span class="n">adaptiveStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FixedStrategy</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">chaosalgo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosAlgorithm</span><span class="p">(</span>
        <span class="n">inputTrain</span><span class="p">,</span> <span class="n">outputTrain</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">adaptiveStrategy</span><span class="p">,</span> <span class="n">projectionStrategy</span>
    <span class="p">)</span>
    <span class="n">chaosalgo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">chaosalgo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_Q2_score_by_splitting</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">split_fraction</span><span class="o">=</span><span class="mf">0.75</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Q2 score by splitting into train/test sets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : Sample(size, input_dimension)</span>
<span class="sd">        The X dataset.</span>
<span class="sd">    Y : Sample(size, output_dimension)</span>
<span class="sd">        The Y dataset.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Q2_score : float</span>
<span class="sd">        The Q2 score.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">training_sample_size</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">Y_train</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">split_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_fraction</span> <span class="o">*</span> <span class="n">training_sample_size</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_index</span><span class="p">)</span>
    <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y_train</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_index</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">compute_sparse_least_squares_chaos</span><span class="p">(</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">distribution</span>
    <span class="p">)</span>
    <span class="n">metamodel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
    <span class="n">Q2_score</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Q2_score</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_Q2_score_by_kfold</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute score by KFold.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : Sample(size, input_dimension)</span>
<span class="sd">        The X dataset.</span>
<span class="sd">    Y : Sample(size, output_dimension)</span>
<span class="sd">        The Y dataset.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Q2_score : float</span>
<span class="sd">        The Q2 score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">training_sample_size</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KFoldSplitter</span><span class="p">(</span><span class="n">training_sample_size</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">)</span>
    <span class="n">Q2_score_list</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">indices1</span><span class="p">,</span> <span class="n">indices2</span> <span class="ow">in</span> <span class="n">splitter</span><span class="p">:</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">indices1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">indices2</span><span class="p">]</span>
        <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">indices1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">indices2</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">compute_sparse_least_squares_chaos</span><span class="p">(</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">distribution</span>
        <span class="p">)</span>
        <span class="n">metamodel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
        <span class="n">Q2_local</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Q2_score_list</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">Q2_local</span><span class="p">])</span>
    <span class="n">Q2_score</span> <span class="o">=</span> <span class="n">Q2_score_list</span><span class="o">.</span><span class="n">computeMean</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Q2_score</span>
</pre></div>
</div>
<p>We start by generating the input and output sample. We use a sample size equal to 1000.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">im</span> <span class="o">=</span> <span class="n">ishigami_function</span><span class="o">.</span><span class="n">IshigamiModel</span><span class="p">()</span>
<span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;$X_0$&quot;</span><span class="p">,</span> <span class="s2">&quot;$X_1$&quot;</span><span class="p">,</span> <span class="s2">&quot;$X_2$&quot;</span><span class="p">])</span>
<span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setOutputDescription</span><span class="p">([</span><span class="s2">&quot;$Y$&quot;</span><span class="p">])</span>
<span class="n">ot</span><span class="o">.</span><span class="n">RandomGenerator</span><span class="o">.</span><span class="n">SetSeed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input sample:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Y</span><span class="o">.</span><span class="n">setDescription</span><span class="p">([</span><span class="s2">&quot;$Y$&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output sample:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Input sample:
    [ $X_0$     $X_1$     $X_2$     ]
0 : [  0.816038  2.67553   0.501506 ]
1 : [  2.40524  -2.19212  -0.705186 ]
2 : [ -2.29163   1.30032  -1.41281  ]
3 : [ -2.93737  -0.733649  2.30831  ]
4 : [ -0.960969 -0.43361  -2.39129  ]
Output sample:
    [ $Y$      ]
0 : [  2.14659 ]
1 : [  5.31621 ]
2 : [  5.44969 ]
3 : [  2.35982 ]
4 : [ -2.26455 ]
</pre></div>
</div>
<p>We compute a polynomial chaos decomposition with a total degree equal to 5.
In order to reduce the number of coefficients, the <cite>compute_sparse_least_squares_chaos</cite>
function creates a sparse chaos using regression and the LARS method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">OrthogonalProductPolynomialFactory</span><span class="p">(</span>
    <span class="p">[</span><span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">getMarginal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">totalDegree</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Polynomial degree</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">compute_sparse_least_squares_chaos</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="p">)</span>
<span class="n">metamodel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to validate our polynomial chaos, we generate an extra pair of
input / output samples and use the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.MetaModelValidation.html#openturns.MetaModelValidation" title="openturns.MetaModelValidation"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaModelValidation</span></code></a> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_sample_size</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># Size of the validation design of experiments</span>
<span class="n">inputTest</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">test_sample_size</span><span class="p">)</span>
<span class="n">outputTest</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">inputTest</span><span class="p">)</span>
<span class="n">validation</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">inputTest</span><span class="p">,</span> <span class="n">outputTest</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
<span class="n">Q2</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">drawValidation</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Q2=</span><span class="si">%.2f</span><span class="s2">, n=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Q2</span><span class="p">,</span> <span class="n">test_sample_size</span><span class="p">))</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_cv_001.png" srcset="../../_images/sphx_glr_plot_chaos_cv_001.png" alt="Q2=0.85, n=200" class = "sphx-glr-single-img"/><p>The plot shows that the score is relatively high and might be satisfactory for some purposes.
There are however several issues with the previous procedure:</p>
<ul class="simple">
<li><p>It may happen that the data in the validation sample with size 200 is more
difficult to fit than the data in the training dataset.
In this case, the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score may be pessimistic.</p></li>
<li><p>It may happen that the data in the validation sample with size 200 is
less difficult to fit than the data in the validation dataset.
In this case, the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score may be optimistic.</p></li>
<li><p>We may not be able to generate an extra dataset for validation.
In this case, a part of the original dataset should be used for validation.</p></li>
<li><p>The polynomial degree may not be appropriate for this data.</p></li>
<li><p>The dataset may be ordered in some way, so that the split is somewhat arbitrary.
One solution to circumvent this is to randomly shuffle the data.
This can be done using the <a class="reference internal" href="../../user_manual/_generated/openturns.KPermutationsDistribution.html#openturns.KPermutationsDistribution" title="openturns.KPermutationsDistribution"><code class="xref py py-class docutils literal notranslate"><span class="pre">KPermutationsDistribution</span></code></a>.</p></li>
</ul>
<p>The K-Fold validation aims at solving some of these issues, so that all the
available data is used in order to estimate the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score.</p>
<p>In the following script, we compute the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score associated with each polynomial degree from 1 to 10.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">degree_max</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">degree_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree_max</span><span class="p">))</span>
<span class="n">n_degrees</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">degree_list</span><span class="p">)</span>
<span class="n">score_sample</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">degree_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_degrees</span><span class="p">):</span>
    <span class="n">totalDegree</span> <span class="o">=</span> <span class="n">degree_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">score_sample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_Q2_score_by_splitting</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;split - degree = </span><span class="si">{</span><span class="n">totalDegree</span><span class="si">}</span><span class="s2">, score = </span><span class="si">{</span><span class="n">score_sample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>split - degree = 1, score = 0.2099
split - degree = 2, score = 0.2400
split - degree = 3, score = 0.4943
split - degree = 4, score = 0.7599
split - degree = 5, score = 0.8438
split - degree = 6, score = 0.9777
split - degree = 7, score = 0.9903
split - degree = 8, score = 0.9996
split - degree = 9, score = 0.9998
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Split&quot;</span><span class="p">,</span> <span class="s2">&quot;Degree&quot;</span><span class="p">,</span> <span class="s2">&quot;$Q^2$&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="o">.</span><span class="n">BuildFromPoint</span><span class="p">(</span><span class="n">degree_list</span><span class="p">),</span> <span class="n">score_sample</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_cv_002.png" srcset="../../_images/sphx_glr_plot_chaos_cv_002.png" alt="Split" class = "sphx-glr-single-img"/><p>We see that the polynomial degree may be increased up to degree 7,
after which the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score does not increase much.</p>
<p>One limitation of the previous method is that the estimate of the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> may be sensitive to the particular split of the dataset.
The following script uses 5-Fold cross validation to estimate the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">score_sample</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">degree_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_degrees</span><span class="p">):</span>
    <span class="n">totalDegree</span> <span class="o">=</span> <span class="n">degree_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">score_sample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_Q2_score_by_kfold</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">totalDegree</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">distributionX</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;k-fold, degree = </span><span class="si">{</span><span class="n">totalDegree</span><span class="si">}</span><span class="s2">, score = </span><span class="si">{</span><span class="n">score_sample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>k-fold, degree = 1, score = 0.1836
k-fold, degree = 2, score = 0.2017
k-fold, degree = 3, score = 0.4549
k-fold, degree = 4, score = 0.7208
k-fold, degree = 5, score = 0.8423
k-fold, degree = 6, score = 0.9783
k-fold, degree = 7, score = 0.9904
k-fold, degree = 8, score = 0.9996
k-fold, degree = 9, score = 0.9998
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;K-Fold&quot;</span><span class="p">,</span> <span class="s2">&quot;Degree&quot;</span><span class="p">,</span> <span class="s2">&quot;$Q^2$&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="o">.</span><span class="n">BuildFromPoint</span><span class="p">(</span><span class="n">degree_list</span><span class="p">),</span> <span class="n">score_sample</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_chaos_cv_003.png" srcset="../../_images/sphx_glr_plot_chaos_cv_003.png" alt="K-Fold" class = "sphx-glr-single-img"/><p>The conclusion is similar to the previous method.</p>
<p>When we select the best polynomial degree which maximizes the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score,
the danger is that the validation set is used both for computing the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> and to maximize it:
hence, the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score may be optimistic.
In <a class="reference internal" href="../../bibliography.html#muller2016" id="id2"><span>[muller2016]</span></a>, chapter 5, page 269, the authors advocate the split of the dataset into three subsets:</p>
<ul class="simple">
<li><p>the training set,</p></li>
<li><p>the validation set,</p></li>
<li><p>the test set.</p></li>
</ul>
<p>When selecting the best parameters, the validation set is used.
When estimating the <img class="math" src="../../_images/math/431f883847b598c249512efc815fa32340c7c170.svg" alt="Q^2"/> score with the best parameters, the test set is used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">ShowAll</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  52.290 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-polynomial-chaos-metamodel-plot-chaos-cv-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/377968eba2ffc6abbeeb24f6178efd7c/plot_chaos_cv.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_chaos_cv.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4d8faa63fdd3f872206132c1bb17eda4/plot_chaos_cv.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_chaos_cv.ipynb</span></code></a></p>
</div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_chaos_beam_sensitivity_degree.html" title="Polynomial chaos is sensitive to the degree"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_enumeratefunction.html" title="Plot enumeration rules"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.20rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Polynomial chaos metamodel</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Chaos cross-validation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2022 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Oct 12, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3.
    </div>
  </body>
</html>