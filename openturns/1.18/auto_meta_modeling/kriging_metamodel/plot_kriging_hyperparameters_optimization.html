
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Kriging :configure the optimization solver &#8212; OpenTURNS 1.18rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Kriging: metamodel of the Branin-Hoo function" href="plot_kriging_branin_function.html" />
    <link rel="prev" title="Kriging : generate trajectories from a metamodel" href="plot_kriging_simulate.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_kriging_branin_function.html" title="Kriging: metamodel of the Branin-Hoo function"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_kriging_simulate.html" title="Kriging : generate trajectories from a metamodel"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.18rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" accesskey="U">Meta modeling</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Kriging :configure the optimization solver</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Kriging :configure the optimization solver</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#definition-of-the-model">Definition of the model</a></li>
<li><a class="reference internal" href="#create-the-design-of-experiments">Create the design of experiments</a></li>
<li><a class="reference internal" href="#create-the-metamodel">Create the metamodel</a></li>
<li><a class="reference internal" href="#get-the-optimizer-algorithm">Get the optimizer algorithm</a></li>
<li><a class="reference internal" href="#configure-the-starting-point-of-the-optimization">Configure the starting point of the optimization</a></li>
<li><a class="reference internal" href="#disabling-the-optimization">Disabling the optimization</a></li>
<li><a class="reference internal" href="#reuse-the-parameters-from-a-previous-optimization">Reuse the parameters from a previous optimization</a></li>
<li><a class="reference internal" href="#configure-the-optimization-solver">Configure the optimization solver</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_kriging_simulate.html"
                        title="previous chapter">Kriging : generate trajectories from a metamodel</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plot_kriging_branin_function.html"
                        title="next chapter">Kriging: metamodel of the Branin-Hoo function</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/kriging_metamodel/plot_kriging_hyperparameters_optimization.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-kriging-metamodel-plot-kriging-hyperparameters-optimization-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="kriging-configure-the-optimization-solver">
<span id="sphx-glr-auto-meta-modeling-kriging-metamodel-plot-kriging-hyperparameters-optimization-py"></span><h1>Kriging :configure the optimization solver<a class="headerlink" href="#kriging-configure-the-optimization-solver" title="Permalink to this headline">¶</a></h1>
<p>The goal of this example is to show how to fine-tune the optimization solver used to estimate the hyperparameters of the covariance model of the kriging metamodel.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In a kriging metamodel, there are various types of parameters which are estimated from the data.</p>
<ul class="simple">
<li><p>The parameters <img class="math" src="../../_images/math/ba8c3934bef7762b6f11c66f00b1c03834953d03.svg" alt="{\bf \beta}"/> associated with the deterministic trend. These parameters are computed based on linear least squares.</p></li>
<li><p>The parameters of the covariance model.</p></li>
</ul>
<p>The covariance model has two types of parameters.</p>
<ul class="simple">
<li><p>The amplitude parameter <img class="math" src="../../_images/math/7dabcde7325f224a1ec280df7ac76466686c4959.svg" alt="\sigma^2"/> is estimated from the data. If the output dimension is equal to one, this parameter is estimated using the analytic variance estimator which maximizes the likelihood. Otherwise, if output dimension is greater than one or analytical sigma disabled, this parameter is estimated from numerical optimization.</p></li>
<li><p>The other parameters <img class="math" src="../../_images/math/0c30ba072f0a7acbc6eae9a8107a0f445fe73272.svg" alt="{\bf \theta}\in\mathbb{R}^d"/> where <img class="math" src="../../_images/math/5da6e6d65e4ae3032c58fe8c94955247fc4ebe22.svg" alt="d"/> is the spatial dimension of the covariance model. Often, the parameter <img class="math" src="../../_images/math/faaffaa41e6112abe2aad6241e3e817f6f3b14bf.svg" alt="{\bf \theta}"/> is a scale parameter. This step involves an optimization algorithm.</p></li>
</ul>
<p>All these parameters are estimated with the <cite>GeneralLinearModelAlgorithm</cite> class.</p>
<p>The estimation of the <img class="math" src="../../_images/math/faaffaa41e6112abe2aad6241e3e817f6f3b14bf.svg" alt="{\bf \theta}"/> parameters is the step which has the highest CPU cost. Moreover, the maximization of likelihood may be associated with difficulties e.g. many local maximums or even the non convergence of the optimization algorithm. In this case, it might be useful to fine tune the optimization algorithm so that the convergence of the optimization algorithm is, hopefully, improved.</p>
<p>Furthermore, there are several situations in which the optimization can be initialized or completely bypassed. Suppose for example that we have already created an initial kriging metamodel with <img class="math" src="../../_images/math/6bed8a44f63e1eb8e61608a5c93374a505943eec.svg" alt="N"/> points and we want to add a single new point.</p>
<ul class="simple">
<li><p>It might be interesting to initialize the optimization algorithm with the optimum found for the previous kriging metamodel: this may reduce the number of iterations required to maximize the likelihood.</p></li>
<li><p>We may as well completely bypass the optimization step: if the previous covariance model was correctly estimated, the update of the parameters may or may not significantly improve the estimates.</p></li>
</ul>
<p>This is why the goal of this example is to see how to configure the optimization of the hyperparameters of a kriging metamodel.</p>
</section>
<section id="definition-of-the-model">
<h2>Definition of the model<a class="headerlink" href="#definition-of-the-model" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
</pre></div>
</div>
<p>We define the symbolic function which evaluates the output Y depending on the inputs E, F, L and I.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">([</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;F*L^3/(3*E*I)&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Then we define the distribution of the input random vector.</p>
<p>Young’s modulus E</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">2.27</span><span class="p">,</span> <span class="mf">2.5e7</span><span class="p">,</span> <span class="mf">5.0e7</span><span class="p">)</span>  <span class="c1"># in N/m^2</span>
<span class="n">E</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)</span>
<span class="c1"># Load F</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LogNormal</span><span class="p">()</span>  <span class="c1"># in N</span>
<span class="n">F</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">LogNormalMuSigma</span><span class="p">()([</span><span class="mf">30.e3</span><span class="p">,</span> <span class="mf">9e3</span><span class="p">,</span> <span class="mf">15.e3</span><span class="p">]))</span>
<span class="n">F</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="c1"># Length L</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mf">250.</span><span class="p">,</span> <span class="mf">260.</span><span class="p">)</span>  <span class="c1"># in cm</span>
<span class="n">L</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="c1"># Moment of inertia I</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">450</span><span class="p">)</span>  <span class="c1"># in cm^4</span>
<span class="n">I</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we define the dependency using a <cite>NormalCopula</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dim</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># number of inputs</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CorrelationMatrix</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
<span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
<span class="n">myCopula</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">NormalCopula</span><span class="p">(</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">NormalCopula</span><span class="o">.</span><span class="n">GetCorrelationFromSpearmanCorrelation</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
<span class="n">myDistribution</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">([</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">I</span><span class="p">],</span> <span class="n">myCopula</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-the-design-of-experiments">
<h2>Create the design of experiments<a class="headerlink" href="#create-the-design-of-experiments" title="Permalink to this headline">¶</a></h2>
<p>We consider a simple Monte-Carlo sampling as a design of experiments. This is why we generate an input sample using the <cite>getSample</cite> method of the distribution. Then we evaluate the output using the <cite>model</cite> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampleSize_train</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">myDistribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sampleSize_train</span><span class="p">)</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-the-metamodel">
<h2>Create the metamodel<a class="headerlink" href="#create-the-metamodel" title="Permalink to this headline">¶</a></h2>
<p>In order to create the kriging metamodel, we first select a constant trend with the <cite>ConstantBasisFactory</cite> class. Then we use a squared exponential covariance model. Finally, we use the <cite>KrigingAlgorithm</cite> class to create the kriging metamodel, taking the training sample, the covariance model and the trend basis as input arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="n">myDistribution</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ConstantBasisFactory</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span><span class="o">*</span><span class="n">dimension</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">krigingMetamodel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
</pre></div>
</div>
<p>The <cite>run</cite> method has optimized the hyperparameters of the metamodel.</p>
<p>We can then print the constant trend of the metamodel, which have been estimated using the least squares method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getTrendCoefficients</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[class=Point name=Unnamed dimension=1 values=[13.3786]]
</pre></div>
</div>
<p>We can also print the hyperparameters of the covariance model, which have been estimated by maximizing the likelihood.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basic_covariance_model</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span>
<span class="n">basic_covariance_model</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[1,1,1,1], amplitude=[5.08434])</p>
</div>
<br />
<br /></section>
<section id="get-the-optimizer-algorithm">
<h2>Get the optimizer algorithm<a class="headerlink" href="#get-the-optimizer-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The <cite>getOptimizationAlgorithm</cite> method returns the optimization algorithm used to optimize the <img class="math" src="../../_images/math/faaffaa41e6112abe2aad6241e3e817f6f3b14bf.svg" alt="{\bf \theta}"/> parameters of the <cite>SquaredExponential</cite> covariance model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getOptimizationAlgorithm</span><span class="p">()</span>
</pre></div>
</div>
<p>Get the default optimizer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solverImplementation</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">getImplementation</span><span class="p">()</span>
<span class="n">solverImplementation</span><span class="o">.</span><span class="n">getClassName</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;TNC&#39;
</pre></div>
</div>
<p>The <cite>getOptimizationBounds</cite> method returns the bounds. The dimension of these bounds correspond to the spatial dimension of the covariance model. In the metamodeling context, this correspond to the input dimension of the model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bounds</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getOptimizationBounds</span><span class="p">()</span>
<span class="n">bounds</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lbounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">getLowerBound</span><span class="p">()</span>
<span class="n">lbounds</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>[0.01,0.01,0.01,0.01]</p>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ubounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">getUpperBound</span><span class="p">()</span>
<span class="n">ubounds</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>[2.27497e+07,81879.1,18.2918,178.813]</p>
</div>
<br />
<br /><p>The <cite>getOptimizeParameters</cite> method returns <cite>True</cite> if these parameters are to be optimized.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">getOptimizeParameters</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</section>
<section id="configure-the-starting-point-of-the-optimization">
<h2>Configure the starting point of the optimization<a class="headerlink" href="#configure-the-starting-point-of-the-optimization" title="Permalink to this headline">¶</a></h2>
<p>The starting point of the optimization is based on the parameters of the covariance model. In the following example, we configure the parameters of the covariance model to the arbitrary values <cite>[12.,34.,56.,78.]</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">12.</span><span class="p">,</span> <span class="mf">34.</span><span class="p">,</span> <span class="mf">56.</span><span class="p">,</span> <span class="mf">78.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[12,34,18.2918,78], amplitude=[5.08434])</p>
</div>
<br />
<br /><p>In order to see the difference with the default optimization, we print the previous optimized covariance model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">basic_covariance_model</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[1,1,1,1], amplitude=[5.08434])</p>
</div>
<br />
<br /><p>We observe that this does not change much the values of the parameters in this case.</p>
</section>
<section id="disabling-the-optimization">
<h2>Disabling the optimization<a class="headerlink" href="#disabling-the-optimization" title="Permalink to this headline">¶</a></h2>
<p>It is sometimes useful to completely disable the optimization of the parameters. In order to see the effect of this, we first initialize the parameters of the covariance model with the arbitrary values <cite>[12.,34.,56.,78.]</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">12.</span><span class="p">,</span> <span class="mf">34.</span><span class="p">,</span> <span class="mf">56.</span><span class="p">,</span> <span class="mf">78.</span><span class="p">],</span> <span class="p">[</span><span class="mf">91.0</span><span class="p">])</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>setOptimizeParameters</cite> method can be used to disable the optimization of the parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">setOptimizeParameters</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we run the algorithm and get the result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
</pre></div>
</div>
<p>We observe that the covariance model is unchanged.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[12,34,56,78], amplitude=[91])</p>
</div>
<br />
<br /><p>The trend, however, is still optimized, using linear least squares.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">getTrendCoefficients</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[class=Point name=Unnamed dimension=1 values=[13.3786]]
</pre></div>
</div>
</section>
<section id="reuse-the-parameters-from-a-previous-optimization">
<h2>Reuse the parameters from a previous optimization<a class="headerlink" href="#reuse-the-parameters-from-a-previous-optimization" title="Permalink to this headline">¶</a></h2>
<p>In this example, we show how to reuse the optimized parameters of a previous kriging and configure a new one. Furthermore, we disable the optimization so that the parameters of the covariance model are not updated. This make the process of adding a new point very fast: it improves the quality by adding a new point in the design of experiments without paying the price of the update of the covariance model.</p>
<p>Step 1: Run a first kriging algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="n">myDistribution</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ConstantBasisFactory</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SquaredExponential</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span><span class="o">*</span><span class="n">dimension</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">covarianceModel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span>
<span class="n">covarianceModel</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[1,1,1,1], amplitude=[5.08434])</p>
</div>
<br />
<br /><p>Step 2: Create a new point and add it to the previous training design.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X_new</span> <span class="o">=</span> <span class="n">myDistribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">Y_new</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Y_train</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Y_new</span><span class="p">)</span>
<span class="n">Y_train</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
<p>Step 3: Create an updated kriging, using the new point with the old covariance parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">setOptimizeParameters</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">notUpdatedCovarianceModel</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span>
<span class="n">notUpdatedCovarianceModel</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[1,1,1,1], amplitude=[5.08434])</p>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">printCovarianceParameterChange</span><span class="p">(</span><span class="n">covarianceModel1</span><span class="p">,</span> <span class="n">covarianceModel2</span><span class="p">):</span>
    <span class="n">parameters1</span> <span class="o">=</span> <span class="n">covarianceModel1</span><span class="o">.</span><span class="n">getFullParameter</span><span class="p">()</span>
    <span class="n">parameters2</span> <span class="o">=</span> <span class="n">covarianceModel2</span><span class="o">.</span><span class="n">getFullParameter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parameters1</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()):</span>
        <span class="n">deltai</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">parameters1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">parameters2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Change in the parameter #</span><span class="si">%d</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">deltai</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printCovarianceParameterChange</span><span class="p">(</span><span class="n">covarianceModel</span><span class="p">,</span> <span class="n">notUpdatedCovarianceModel</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Change in the parameter #0 = 0.0
Change in the parameter #1 = 0.0
Change in the parameter #2 = 0.0
Change in the parameter #3 = 0.0
Change in the parameter #4 = 0.0
</pre></div>
</div>
<p>We see that the parameters did not change <em>at all</em>: disabling the optimization allows to keep a constant covariance model. In a practical algorithm, we may, for example, add a block of 10 new points before updating the parameters of the covariance model. At this point, we may reuse the previous covariance model so that the optimization starts from a better point, compared to the parameters default values. This will reduce the cost of the optimization.</p>
</section>
<section id="configure-the-optimization-solver">
<h2>Configure the optimization solver<a class="headerlink" href="#configure-the-optimization-solver" title="Permalink to this headline">¶</a></h2>
<p>The following example checks the robustness of the optimization of the kriging algorithm with respect to the optimization of the likelihood function in the covariance model parameters estimation. We use a <cite>MultiStart</cite> algorithm in order to avoid to be trapped by a local minimum. Furthermore, we generate the design of experiments using a <cite>LHSExperiments</cite>, which guarantees that the points will fill the space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampleSize_train</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">myDistribution</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">sampleSize_train</span><span class="p">)</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we create a multivariate distribution, based on independent <cite>Uniform</cite> marginals which have the bounds required by the covariance model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">distributions</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">DistributionCollection</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
    <span class="n">distributions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">lbounds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ubounds</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">boundedDistribution</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ComposedDistribution</span><span class="p">(</span><span class="n">distributions</span><span class="p">)</span>
</pre></div>
</div>
<p>We first generate a Latin Hypercube Sampling (LHS) design made of 25 points in the sample space. This LHS is optimized so as to fill the space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mi">25</span>  <span class="c1"># design size</span>
<span class="n">LHS</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LHSExperiment</span><span class="p">(</span><span class="n">boundedDistribution</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="n">LHS</span><span class="o">.</span><span class="n">setAlwaysShuffle</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">SA_profile</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GeometricProfile</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">20000</span><span class="p">)</span>
<span class="n">LHS_optimization_algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SimulatedAnnealingLHS</span><span class="p">(</span>
    <span class="n">LHS</span><span class="p">,</span> <span class="n">ot</span><span class="o">.</span><span class="n">SpaceFillingC2</span><span class="p">(),</span> <span class="n">SA_profile</span><span class="p">)</span>
<span class="n">LHS_optimization_algo</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
<span class="n">LHS_design</span> <span class="o">=</span> <span class="n">LHS_optimization_algo</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="n">starting_points</span> <span class="o">=</span> <span class="n">LHS_design</span><span class="o">.</span><span class="n">getOptimalDesign</span><span class="p">()</span>
<span class="n">starting_points</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>25
</pre></div>
</div>
<p>We can check that the minimum and maximum in the sample correspond to the bounds of the design of experiment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lbounds</span><span class="p">,</span> <span class="n">ubounds</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(class=Point name=Unnamed dimension=4 values=[0.01,0.01,0.01,0.01], class=Point name=Unnamed dimension=4 values=[2.27497e+07,81879.1,18.2918,178.813])
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">starting_points</span><span class="o">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">starting_points</span><span class="o">.</span><span class="n">getMax</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(class=Point name=Unnamed dimension=4 values=[8192.53,1897.95,0.606147,5.1413], class=Point name=Unnamed dimension=4 values=[2.26853e+07,81252.5,17.7015,177.663])
</pre></div>
</div>
<p>Then we create a <cite>MultiStart</cite> algorithm based on the LHS starting points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">setMaximumIterationNumber</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">multiStartSolver</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MultiStart</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">starting_points</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we configure the optimization algorithm so as to use the <cite>MultiStart</cite> algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">KrigingAlgorithm</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">covarianceModel</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">setOptimizationBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">setOptimizationAlgorithm</span><span class="p">(</span><span class="n">multiStartSolver</span><span class="p">)</span>
<span class="n">algo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finetune_covariance_model</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getCovarianceModel</span><span class="p">()</span>
<span class="n">finetune_covariance_model</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<p>SquaredExponential(scale=[1,1,1,1], amplitude=[5.08434])</p>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printCovarianceParameterChange</span><span class="p">(</span>
    <span class="n">finetune_covariance_model</span><span class="p">,</span> <span class="n">basic_covariance_model</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Change in the parameter #0 = 0.0
Change in the parameter #1 = 0.0
Change in the parameter #2 = 0.0
Change in the parameter #3 = 0.0
Change in the parameter #4 = 0.0
</pre></div>
</div>
<p>We see that there are no changes in the estimated parameters. This shows that the first optimization of the parameters worked fine.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.267 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-kriging-metamodel-plot-kriging-hyperparameters-optimization-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/06b69b36ded61f91f0e533e211435c93/plot_kriging_hyperparameters_optimization.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_kriging_hyperparameters_optimization.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/bf1a4f3bee47286c7b782ba172f895e3/plot_kriging_hyperparameters_optimization.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_kriging_hyperparameters_optimization.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_kriging_branin_function.html" title="Kriging: metamodel of the Branin-Hoo function"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_kriging_simulate.html" title="Kriging : generate trajectories from a metamodel"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.18rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Kriging :configure the optimization solver</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2021 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Nov 08, 2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>