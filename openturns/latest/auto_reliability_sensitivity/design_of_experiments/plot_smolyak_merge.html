
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Merge nodes in Smolyak quadrature &#8212; OpenTURNS 1.21 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Use the Smolyak quadrature" href="plot_smolyak_quadrature.html" />
    <link rel="prev" title="Plot the Smolyak quadrature" href="plot_smolyak_experiment.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_smolyak_quadrature.html" title="Use the Smolyak quadrature"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_smolyak_experiment.html" title="Plot the Smolyak quadrature"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Reliability &amp; Sensitivity</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">Design of experiments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Merge nodes in Smolyak quadrature</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_smolyak_experiment.html"
                          title="previous chapter">Plot the Smolyak quadrature</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_smolyak_quadrature.html"
                          title="next chapter">Use the Smolyak quadrature</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_reliability_sensitivity/design_of_experiments/plot_smolyak_merge.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-reliability-sensitivity-design-of-experiments-plot-smolyak-merge-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="merge-nodes-in-smolyak-quadrature">
<span id="sphx-glr-auto-reliability-sensitivity-design-of-experiments-plot-smolyak-merge-py"></span><h1>Merge nodes in Smolyak quadrature<a class="headerlink" href="#merge-nodes-in-smolyak-quadrature" title="Permalink to this heading">¶</a></h1>
<p>The goal of this example is to see the effect of the merge algorithm in
Smolyak’s quadrature implemented in <code class="xref py py-class docutils literal notranslate"><span class="pre">SmolyakExperiment</span></code>.
We analyse the sensitivity of the number of nodes to the relative
and absolute tolerances.
Then we analyse the effect of the merge algorithm on the number of nodes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.experimental</span> <span class="k">as</span> <span class="nn">otexp</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>The following examples shows how to get the relative and absolute tolerances.
These tolerances are used in the algorithm in order to identify potentially
duplicated nodes, taking into account for rounding errors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon_r</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">GetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeRelativeEpsilon&quot;</span><span class="p">)</span>
<span class="n">epsilon_a</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">GetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeAbsoluteEpsilon&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default epsilon_r = &quot;</span><span class="p">,</span> <span class="n">epsilon_r</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default epsilon_a = &quot;</span><span class="p">,</span> <span class="n">epsilon_a</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Default epsilon_r =  1e-08
Default epsilon_a =  1e-08
</pre></div>
</div>
<p>The following examples shows how to set the relative and absolute tolerances.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon_r</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">epsilon_a</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeRelativeEpsilon&quot;</span><span class="p">,</span> <span class="n">epsilon_r</span><span class="p">)</span>
<span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeAbsoluteEpsilon&quot;</span><span class="p">,</span> <span class="n">epsilon_a</span><span class="p">)</span>
</pre></div>
</div>
<p>We are interested in the sensitivity of the number of nodes to the tolerances
of the merging algorithm.
The next function takes the level and tolerances as input arguments,
and returns the size of Smolyak’s quadrature using Gauss-Legendre nodes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon_a</span><span class="p">,</span> <span class="n">epsilon_r</span><span class="p">):</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeRelativeEpsilon&quot;</span><span class="p">,</span> <span class="n">epsilon_r</span><span class="p">)</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeAbsoluteEpsilon&quot;</span><span class="p">,</span> <span class="n">epsilon_a</span><span class="p">)</span>
    <span class="n">uniform</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">GaussProductExperiment</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="n">uniform</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">otexp</span><span class="o">.</span><span class="n">SmolyakExperiment</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="n">nodes</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">generateWithWeights</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">size</span>
</pre></div>
</div>
<p>In the following experiments, we use
<img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFMAAAALBAMAAADxQaypAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAna9g6XS/z4sYMt1I8/v/F6RnAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAnUlEQVQY02NgYFQyYEAGQsoM6ACmxBVEsJWDgAKQxRIAU5AOEiqCKwEqKkA1IR3DTLgS/iINFPHvSg3oSmFK5i9AEeb8hWkqTAn/AlS3gpSqSqC4FaREKMKAgQ3NvgwGBu4DQqhubWBg5TsqwMCgETEBWZyptfMsQzKqdo2IWasZsII2hpsYYo3YlQZx3QxAFyvGrpQttBBDbAMDAwAOkySmSfjc3QAAAAp0RVh0RGVwdGgAAAAAA74qsLYAAAAASUVORK5CYII=" alt="\epsilon = \epsilon_a = \epsilon_r" style="vertical-align: -3px"/> i.e.
the relative and absolute tolerances are set to be equal.</p>
<p>In general, we want the tolerance to be as small as possible.
This is because we want the merge algorithm to detect candidate nodes
which truly overlap.
Indeed, our goal is to make the algorithm be insensitive to rounding errors,
but we do not want to merge two nodes which are significantly different.
We first want to see what is the effect when the tolerance is set to
a too small value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">level</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;epsilon = </span><span class="si">%.2e</span><span class="s2">, level = </span><span class="si">%d</span><span class="s2">, size = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.0e-20</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;epsilon = </span><span class="si">%.2e</span><span class="s2">, level = </span><span class="si">%d</span><span class="s2">, size = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>epsilon = 0.00e+00, level = 9, size = 283
epsilon = 1.00e-20, level = 9, size = 283
</pre></div>
</div>
<p>Hence, 283 nodes are produced with a tolerance set to zero,
or to a very small value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.0e-8</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;epsilon = </span><span class="si">%.2e</span><span class="s2">, level = </span><span class="si">%d</span><span class="s2">, size = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>epsilon = 1.00e-08, level = 9, size = 281
</pre></div>
</div>
<p>If the tolerance is set to a larger value, then 2 nodes are detected
as duplicate, so that the total number of nodes is equal to 281.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># We conclude that the tolerance must not be set to a too</span>
<span class="c1"># small value.</span>
<span class="c1">#</span>
<span class="c1"># In the next `for` loops, for each value of the tolerance from :math:`10^{-1}`</span>
<span class="c1"># down to :math:`10^{-20}`, we increase the `level` and see how this changes</span>
<span class="c1"># the number of nodes.</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Sensitivity to tolerance&quot;</span><span class="p">,</span> <span class="s2">&quot;Level&quot;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">point_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;fdiamond&quot;</span><span class="p">,</span> <span class="s2">&quot;fsquare&quot;</span><span class="p">,</span> <span class="s2">&quot;ftriangleup&quot;</span><span class="p">,</span> <span class="s2">&quot;triangledown&quot;</span><span class="p">]</span>
<span class="n">number_of_epsilons</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">epsilon_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">number_of_epsilons</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilon_array</span><span class="p">:</span>
    <span class="n">size_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">level_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">level_list</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
        <span class="n">size_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">level_list</span><span class="p">,</span> <span class="n">size_list</span><span class="p">)</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;epsilon = </span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">))</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="n">point_styles</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="o">.</span><span class="n">BuildDefaultPalette</span><span class="p">(</span><span class="n">number_of_epsilons</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topright&quot;</span><span class="p">)</span>
<span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_smolyak_merge_001.png" srcset="../../_images/sphx_glr_plot_smolyak_merge_001.png" alt="Sensitivity to tolerance" class = "sphx-glr-single-img"/><p>We see that changing the tolerance from <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAQBAMAAABq7AtUAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAYOlIMp0Yr8+L3XS/+/NS2zlYAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAlklEQVQY02NgQAGssx1QBRgKOQNQBdgeoKlg4F69HUgKGTAwiE4XAItwfmAtYHC1N2BgVmBQYQgvLy/lVmAE6uM3YODawBADVsOswKgAFgEiWYhBCkBdIK69A4N9AljEfToDWETeASQIBxA18qgi/gYM+xNQRPgFGPYyoIhwTWCIQBYRYGBcAHQhHKT3qxswbN0uABcAALhwGT/VD5oZAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="10^{-6}" style="vertical-align: 0px"/> down
to <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAQBAMAAABn8nsTAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAYOlIMp0Yr8+L3XS/+/NS2zlYAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAArUlEQVQY02NgQAE7axhMt6IKMbAEcBQs4JyAKsiswLmwgXkBmlIG9tIDzBcYGIQMGBhEpwtABfPSD7BcYHC1NwDqYlBhCC8vL2VgaGYFq+Q3YODawBADUchq4NjAuAAsCESyEEFBhgAFkO1AEXsHBvsEsJP+/y8w3c4AFpR3AIkjA4hKeQxBfwOG/QnogvwCDHsZ0AW5JjBEoAkKMABdpoIilt6vbsCwdbsAshgAau4jx2+rmbkAAAAKdEVYdERlcHRoAAAAAAAnI+EMAAAAAElFTkSuQmCC" alt="10^{-20}" style="vertical-align: 0px"/> does not change much the size of Smolyak’s
quadrature.
Using <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAAQBAMAAAC7Cw8kAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAna9g6XS/z4sYMkjd+/NIU83QAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAqElEQVQoz2NgwAumHmAgAEIdCKngIk+FyQYGBsMmA9wqFu7fwMDtwODFIKSkpIjdDP4NDDwBDGJ4bAGqACJbqIoHQIJRyQBdxf4FDPsngDlGNxYwMLiCWGzlIKAAVWG/AKQIBtgKMG0BStsjVPAXaWCoWL+BIX4CXGD+AiwuNWCIRRJYgOkOngYGcYQKtgZ0MwwYmA8AQwwBNCImICuYVO+0gSEwCBECAK9aK0ABaOYbAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="\epsilon = 10^{-1}" style="vertical-align: 0px"/> reduces the number of nodes by a too large
amount.
This is because a relatively large tolerance considers that many candidate
nodes are close to each other, so that these nodes are merged.
In this case, the quadrature is not accurate enough.</p>
<p>In the next <cite>for</cite> loop, for each value of the <cite>level</cite> parameter,
we decrease the tolerance from <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAQBAMAAABq7AtUAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAYOlIMp0Yr8+L3XS/+/NS2zlYAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQY02NgQAHZCxjQwG4FdBEW7CJCBgwMotMFECKu9gYMzAoMKgzh5eWlEDX8BgxcGxhikHQBRYBIFiryACJi78BgnwAWEb/pABaRdwAJwgFEjTyqiL8Bw/4EFBF+AYa9DCgiXBMYIpBFBBgYFwBdCAfp/eoGDFu3C8AFAMY6Fb9AvmZUAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="10^{-1}" style="vertical-align: 0px"/>
down to <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAQBAMAAABq7AtUAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAYOlIMp0Yr8+L3XS/+7yxHmYAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACUSURBVBjTY2BAAad9HFAFGPpuogkwTEAXYCidDiSEDBgYRKcLQEQc2CcwuNoZMDArMKgwhJeXlzIwcC5gYOAzYODawBADVsK8gBsiAkSyYBGWCTwTwCJ2Dgx2CWChnaEMYBE5B5AgHEDUyKGK+Bkw7EtAEeETYNjLgCLCNYEhAllEgIFxAdCFcJDep27AsHW7AFwAAIbiGmLDeyEhAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="10^{-5}" style="vertical-align: 0px"/> and see how this changes the number of nodes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Sensitivity to tolerance&quot;</span><span class="p">,</span> <span class="s2">&quot;Epsilon&quot;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">point_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;fdiamond&quot;</span><span class="p">,</span> <span class="s2">&quot;fsquare&quot;</span><span class="p">,</span> <span class="s2">&quot;ftriangleup&quot;</span><span class="p">,</span> <span class="s2">&quot;triangledown&quot;</span><span class="p">]</span>
<span class="n">number_of_epsilons</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">level_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">level_list</span><span class="p">:</span>
    <span class="n">size_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">epsilon_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">number_of_epsilons</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">epsilon_array</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
        <span class="n">size_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">epsilon_array</span><span class="p">,</span> <span class="n">size_list</span><span class="p">)</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s2">&quot;Level = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">level</span><span class="p">))</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">setPointStyle</span><span class="p">(</span><span class="n">point_styles</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="o">.</span><span class="n">BuildDefaultPalette</span><span class="p">(</span><span class="n">number_of_epsilons</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLegendPosition</span><span class="p">(</span><span class="s2">&quot;topright&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setLogScale</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">GraphImplementation</span><span class="o">.</span><span class="n">LOGXY</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_smolyak_merge_002.png" srcset="../../_images/sphx_glr_plot_smolyak_merge_002.png" alt="Sensitivity to tolerance" class = "sphx-glr-single-img"/><p>We see that changing the tolerance from <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAMBAMAAABcu7ojAAAAHlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACGjDitAAAACXRSTlMAYOlIMp0Yr89yBg+PAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAHElEQVQI12NgEDJgYHC1BBIMnMQSAgwM6Z3qBgBsXAQZvELwjAAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="1" style="vertical-align: 0px"/> down to <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAQBAMAAABq7AtUAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAYOlIMp0Yr8+L3XS/+/NS2zlYAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAlElEQVQY02NgQAEb9ySgCjBc4AhAE3FgMkATYQkFEkJAUdHpAhARNpkEBld7AwZmBQYVhvDy8lIGBp4FDAz8BgxcGxhiwEq4F3A+AIsAkSxYhDGApwAsYu/AYA9xx8zpDGAReQeQIBxA1MijivgbMOxPQBHhF2DYy4AiwjWBIQJZRICBcQHQhXCQ3q9uwLB1uwBcAADd4BmQU0q71QAAAAp0RVh0RGVwdGgAAAAAACcj4QwAAAAASUVORK5CYII=" alt="10^{-3}" style="vertical-align: 0px"/>
changes the number of nodes.
Below this threshold, the number of nodes does not change much.</p>
<p>The <cite>SmolyakExperiment-MergeQuadrature</cite> key of the <cite>ResourceMap</cite> allows
to disable or enable the merge algorithm.
In order to see its effect, the following script performs a loop over
the levels and compute the size without and with the merge algorithm.
Then we plot the number of nodes which have been detected as duplicated
and plot it versus the level.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Restore to default values</span>
<span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeRelativeEpsilon&quot;</span><span class="p">,</span> <span class="mf">1.0e-8</span><span class="p">)</span>
<span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsScalar</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeAbsoluteEpsilon&quot;</span><span class="p">,</span> <span class="mf">1.0e-8</span><span class="p">)</span>
<span class="n">level_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">size_decrease_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">level_list</span><span class="p">:</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsBool</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeQuadrature&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">sizeNoMerge</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
    <span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">SetAsBool</span><span class="p">(</span><span class="s2">&quot;SmolyakExperiment-MergeQuadrature&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">sizeWithMerge</span> <span class="o">=</span> <span class="n">computeNumberOfSmolyakNodes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
    <span class="n">sizeDecrease</span> <span class="o">=</span> <span class="n">sizeNoMerge</span> <span class="o">-</span> <span class="n">sizeWithMerge</span>
    <span class="n">size_decrease_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sizeDecrease</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="s2">&quot;Sensitivity to merge&quot;</span><span class="p">,</span> <span class="s2">&quot;Level&quot;</span><span class="p">,</span> <span class="s2">&quot;Size decrease&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Cloud</span><span class="p">(</span><span class="n">level_list</span><span class="p">,</span> <span class="n">size_decrease_list</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">figure_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
    <span class="n">legend_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s2">&quot;upper left&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_smolyak_merge_003.png" srcset="../../_images/sphx_glr_plot_smolyak_merge_003.png" alt="Sensitivity to merge" class = "sphx-glr-single-img"/><p>We see that the number of nodes is reduced when the merge algorithm is
enabled.
Moreover, the number of nodes which are duplicated increases when the
level increases.</p>
<p>Reset default settings</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ot</span><span class="o">.</span><span class="n">ResourceMap</span><span class="o">.</span><span class="n">Reload</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-reliability-sensitivity-design-of-experiments-plot-smolyak-merge-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4aae01dc21111f5fd170ca2c39f5c39b/plot_smolyak_merge.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_smolyak_merge.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/d321f2be369ded065acdb511ccbbade5/plot_smolyak_merge.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_smolyak_merge.ipynb</span></code></a></p>
</div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_smolyak_quadrature.html" title="Use the Smolyak quadrature"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_smolyak_experiment.html" title="Plot the Smolyak quadrature"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Reliability &amp; Sensitivity</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >Design of experiments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Merge nodes in Smolyak quadrature</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2023 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jun 21, 2023.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>