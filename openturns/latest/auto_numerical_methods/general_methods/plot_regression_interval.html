
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Compute confidence intervals of a regression model from data &#8212; OpenTURNS 1.22 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Compute confidence intervals of a univariate noisy function" href="plot_regression_sinus.html" />
    <link rel="prev" title="Compute leave-one-out error of a polynomial chaos expansion" href="plot_pce_design.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_regression_sinus.html" title="Compute confidence intervals of a univariate noisy function"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_pce_design.html" title="Compute leave-one-out error of a polynomial chaos expansion"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Numerical methods</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">General methods</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Compute confidence intervals of a regression model from data</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Compute confidence intervals of a regression model from data</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#get-the-data">Get the data</a></li>
<li><a class="reference internal" href="#create-the-least-squares-model">Create the least squares model</a></li>
<li><a class="reference internal" href="#compute-residuals-variance-and-design-matrix">Compute residuals, variance and design matrix</a></li>
<li><a class="reference internal" href="#compute-confidence-intervals">Compute confidence intervals</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_pce_design.html"
                          title="previous chapter">Compute leave-one-out error of a polynomial chaos expansion</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_regression_sinus.html"
                          title="next chapter">Compute confidence intervals of a univariate noisy function</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_numerical_methods/general_methods/plot_regression_interval.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-numerical-methods-general-methods-plot-regression-interval-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="compute-confidence-intervals-of-a-regression-model-from-data">
<span id="sphx-glr-auto-numerical-methods-general-methods-plot-regression-interval-py"></span><h1>Compute confidence intervals of a regression model from data<a class="headerlink" href="#compute-confidence-intervals-of-a-regression-model-from-data" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>In this example, we compute the pointwise confidence interval of the
estimator of the conditional expectation given an input.
More precisely, we compute confidence intervals of the output of
a regression model.
The linear regression model is an order 1 multivariate polynomial.
This model is built from a data set.
In this advanced example, we use the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.DesignProxy.html#openturns.DesignProxy" title="openturns.DesignProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">DesignProxy</span></code></a>
and <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.QRMethod.html#openturns.QRMethod" title="openturns.QRMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">QRMethod</span></code></a> low level classes.
Another example of this method is presented in
<a class="reference internal" href="plot_regression_sinus.html"><span class="doc">Compute confidence intervals of a univariate noisy function</span></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">otv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">linthurst</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">palette</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Drawable</span><span class="o">.</span><span class="n">BuildTableauPalette</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">ot</span><span class="o">.</span><span class="n">RandomGenerator</span><span class="o">.</span><span class="n">SetSeed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Permalink to this heading">¶</a></h2>
<p>We consider the so-called <a class="reference internal" href="../../usecases/use_case_linthurst.html#use-case-linthurst"><span class="std std-ref">Linthurst</span></a> data set, which contains measures of
aerial biomass (BIO) as well as 5 five physico-chemical properties of
the soil: salinity (SAL), pH, K, Na, and Zn.
The data set is taken from <a class="reference internal" href="../../bibliography.html#rawlings2001" id="id1"><span>[rawlings2001]</span></a> table 5.1 page 63.</p>
<p>We define the data.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">linthurst</span><span class="o">.</span><span class="n">Linthurst</span><span class="p">()</span>
</pre></div>
</div>
<p>Get the input and output samples.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dimension = &quot;</span><span class="p">,</span> <span class="n">dimension</span><span class="p">)</span>
<span class="n">sampleSize</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sampleSize = &quot;</span><span class="p">,</span> <span class="n">sampleSize</span><span class="p">)</span>
<span class="n">inputSample</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inputSample</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">outputSample</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outputSample</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

<span class="n">inputDescription</span> <span class="o">=</span> <span class="n">inputSample</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
<span class="n">outputDescription</span> <span class="o">=</span> <span class="n">outputSample</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>dimension =  5
sampleSize =  45
Input :
    [ SAL        pH         K          Na         Zn         ]
0 : [    33          5       1441.67   35185.5       16.4524 ]
1 : [    35          4.75    1299.19   28170.4       13.9852 ]
2 : [    32          4.2     1154.27   26455         15.3276 ]
3 : [    30          4.4     1045.15   25072.9       17.3128 ]
4 : [    33          5.55     521.62   31664.2       22.3312 ]
Output :
    [ BIO  ]
0 : [  676 ]
1 : [  516 ]
2 : [ 1052 ]
3 : [  868 ]
4 : [ 1008 ]
</pre></div>
</div>
<p>We want to create a linear regression model.
To do this, we need to create a functional basis.
We make the choice of using only degree 1 polynomials
for each marginal input variable.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">functionCollection</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">basisFunction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">(</span><span class="n">inputDescription</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.0&quot;</span><span class="p">])</span>
<span class="n">functionCollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basisFunction</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
    <span class="n">basisFunction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">(</span><span class="n">inputDescription</span><span class="p">,</span> <span class="p">[</span><span class="n">inputDescription</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">functionCollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basisFunction</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Basis</span><span class="p">(</span><span class="n">functionCollection</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then print the basis.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">basisSize</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Basis size = &quot;</span><span class="p">,</span> <span class="n">basisSize</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basisSize</span><span class="p">):</span>
    <span class="n">basisFunction</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Function #&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">basisFunction</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Basis size =  6
Function # 0 [SAL,pH,K,Na,Zn]-&gt;[1.0]
Function # 1 [SAL,pH,K,Na,Zn]-&gt;[SAL]
Function # 2 [SAL,pH,K,Na,Zn]-&gt;[pH]
Function # 3 [SAL,pH,K,Na,Zn]-&gt;[K]
Function # 4 [SAL,pH,K,Na,Zn]-&gt;[Na]
Function # 5 [SAL,pH,K,Na,Zn]-&gt;[Zn]
</pre></div>
</div>
</section>
<section id="create-the-least-squares-model">
<h2>Create the least squares model<a class="headerlink" href="#create-the-least-squares-model" title="Permalink to this heading">¶</a></h2>
<p>To create the least squares model, we use the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.DesignProxy.html#openturns.DesignProxy" title="openturns.DesignProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">DesignProxy</span></code></a> class,
which defines the design matrix of the linear regression model.
Then we solve the problem using QR decomposition.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">designProxy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">DesignProxy</span><span class="p">(</span><span class="n">inputSample</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">basisSize</span><span class="p">)</span>  <span class="c1"># We consider all the functions in the basis</span>
<span class="n">lsqMethod</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">QRMethod</span><span class="p">(</span><span class="n">designProxy</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
<span class="n">betaHat</span> <span class="o">=</span> <span class="n">lsqMethod</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">outputSample</span><span class="o">.</span><span class="n">asPoint</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">betaHat</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[1252.28,-30.285,305.526,-0.285114,-0.0086726,-20.6764]
</pre></div>
</div>
<p>Based on the solution of the linear least squares problem, we
can create the metamodel and evaluate the residuals.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">metamodel</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearCombinationFunction</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">betaHat</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compute-residuals-variance-and-design-matrix">
<h2>Compute residuals, variance and design matrix<a class="headerlink" href="#compute-residuals-variance-and-design-matrix" title="Permalink to this heading">¶</a></h2>
<p>We need to estimate the variance of the residuals.
To do this we evaluate the predictions of the regression model
on the training sample and compute the residuals.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">yHat</span> <span class="o">=</span> <span class="n">metamodel</span><span class="p">(</span><span class="n">inputSample</span><span class="p">)</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">yHat</span> <span class="o">-</span> <span class="n">outputSample</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to compute confidence intervals of the mean, we need
to estimate the sample standard deviation.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sigma2Hat</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">normSquare</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">sampleSize</span> <span class="o">-</span> <span class="n">basisSize</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma2Hat&quot;</span><span class="p">,</span> <span class="n">sigma2Hat</span><span class="p">)</span>
<span class="n">sigmaHat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2Hat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigmaHat = &quot;</span><span class="p">,</span> <span class="n">sigmaHat</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>sigma2Hat 158622.11240972756
sigmaHat =  398.27391630601113
</pre></div>
</div>
<p>We evaluate the design matrix and store it as a <a class="reference internal" href="../../user_manual/_generated/openturns.Sample.html#openturns.Sample" title="openturns.Sample"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sample</span></code></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">designMatrix</span> <span class="o">=</span> <span class="n">lsqMethod</span><span class="o">.</span><span class="n">computeWeightedDesign</span><span class="p">()</span>
<span class="n">designSample</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="n">designMatrix</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="compute-confidence-intervals">
<h2>Compute confidence intervals<a class="headerlink" href="#compute-confidence-intervals" title="Permalink to this heading">¶</a></h2>
<p>The next function will help to compute confidence intervals.
It is based on regression analysis.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">computeRegressionConfidenceInterval</span><span class="p">(</span>
    <span class="n">lsqMethod</span><span class="p">,</span>
    <span class="n">betaHat</span><span class="p">,</span>
    <span class="n">sigma2Hat</span><span class="p">,</span>
    <span class="n">designSample</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
    <span class="n">mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">epsilonSigma</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a confidence interval for the estimate of the mean.</span>

<span class="sd">    Evaluates this confidence interval at points in the design matrix.</span>

<span class="sd">    This code is based on (Rawlings, Pantula &amp; David, 1998)</span>
<span class="sd">    eq. 3.51 and 3.52 page 90.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lsqMethod: ot.LeastSquaresMethod</span>
<span class="sd">        The linear least squares method (e.g. QR or Cholesky).</span>
<span class="sd">    betaHat : ot.Point(parameterDimension)</span>
<span class="sd">        The solution of the least squares problem.</span>
<span class="sd">    sigma2Hat : float &gt; 0.0</span>
<span class="sd">        The estimate of the variance.</span>
<span class="sd">    designSample : ot.Sample(size, parameterDimension)</span>
<span class="sd">        The design matrix of the linear model.</span>
<span class="sd">        This is the value of the functional basis depending on the</span>
<span class="sd">        input sample.</span>
<span class="sd">        Each row represents the input where the confidence interval</span>
<span class="sd">        is to be computed.</span>
<span class="sd">    alpha : float, in [0, 1]</span>
<span class="sd">        The width of the confidence interval.</span>
<span class="sd">    mean : bool</span>
<span class="sd">        If True, then computes the confidence interval of the mean.</span>
<span class="sd">        This interval contains yTrue = E[y|x] with probability alpha.</span>
<span class="sd">        Otherwise, computes a confidence interval of the prediction at point x.</span>
<span class="sd">        This interval contains y|x with probability alpha.</span>
<span class="sd">    epsilonSigma : float &gt; 0.0</span>
<span class="sd">        A relatively small number. The minimal value of variance, which</span>
<span class="sd">        avoids a singular Normal distribution.</span>

<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">    - O. Rawlings John, G. Pantula Sastry, and A. Dickey David.</span>
<span class="sd">      Applied regression analysis—a research tool. Springer New York, 1998.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    confidenceBounds : ot.Sample(size, 2)</span>
<span class="sd">        The first column contains the lower bound.</span>
<span class="sd">        The second column contains the upper bound.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">inverseGram</span> <span class="o">=</span> <span class="n">lsqMethod</span><span class="o">.</span><span class="n">getGramInverse</span><span class="p">()</span>
    <span class="n">sampleSize</span> <span class="o">=</span> <span class="n">designSample</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
    <span class="n">confidenceBounds</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">):</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">designSample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">meanYHat</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">betaHat</span><span class="p">)</span>
        <span class="n">sigma2YHat</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inverseGram</span> <span class="o">*</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma2Hat</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mean</span><span class="p">:</span>
            <span class="n">sigma2YHat</span> <span class="o">+=</span> <span class="n">sigma2Hat</span>
        <span class="n">sigmaYHat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2YHat</span><span class="p">)</span>
        <span class="n">sigmaYHat</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">epsilonSigma</span><span class="p">,</span> <span class="n">sigmaYHat</span><span class="p">)</span>  <span class="c1"># Prevents a zero s.e.</span>
        <span class="n">distribution</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">meanYHat</span><span class="p">,</span> <span class="n">sigmaYHat</span><span class="p">)</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">distribution</span><span class="o">.</span><span class="n">computeBilateralConfidenceInterval</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">getLowerBound</span><span class="p">()</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">getUpperBound</span><span class="p">()</span>
        <span class="n">confidenceBounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">confidenceBounds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">confidenceBounds</span>
</pre></div>
</div>
<p>We evaluate the value of the basis functions on the test sample.
This sample is used to compute the confidence interval.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">confidenceIntervalMean</span> <span class="o">=</span> <span class="n">computeRegressionConfidenceInterval</span><span class="p">(</span>
    <span class="n">lsqMethod</span><span class="p">,</span> <span class="n">betaHat</span><span class="p">,</span> <span class="n">sigma2Hat</span><span class="p">,</span> <span class="n">designSample</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For a given observation, we can print the input, the observed
output, the predicted output and the confidence interval of
the conditional expectation.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># The index of the observation</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x = &quot;</span><span class="p">,</span> <span class="n">inputSample</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Y observation = &quot;</span><span class="p">,</span> <span class="n">outputSample</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Y prediction = &quot;</span><span class="p">,</span> <span class="n">yHat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confidence interval of the mean = &quot;</span><span class="p">,</span> <span class="n">confidenceIntervalMean</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>x =  [33,5.05,1273.02,25491.7,12.2778]
Y observation =  [436]
Y prediction =  957.878192007202
Confidence interval of the mean =  [710.922,1204.83]
</pre></div>
</div>
<p>In order to see how the model fits to the data, we can
create the validation plot.
Each vertical bar represents the 95% confidence interval
of the estimate of the conditional expectation of the linear regression model.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">validation</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MetaModelValidation</span><span class="p">(</span><span class="n">inputSample</span><span class="p">,</span> <span class="n">outputSample</span><span class="p">,</span> <span class="n">metamodel</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">drawValidation</span><span class="p">()</span><span class="o">.</span><span class="n">getGraph</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">q2Score</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">computePredictivityFactor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Q2 = </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">q2Score</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setXTitle</span><span class="p">(</span><span class="s2">&quot;Observations&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">setYTitle</span><span class="p">(</span><span class="s2">&quot;Metamodel&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sampleSize</span><span class="p">):</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Curve</span><span class="p">([</span><span class="n">outputSample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">confidenceIntervalMean</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">otv</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_regression_interval_001.png" srcset="../../_images/sphx_glr_plot_regression_interval_001.png" alt="Q2 = 67.73%" class = "sphx-glr-single-img"/><p>We see that the linear regression model is not a very accurate
metamodel, as can be seen from the relatively low Q2 score.
The metamodel predictions are not very close to observations,
which is why the points are not close to the diagonal of the plot.
Hence, the confidence intervals do not cross the diagonal very often.
In this case, we may want to create a more accurate metamodel.</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-numerical-methods-general-methods-plot-regression-interval-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/aaeeaf7e431febf4f2321d6843e57aef/plot_regression_interval.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_regression_interval.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/f68df82f058739fbe17f0b947c1f2e7d/plot_regression_interval.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_regression_interval.py</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_regression_sinus.html" title="Compute confidence intervals of a univariate noisy function"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_pce_design.html" title="Compute leave-one-out error of a polynomial chaos expansion"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Numerical methods</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >General methods</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Compute confidence intervals of a regression model from data</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2023 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jan 13, 2024.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>