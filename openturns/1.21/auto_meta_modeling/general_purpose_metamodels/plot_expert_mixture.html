
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Mixture of experts &#8212; OpenTURNS 1.21 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Perform stepwise regression" href="plot_stepwise.html" />
    <link rel="prev" title="Create a linear model" href="plot_linear_model.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_stepwise.html" title="Perform stepwise regression"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_linear_model.html" title="Create a linear model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">General purpose metamodels</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Mixture of experts</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_linear_model.html"
                          title="previous chapter">Create a linear model</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_stepwise.html"
                          title="next chapter">Perform stepwise regression</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/general_purpose_metamodels/plot_expert_mixture.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-general-purpose-metamodels-plot-expert-mixture-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="mixture-of-experts">
<span id="sphx-glr-auto-meta-modeling-general-purpose-metamodels-plot-expert-mixture-py"></span><h1>Mixture of experts<a class="headerlink" href="#mixture-of-experts" title="Permalink to this heading">Â¶</a></h1>
<p>In this example we are going to approximate a piece wise continuous function using an expert mixture of metamodels.</p>
<p>The metamodels will be represented by the family of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAAATBAMAAADi0QeVAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAnYt080gyYOkYr937z7+pyr0UAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABaklEQVQoz2NgwAX4LqGLMN0CkYzKIEkQ6wGSHC8Sm8s/gWHe7wKwkKIJSHUAAwPnBlTV7K0wjgzQnAsQA1zTgQQrkM9ogKKaTfQrjKN1gIFTAaya7QNYoIGBgQPMmPR6twHUJTDVrGGfGdgTwELMDWARid2794H9sn0C3N0w1UwM3QyMYCHOJV0FIJHZDAxXwZYi+RKmmpHBfgJENQO3AkQ2AeQYhE9RVfMLMEGEeAIYZgsAA2ABE0gbuwIW1ekMfAfKIELzgRTILQ3cIAczdu/ejeFLBQbW7woQoRKg8SCh5bkgkl0Ai9lAMV8BiJAsA8MUdlUGhtzlYJkN2FXLQ82+yMBgVyYM9C0kJO2QVH8HmjEB4pf5ARChowwML0DuZoa4ARHenGt/LGWIAap84wxJR6DwBkal62akKEeKSxAwQE4M7JMvMHA62KVipFisqvnrAhhYF8wTwKWaGUWISQlHbsCqmpS8cw8AbN5OBYs3yEwAAAAKdEVYdERlcHRoAAAAAAVXSRWDAAAAAElFTkSuQmCC" alt="f_k \forall \in [1, N]" style="vertical-align: -5px"/>:</p>
<div class="math">
<p><img src="data:image/png;base64,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" alt="\begin{align}
  f(\underline{x}) = f_1(\underline{x}) \quad \forall \underline{z} \in Class\, 1
  \dots
  f(\underline{x}) = f_k(\underline{x}) \quad \forall \underline{z} \in Class\, k
  \dots
  f(\underline{x}) = f_N(\underline{x}) \quad \forall \underline{z} \in Class\, N
\end{align}"/></p>
</div><p>where the N classes are defined by the classifier.</p>
<p>Using the supervised mode the classifier partitions the input and output space at once:</p>
<div class="math">
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAAATBAMAAAB2N65nAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAv/t0SIudYN0yzxjzr+kgV3wLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABWklEQVQoz2NgwADcCThE2IA4gQEb4ELhsQXDRbgFGBg2YtWSjsILs0GImDIwMAdg0/IAhXdkOkKED0MWAlDN4fyAJMJrwMBwGYsWjgkoBjxAEmFfwMBQBaQZlVkckBUxAXGxZKk0xMd33hYgiShApMMq0kAaV4HABSCLh4GBxcAj4DjUzgBkEaAr+YGCExhQA2EeKAL8N0AFmRyQRbSBAhuAopNR/eIHIrJgvP0oIqeBVgK1sDugatkDIh7DeDUoIlC/WIITAsIvQDF2zt+wlJGFIgLRwpwV3oliC98GhhjW06wTOFeDeMuQRBg4GxgYZjAwbOY+U4CaqAwY5lrWmjCwqIJ4KkgiDKzAEAjFEpWcC2CxCIqXD8giHECvd2NLY90ILeybFyCLzELSjgImMvwHgQ/ABMVf6IAsAox/xg3YtLAbQGggxRqKLMIK1B+CNb8wTMAhwglhAQDbv1vRWH80jwAAAAp0RVh0RGVwdGgA/////o6f8XkAAAAASUVORK5CYII=" alt="z =(\underline{x}, f( \underline{x}))"/></p>
</div><p>The classifier is MixtureClassifier based on a MixtureDistribution defined as:</p>
<div class="math">
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI8AAAA1BAMAAACKHKWzAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdJ0yi78YYPuvz93zSOn0RRdxAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACvElEQVRIx+1WTWgTQRR++5O/ZjeJxXjyEC299LQHIVKxWTXxkCrmEL14cCNEipdGRFApNqVSvEgM9GJPoeClp0qL5xwkXuNNBGlO3qSVSvyF8U12dzbZbRph52YfLO/tzPs+Zt7Me28ARsrdFVh4ARxEXgcRuBB9AJkPUSxxnwvRJ6GjcyHS4Tkvoik+RCmYb/PgKW9BAI7kv5Taj2dUaoSQii+ia79NLeXJpi+iKLGzo7z/b4jbpnJXsGCN4ZOHwFLOSMMCFlyei39sK2IcQGTBymxAtEN53OUZIYVD9mHDBFYeYh7Dlt2vhxAx7w64FxJJuHzniDaciMHqtrFlG6GGy1cgneFEDPYYv/GJbAGqSJFM5zCeVbfzrZ/MVJMQSMzhCoXTZ3J0gMHCeE4nvkERmgDv1W0FY7eH84ENKlZTVJw7XVLa4XYMf0vzeoDGl8HiyBiqwpqEy0+pXdq+VtwrkggbqmQgA6Im6JWHEGkIugML417EBrxSaRzEXnha3jT5xcw1mDWb5RSM4bVwYAoSRROwFGzSs0xY23bJmHMB3sG6SfQawujtwDBGEDdCTQqvZAzRIhqIEcScF0QXqc5DnhoLVDEYJdoxYm34DHLzinEJI+JN8g3HXA4ugS4rhtqFL6gc2DmcnLwwAXAKpHq6ju1L9vRCse8ePch+vGjADIjFcQ2VA8vi5Db1mGZ1w5OaJz0jqxDVe8qBvcFvfwA/7Uapy569tvS41lMMJuHJqXs9qxAnVOCGG3XWW2KL2o6pGCyAhE/MDLhnvYU8Xf4tS2dnLLRrH6QFu9p3fwdUX61lZ587KGstf210Cb7J3hLffRV/6+yD6VlS9UW0SJj4eyFPXmdiHD0XhojVsUqbnPiOdTgRSb6J8pyIZOXOSxTD/4pmeG1tlRdR67K5taZfoqJZah49HVVy/gKQKcVL+8ItEQAAAAp0RVh0RGVwdGgA/////o6f8XkAAAAASUVORK5CYII=" alt="p(\underline{x}) = \sum_{i=1}^N w_ip_i(\underline{x})"/></p>
</div><p>The rule to assign a point to a class is defined as follows: <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALBAMAAABbgmoVAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAYHS/MosYSN3znc/pr6KgYnQAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAA9SURBVAjXY2AQMhE1Y2BgV6gImMjAwMVQlxDAAASrGcDgEIhgZHnGsICBIZJ1GqsDA4Oviqw6Azp4BwIPAKOLDba6VLmXAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="\underline{x}" style="vertical-align: -3px"/> is assigned to the class <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAL8AAAAUBAMAAAAuH/EYAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAMvsYdGC/z4vzr51I3ekGmJg+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACz0lEQVQ4y7VUT0gUURz+Zufv7ozrFBElpkYePHSYbBEMxLFCD0msIpVSZBQVBLGHILAOC6asfzIjPQQdJrCMugxhuLgUe7KTqWSnLkadImi3JTra771Z191YMc0ezHzffO+93/fe7zfvAf+liS4Hd6vz59IbDFA9qPNg5+YdNjJ45YEU5RDafoPlP3C7DbIrByb+2UAs2l1iZslp9uroLuxNtJryk7I+4EjsMIZ6Y7dDLUmuouPCmYurBlKc8vxiZsqB0QzFrmUhpcSeft7to0epNpKcyOYNpl25Sa2HuUfVZWmvMwnhs1gjnK3BSVta4Kphz0XHVw1moEQDjko/Ysif9CWDYVbMxqjCk+OnZ+hcAiglomGsYAN3oTrH2q02BG2kJW0UA9AjXNUxb9H8BWYgZiCk/LZOVQxXohK62eAi3I5AhBAVNMQEjfVZLI2ZAoMa+MLWUyLnIVdBcXALJS5XgelcDaQU8FN1AxH6mCR7DSrvV7sZvmNjdrGtMANpND++kMY88IXYG1oOC3sQjaancjnPQL5fwQKM0xo0nu4l+GyG9Sz1yWwxoHTn18BI4bXMN3UZwShtXkhhROaqLGTo8A+yiWmiRkaXWOaRIYty1MvDxDo5srhN0LMGfrsgRVXiV01iB6QF90yMQFvANY2rA9oDzdRCDi/ycyhuIMln7BerKd/NbVNGBt8YImhBmu5bBPax/karwODU8dlend1SgTsvgTgCNrpsrpY1dbVCVGg9s7/CWnwCwsqPD2xG7O2Qheth6FdPmAyh2wiJD4nEWMTOdY/TZDExaOZog3noaO7r0RL9yx5CiGTF9+zVs67BWDHRt0bjVMDV/IqjzeWlpofZwJ5R7Y4DxaPry1LRq2qugOb2Yzh17nwWgd1YYU2h7Kv95joX1qXBonpijRrPYo/zeuTvTo56GxvewjXnfvqrYWbee3Pto7258b8BLb3DE9cSo7AAAAAKdEVYdERlcHRoAAAAAAbOQEQ5AAAAAElFTkSuQmCC" alt="j=argmax_j \log w_kp_k(\underline{z})" style="vertical-align: -6px"/>.</p>
<p>The grade of <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALBAMAAABbgmoVAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAYHS/MosYSN3znc/pr6KgYnQAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAA9SURBVAjXY2AQMhE1Y2BgV6gImMjAwMVQlxDAAASrGcDgEIhgZHnGsICBIZJ1GqsDA4Oviqw6Azp4BwIPAKOLDba6VLmXAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="\underline{x}" style="vertical-align: -3px"/> with respect to the class <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAANBAMAAACJLlk1AAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMASN0YYPuvz+mLnXTzARr72wAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAERJREFUCNdjYNQ1YAACVxDBkA4mO8HkRRDBcoFxFgMDm4KgKAMDR6KDNQMDrwpI3FdMAUgmMRxhBCk/yM3AcJhh1wYGADN9CmFZY5CnAAAACnRFWHREZXB0aAAAAAAAJyPhDAAAAABJRU5ErkJggg==" alt="k" style="vertical-align: 0px"/> is <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAATBAMAAAAXL4wlAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMASN0yv89gdJ2Lrxjz6fv9xBs/AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABu0lEQVQoz42SPUjDUBDH/zFpkjb9CEURXBwEP3CpguIiLQiig9BBxDGgIg5Chg6KIAHF0k71A7TgUJBSdXqooINIRHB2cnERHFwFUdCAei8xwUFoH+Td5d4v9+7+F6DuuvCMRU/ytR6c9cwZ3+rBquFZpdQAHPOduwbgZd+p/YW1/+EO35lzYaWwARwW8xUIOUjmVYofLa2VMy7zCMi5wR2GuAsXIZUilRBpcx7V43qMd6StfGDchW2gVeiJGkhwWHMgvkRNlRow0khDTZ1YkOVHVLVuQKSwJThhIM4IVl6A95AV4XpWsYUwQpRbzWISU4DARVD5WTSA5Zth8nGLaYJ5dU0mnnm9ms3lM2lzaxYdCI6quNo7hPfhUt5Egsm2Zi/o/AMjzdRfGMeQrIjudvOkPaOE3Ewe7SymK6NDJh4QtvfZNtAPNL8Z4UIN4vdXJ8Gz5ZY9hgm6ZX13DdI9hfIQa4M1ylUOpD9Jna6m/JfrLqCHt5SkWgf8aG8AF0Dj8Edp5/rcwV4qIzqamBcVswGcpJb9zELlzBJIIrRpYwRlEt98SSyAhaPywd8/YvEzcOc9s4lGlugZuvcHQWZ2brY7atoAAAAKdEVYdERlcHRoAAAAAAVXSRWDAAAAAElFTkSuQmCC" alt="\log w_kp_k(\underline{x})" style="vertical-align: -5px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">openturns.viewer</span> <span class="k">as</span> <span class="nn">viewer</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Define the piecewise model we want to rebuild</span>


<span class="k">def</span> <span class="nf">piecewise</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="c1"># if x &lt; 0.0:</span>
    <span class="c1">#     f = (x+0.75)**2-0.75**2</span>
    <span class="c1"># else:</span>
    <span class="c1">#     f = 2.0-x**2</span>
    <span class="n">xarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">piecewise</span><span class="p">(</span>
        <span class="n">xarray</span><span class="p">,</span>
        <span class="p">[</span><span class="n">xarray</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xarray</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">],</span>
    <span class="p">)</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">PythonFunction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">func_sample</span><span class="o">=</span><span class="n">piecewise</span><span class="p">)</span>
</pre></div>
</div>
<p>Build a metamodel over each segment</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">degree</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">samplingSize</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">enumerateFunction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearEnumerateFunction</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
<span class="n">productBasis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">OrthogonalProductPolynomialFactory</span><span class="p">(</span>
    <span class="p">[</span><span class="n">ot</span><span class="o">.</span><span class="n">LegendreFactory</span><span class="p">()]</span> <span class="o">*</span> <span class="n">dimension</span><span class="p">,</span> <span class="n">enumerateFunction</span>
<span class="p">)</span>
<span class="n">adaptiveStrategy</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FixedStrategy</span><span class="p">(</span>
    <span class="n">productBasis</span><span class="p">,</span> <span class="n">enumerateFunction</span><span class="o">.</span><span class="n">getStrataCumulatedCardinal</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Segment 1: (-1.0; 0.0)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">samplingSize</span><span class="p">)</span>
<span class="n">Y1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X1</span><span class="p">)</span>
<span class="n">fc1</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosAlgorithm</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">adaptiveStrategy</span><span class="p">)</span>
<span class="n">fc1</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mm1</span> <span class="o">=</span> <span class="n">fc1</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">mm1</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_expert_mixture_001.png" srcset="../../_images/sphx_glr_plot_expert_mixture_001.png" alt="y0 as a function of X0" class = "sphx-glr-single-img"/><p>Segment 2: (0.0, 1.0)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">samplingSize</span><span class="p">)</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X2</span><span class="p">)</span>
<span class="n">fc2</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">FunctionalChaosAlgorithm</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">adaptiveStrategy</span><span class="p">)</span>
<span class="n">fc2</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mm2</span> <span class="o">=</span> <span class="n">fc2</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span><span class="o">.</span><span class="n">getMetaModel</span><span class="p">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">mm2</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_expert_mixture_002.png" srcset="../../_images/sphx_glr_plot_expert_mixture_002.png" alt="y0 as a function of X0" class = "sphx-glr-single-img"/><p>Define the mixture</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">CorrelationMatrix</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>  <span class="c1"># segment 1</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Normal</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>  <span class="c1"># segment 2</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">]</span>
<span class="n">mixture</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Mixture</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>Create the classifier based on the mixture</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">classifier</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">MixtureClassifier</span><span class="p">(</span><span class="n">mixture</span><span class="p">)</span>
</pre></div>
</div>
<p>Create local experts using the metamodels</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">experts</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Basis</span><span class="p">([</span><span class="n">mm1</span><span class="p">,</span> <span class="n">mm2</span><span class="p">])</span>
</pre></div>
</div>
<p>Create a mixture of experts</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluation</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">ExpertMixture</span><span class="p">(</span><span class="n">experts</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span>
<span class="n">moe</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span>
</pre></div>
</div>
<p>Draw the mixture of experts</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">moe</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_expert_mixture_003.png" srcset="../../_images/sphx_glr_plot_expert_mixture_003.png" alt="y0 as a function of X0" class = "sphx-glr-single-img"/><div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-general-purpose-metamodels-plot-expert-mixture-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/de76f0e87f98cf3b852e8f6ca1be12c2/plot_expert_mixture.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_expert_mixture.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/bc81dfa68bee63e19bff7605649ba3dd/plot_expert_mixture.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_expert_mixture.ipynb</span></code></a></p>
</div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_stepwise.html" title="Perform stepwise regression"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_linear_model.html" title="Create a linear model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >General purpose metamodels</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Mixture of experts</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2023 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jun 21, 2023.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>