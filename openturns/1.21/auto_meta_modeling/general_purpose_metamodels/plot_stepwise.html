
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Perform stepwise regression &#8212; OpenTURNS 1.21rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/openturns.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/mysearchtools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Over-fitting and model selection" href="plot_overfitting_model_selection.html" />
    <link rel="prev" title="Mixture of experts" href="plot_expert_mixture.html" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="http://www.openturns.org/">Home</a></li>
    <li><a href="../../install.html">Get it</a></li>
    <li><a href="../../contents.html">Doc</a></li>
    <li><a href="https://openturns.discourse.group/">Forum</a></li>
    <li><a href="https://gitter.im/openturns/community">Chat</a></li>
    <li><a href="https://github.com/openturns/openturns/wiki/Modules">Modules</a></li>
    <li><a href="https://github.com/openturns">Code</a></li>
    <li><a href="https://github.com/openturns/openturns/issues">Bugs</a></li>
  </ul>
  <a href="../../index.html">
    <h1>
      <img src="../../_static/logo-openturns-wo-bg.png" alt="" width=100px height=100px />
      OpenTURNS
    </h1>
    <h2> An Open source initiative for the Treatment of Uncertainties, Risks'N Statistics</h2>
  </a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plot_overfitting_model_selection.html" title="Over-fitting and model selection"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_expert_mixture.html" title="Mixture of experts"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.21rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">General purpose metamodels</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Perform stepwise regression</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Perform stepwise regression</a><ul>
<li><a class="reference internal" href="#complete-linear-model">Complete linear model</a></li>
<li><a class="reference internal" href="#forward-stepwise-regression">Forward stepwise regression</a></li>
<li><a class="reference internal" href="#backward-stepwise-regression">Backward stepwise regression</a></li>
<li><a class="reference internal" href="#both-directions-stepwise-regression">Both directions stepwise regression</a></li>
<li><a class="reference internal" href="#graphical-analyses">Graphical analyses</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plot_expert_mixture.html"
                          title="previous chapter">Mixture of experts</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_overfitting_model_selection.html"
                          title="next chapter">Over-fitting and model selection</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_meta_modeling/general_purpose_metamodels/plot_stepwise.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-meta-modeling-general-purpose-metamodels-plot-stepwise-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="perform-stepwise-regression">
<span id="sphx-glr-auto-meta-modeling-general-purpose-metamodels-plot-stepwise-py"></span><h1>Perform stepwise regression<a class="headerlink" href="#perform-stepwise-regression" title="Permalink to this heading">Â¶</a></h1>
<p>In this example we perform the selection of the most suitable function basis for a linear regression model with the help of the stepwise algorithm.</p>
<p>We consider te so-called Linthurst data set, which contains measures of aerial biomass (BIO) as well as 5 five physicochemical properties of the soil: salinity (SAL), pH, K, Na, and Zn.</p>
<p>The data set is taken from the book <a class="reference internal" href="../../bibliography.html#rawlings2001" id="id1"><span>[rawlings2001]</span></a>
and is provided below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openturns</span> <span class="k">as</span> <span class="nn">ot</span>
<span class="kn">from</span> <span class="nn">openturns.viewer</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">openturns.usecases</span> <span class="kn">import</span> <span class="n">linthurst</span>
</pre></div>
</div>
<p>We define the data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">linthurst</span><span class="o">.</span><span class="n">Linthurst</span><span class="p">()</span>
<span class="n">dimension</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">input_sample</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_sample</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">output_sample</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_sample</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

<span class="n">input_description</span> <span class="o">=</span> <span class="n">input_sample</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>
<span class="n">output_description</span> <span class="o">=</span> <span class="n">output_sample</span><span class="o">.</span><span class="n">getDescription</span><span class="p">()</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">input_sample</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n = &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">dimension</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getDimension</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dimension = &quot;</span><span class="p">,</span> <span class="n">dimension</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Input :
    [ SAL        pH         K          Na         Zn         ]
0 : [    33          5       1441.67   35185.5       16.4524 ]
1 : [    35          4.75    1299.19   28170.4       13.9852 ]
2 : [    32          4.2     1154.27   26455         15.3276 ]
3 : [    30          4.4     1045.15   25072.9       17.3128 ]
4 : [    33          5.55     521.62   31664.2       22.3312 ]
Output :
    [ BIO  ]
0 : [  676 ]
1 : [  516 ]
2 : [ 1052 ]
3 : [  868 ]
4 : [ 1008 ]
n =  45
dimension =  5
</pre></div>
</div>
<section id="complete-linear-model">
<h2>Complete linear model<a class="headerlink" href="#complete-linear-model" title="Permalink to this heading">Â¶</a></h2>
<p>We consider a linear model with the purpose of predicting the aerial biomass as a function of the soil physicochemical properties,
and we wish to identify the predictive variables which result in the most simple and precise linear regression model.</p>
<p>We start by creating a linear model which takes into account all of the physicochemical variables present within the Linthrust data set.</p>
<p>Let us consider the following linear model <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALkAAAAXBAMAAACllfPxAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr+kyi0gYYL/73c90nfO15AxJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACV0lEQVRIx2NgIBlkXSBFNaOiiQEp6rkLSFEdxt5Kkts5GWgIZC5R38z5WqtWrdL8/4+BK+AiCdosfjYwMPQvJ6TsvACIzHkfEMfQjinLJvk7gefnNiz69gOxC0FHcHwHU7wNHgzPsEjzfmZgW4BNX/0BBtYDuI1lg9IvE8CUwEHmZ1hUs31kYIRzEpCTwAKGXDyOZoGmP3sFiE6OM3uxKdvJIABnuyMn929IErhN5/mIN+TizyZgNZ31C2MCeijeCcYwnWE/tkx09yg0I/JNZkA3nVcQpOORM4TXvRsINoJYSxg2YZrONw3TcC4HbgVorH/GMF0HTMqjO4plAcNGhtizaKaz/sI03YuBW4DhCIhV8wMUeg5IpnNsAFNyGFndgWE6wwIWB7B/NmlD/MPAIIVp+hQGTojlrAd2wpLu7t1Ku3cDY5J/owiIr4Gux96A9QP7BtYFqG5nhobBEUgSPAUS+swQDxE0YYh3QAuZfEiM/GFAC/d4Bt4FtQ2sE1BN50IpSHkOgVz8geEWOwswBNgEGJiAlnsjm84PVs/+DbMQTBJwbGBGM307qiIjEDGBTZHFAZh3rYHqvjKw8CUghzvIM2xyHwPQTGfvOdqSi+52RojPzVg2IJlecSbCDRhiUT8DGIL+XYCIwdOMyJEEXLmDfQM7arifgFAbHJ4lCgoKisFMglsLNg8zN+EACiwQXWwQBzBD7MoSgEUu3HS+FLieZxAtaYRNjz2Iwk0CWcJW+N8A5lS46RzOcEUtBmTWHuv/g8E/oFMhIWNHk4oP6lR2SWciFAMAjDGTFPKe0KQAAAAKdEVYdERlcHRoAAAAAAVXSRWDAAAAAElFTkSuQmCC" alt="\tilde{Y} = a_0 + \sum_{i = 1}^{d} a_i X_i + \epsilon" style="vertical-align: -5px"/>. If all of the predictive variables
are considered, the regression can be performed with the help of the <a class="reference internal" href="../../user_manual/response_surface/_generated/openturns.LinearModelAlgorithm.html#openturns.LinearModelAlgorithm" title="openturns.LinearModelAlgorithm"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearModelAlgorithm</span></code></a> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">algo_full</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelAlgorithm</span><span class="p">(</span><span class="n">input_sample</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">)</span>
<span class="n">algo_full</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result_full</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelResult</span><span class="p">(</span><span class="n">algo_full</span><span class="o">.</span><span class="n">getResult</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared = &quot;</span><span class="p">,</span> <span class="n">result_full</span><span class="o">.</span><span class="n">getRSquared</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted R-squared = &quot;</span><span class="p">,</span> <span class="n">result_full</span><span class="o">.</span><span class="n">getAdjustedRSquared</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>R-squared =  0.677310820565376
Adjusted R-squared =  0.6359404129455524
</pre></div>
</div>
</section>
<section id="forward-stepwise-regression">
<h2>Forward stepwise regression<a class="headerlink" href="#forward-stepwise-regression" title="Permalink to this heading">Â¶</a></h2>
<p>We now wish to perform the selection of the most important predictive variables through a stepwise algorithm.</p>
<p>It is first necessary to define a suitable function basis for the regression. Each variable is associated to a univariate basis
and an additional basis is used in order to represent the constant term <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAALBAMAAABSacpvAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAnXRIMt2Lz+mv+2AYvwxtY48AAAAJcEhZcwAADsQAAA7EAZUrDhsAAABYSURBVAjXY2BgFDJhAIMwhgowzRbAUMlgqMjAwJXAsJohgC2Bwc+B+QF3AXMAgx0DY8DGC8wLGLgYTkzIvMCygIH7kvK1gyAREOAu4A6AmNUA1AUGhpoMAFJfElOiLF2wAAAACnRFWHREZXB0aAAAAAADviqwtgAAAABJRU5ErkJggg==" alt="a_0" style="vertical-align: -3px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">functions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">(</span><span class="n">input_description</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.0&quot;</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
    <span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ot</span><span class="o">.</span><span class="n">SymbolicFunction</span><span class="p">(</span><span class="n">input_description</span><span class="p">,</span> <span class="p">[</span><span class="n">input_description</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">Basis</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
</pre></div>
</div>
<p>Plese note that this example uses a linear basis with respect to the various predictors for the sake of clarity.
However, this is not a necessity, and more complex and non linear relations between predictors may be considered
(e.g., polynomial bases).</p>
<p>We now perform a forward stepwise regression. We suppose having no information regarding the given data set, and therefore the set of minimal
indices only contains the constant term (indexed by 0).</p>
<p>The first regression is performed by relying on the Akaike Information Criterion (AIC), which translates into a penalty term equal to 2.
In practice, the algorithm selects the functional basis subset that minimizes the AIC by iteratively adding the single function which provides
the largest improvement until convergence is reached.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minimalIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="o">.</span><span class="n">FORWARD</span>
<span class="n">penalty</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">algo_forward</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="p">(</span>
    <span class="n">input_sample</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">minimalIndices</span><span class="p">,</span> <span class="n">direction</span>
<span class="p">)</span>
<span class="n">algo_forward</span><span class="o">.</span><span class="n">setPenalty</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span>
<span class="n">algo_forward</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result_forward</span> <span class="o">=</span> <span class="n">algo_forward</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected basis: &quot;</span><span class="p">,</span> <span class="n">result_forward</span><span class="o">.</span><span class="n">getCoefficientsNames</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared = &quot;</span><span class="p">,</span> <span class="n">result_forward</span><span class="o">.</span><span class="n">getRSquared</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted R-squared = &quot;</span><span class="p">,</span> <span class="n">result_forward</span><span class="o">.</span><span class="n">getAdjustedRSquared</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[Na]]
R-squared =  0.658432822226285
Adjusted R-squared =  0.6421677185227748
</pre></div>
</div>
<p>With this first forward stepwise regression, the results show that the selected optimal basis contains a constant term,
plus two linear terms depending respectively on the pH value (pH) and on the sodium concentration (Na).</p>
<p>As can be expected, the R-squared value diminishes if compared to the regression on the entire basis, as the stepwise
regression results in a lower number of predictive variables.  However, it can also be seen that the adjusted R-squared,
which is a metric that also takes into account the ratio  between the amount of training data and the number of explanatory
variables, is improved if compared to the complete model.</p>
</section>
<section id="backward-stepwise-regression">
<h2>Backward stepwise regression<a class="headerlink" href="#backward-stepwise-regression" title="Permalink to this heading">Â¶</a></h2>
<p>We now perform a backward stepwise regression, meaning that rather than iteratively adding predictive variables, we will be removing them,
starting from the complete model.
This regression is performed by relying on the Bayesian Information Criterion (BIC), which translates into a penalty term equal to <img class="math" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAATBAMAAAAkFJMsAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAr/O/6XQYYIsy+89Ind1qTupWAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABF0lEQVQY012Rv0vDQBTHP9GkvSutEaWTDll0FkQ3IVNxERwLotTFTRoEN8EI/sjWrtqhnaRj/gCF/AcuCkUXVzfXbr4jpjk9uHvfe5/H+3EHf9ZpbhrmWNqwQJqbivG5+6W/Ef2Ktmy/UwLXFmdWpnYhHEmzbIGvQlSl2C54k1U4Tk4YweFt8iRE1BR2eEC3KmMC9MWYIwHfVEeoED+T5qY6xFMBHwIecVJqMd3sUkLqIcwv8ixgHTdm2KfHq4RUAqhFJrnU8O+zF9hj04RIySFeGBnQVcxlKuWAXp8WXEuyGP2Jc4duJjLSzTu8wYR6s4OKrelWYFDoBeudWLPug/JdQ0961cUXbM+At3VlzHl+Uxn/lp6ZHzUVN2Wl+GtSAAAACnRFWHREZXB0aAAAAAAFV0kVgwAAAABJRU5ErkJggg==" alt="log(n)" style="vertical-align: -5px"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minimalIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="o">.</span><span class="n">BACKWARD</span>
<span class="n">penalty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">algo_backward</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="p">(</span>
    <span class="n">input_sample</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">minimalIndices</span><span class="p">,</span> <span class="n">direction</span>
<span class="p">)</span>
<span class="n">algo_backward</span><span class="o">.</span><span class="n">setPenalty</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span>
<span class="n">algo_backward</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result_backward</span> <span class="o">=</span> <span class="n">algo_backward</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected basis: &quot;</span><span class="p">,</span> <span class="n">result_backward</span><span class="o">.</span><span class="n">getCoefficientsNames</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared = &quot;</span><span class="p">,</span> <span class="n">result_backward</span><span class="o">.</span><span class="n">getRSquared</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted R-squared = &quot;</span><span class="p">,</span> <span class="n">result_backward</span><span class="o">.</span><span class="n">getAdjustedRSquared</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[K]]
R-squared =  0.6475759074104157
Adjusted R-squared =  0.6307938077632926
</pre></div>
</div>
<p>It is interesting to point out that although both approaches converge towards a model characterized by 2 predictive variables,
the selected variables do not coincide.</p>
</section>
<section id="both-directions-stepwise-regression">
<h2>Both directions stepwise regression<a class="headerlink" href="#both-directions-stepwise-regression" title="Permalink to this heading">Â¶</a></h2>
<p>A third available option consists in performing a stepwise regression in both directions, meaning that at each iteration the predictive variables
can be either added or removed. In this case, a set of starting indices must be provided to the algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minimalIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">startIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">penalty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="o">.</span><span class="n">BOTH</span>
<span class="n">algo_both</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="p">(</span>
    <span class="n">input_sample</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">minimalIndices</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">startIndices</span>
<span class="p">)</span>
<span class="n">algo_both</span><span class="o">.</span><span class="n">setPenalty</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span>
<span class="n">algo_both</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result_both</span> <span class="o">=</span> <span class="n">algo_both</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected basis: &quot;</span><span class="p">,</span> <span class="n">result_both</span><span class="o">.</span><span class="n">getCoefficientsNames</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared = &quot;</span><span class="p">,</span> <span class="n">result_both</span><span class="o">.</span><span class="n">getRSquared</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted R-squared = &quot;</span><span class="p">,</span> <span class="n">result_both</span><span class="o">.</span><span class="n">getAdjustedRSquared</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[K]]
R-squared =  0.6475759074104157
Adjusted R-squared =  0.6307938077632926
</pre></div>
</div>
<p>It is interesting to note that the basis varies depending on the selected set of starting indices, as is shown below.
An informed initialization might therefore improve the model selection and the resulting regression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minimalIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">startIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">penalty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="o">.</span><span class="n">BOTH</span>
<span class="n">algo_both</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="p">(</span>
    <span class="n">input_sample</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">minimalIndices</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">startIndices</span>
<span class="p">)</span>
<span class="n">algo_both</span><span class="o">.</span><span class="n">setPenalty</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span>
<span class="n">algo_both</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">result_both</span> <span class="o">=</span> <span class="n">algo_both</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected basis: &quot;</span><span class="p">,</span> <span class="n">result_both</span><span class="o">.</span><span class="n">getCoefficientsNames</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared = &quot;</span><span class="p">,</span> <span class="n">result_both</span><span class="o">.</span><span class="n">getRSquared</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adjusted R-squared = &quot;</span><span class="p">,</span> <span class="n">result_both</span><span class="o">.</span><span class="n">getAdjustedRSquared</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[Na]]
R-squared =  0.658432822226285
Adjusted R-squared =  0.6421677185227748
</pre></div>
</div>
</section>
<section id="graphical-analyses">
<h2>Graphical analyses<a class="headerlink" href="#graphical-analyses" title="Permalink to this heading">Â¶</a></h2>
<p>Finally, we can rely on the LinearModelAnalysis class in order to analyse
the predictive differences between the obtained models.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">analysis_full</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelAnalysis</span><span class="p">(</span><span class="n">result_full</span><span class="p">)</span>
<span class="n">analysis_full</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;Full model&quot;</span><span class="p">)</span>
<span class="n">analysis_forward</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelAnalysis</span><span class="p">(</span><span class="n">result_forward</span><span class="p">)</span>
<span class="n">analysis_forward</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;Forward selection&quot;</span><span class="p">)</span>
<span class="n">analysis_backward</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelAnalysis</span><span class="p">(</span><span class="n">result_backward</span><span class="p">)</span>
<span class="n">analysis_backward</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;Backward selection&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">analysis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">analysis_full</span><span class="p">,</span> <span class="n">analysis_forward</span><span class="p">,</span> <span class="n">analysis_backward</span><span class="p">]):</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">drawModelVsFitted</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setXTitle</span><span class="p">(</span><span class="s2">&quot;Exact values&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">View</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_stepwise_001.png" srcset="../../_images/sphx_glr_plot_stepwise_001.png" alt=", Full model, Forward selection, Backward selection" class = "sphx-glr-single-img"/><p>For illustrative purposes, we show the Bayesian Information Criterion (BIC) and Akaike Information Criterion (AIC) values
which are computed during the iterations of the forward step-wise regression. Please note that in order to do
so, we set the penalty parameter to a negligible value (meaning that the basis selection only takes into account the model likelihood,
and not the number of parameters characterizing the linear model).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minimalIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">penalty</span> <span class="o">=</span> <span class="mf">1e-10</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="o">.</span><span class="n">FORWARD</span>

<span class="n">BIC</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">AIC</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">iterations</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
    <span class="n">algo_forward</span> <span class="o">=</span> <span class="n">ot</span><span class="o">.</span><span class="n">LinearModelStepwiseAlgorithm</span><span class="p">(</span>
        <span class="n">input_sample</span><span class="p">,</span> <span class="n">output_sample</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">minimalIndices</span><span class="p">,</span> <span class="n">direction</span>
    <span class="p">)</span>
    <span class="n">algo_forward</span><span class="o">.</span><span class="n">setPenalty</span><span class="p">(</span><span class="n">penalty</span><span class="p">)</span>
    <span class="n">algo_forward</span><span class="o">.</span><span class="n">setMaximumIterationNumber</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span>
    <span class="n">algo_forward</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">result_forward</span> <span class="o">=</span> <span class="n">algo_forward</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>

    <span class="n">RSS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_forward</span><span class="o">.</span><span class="n">getSampleResiduals</span><span class="p">())</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span>  <span class="c1"># Residual sum of squares</span>
    <span class="n">LL</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">RSS</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Log-likelihood</span>
    <span class="n">BIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LL</span> <span class="o">+</span> <span class="n">iterations</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  <span class="c1"># Bayesian Information Criterion</span>
    <span class="n">AIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LL</span> <span class="o">+</span> <span class="n">iterations</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Akaike Information Criterion</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected basis: &quot;</span><span class="p">,</span> <span class="n">result_forward</span><span class="o">.</span><span class="n">getCoefficientsNames</span><span class="p">())</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">BIC</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BIC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">AIC</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Basis size&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Information criterion&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_stepwise_002.png" srcset="../../_images/sphx_glr_plot_stepwise_002.png" alt="plot stepwise" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH]]
Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[Na]]
Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[Na],[SAL,pH,K,Na,Zn]-&gt;[Zn]]
Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[Na],[SAL,pH,K,Na,Zn]-&gt;[Zn],[SAL,pH,K,Na,Zn]-&gt;[SAL]]
Selected basis:  [[SAL,pH,K,Na,Zn]-&gt;[1.0],[SAL,pH,K,Na,Zn]-&gt;[pH],[SAL,pH,K,Na,Zn]-&gt;[Na],[SAL,pH,K,Na,Zn]-&gt;[Zn],[SAL,pH,K,Na,Zn]-&gt;[SAL],[SAL,pH,K,Na,Zn]-&gt;[K]]
</pre></div>
</div>
<p>The graphic above shows that the optimal linear model in terms of compromise between prediction likelihood and model complexity
should take into account the influence of 2 regession variables as well as the constant term. This is coherent with the results previously
obtained</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-meta-modeling-general-purpose-metamodels-plot-stepwise-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/8677fc6ed2491dc75de1683ff8c9be3d/plot_stepwise.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_stepwise.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/195cf2ed9aeeecf4d4a69f4ae0519022/plot_stepwise.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_stepwise.ipynb</span></code></a></p>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plot_overfitting_model_selection.html" title="Over-fitting and model selection"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_expert_mixture.html" title="Mixture of experts"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">OpenTURNS 1.21rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contents.html" >Contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../examples/examples.html" >Examples</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >Meta modeling</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >General purpose metamodels</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Perform stepwise regression</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005-2023 Airbus-EDF-IMACS-ONERA-Phimeca.
      Last updated on Jun 20, 2023.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>