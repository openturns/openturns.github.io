
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/reliability_problems/plot_reliability_compute_reference_proba.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_reliability_problems_plot_reliability_compute_reference_proba.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_reliability_problems_plot_reliability_compute_reference_proba.py:


Compute reference probabilities with Monte-Carlo
================================================

.. GENERATED FROM PYTHON SOURCE LINES 7-10

In this example, we perform a reliability benchmark based on a large Monte-Carlo sample.
In order to limit the elapsed time, we consider a limited elapsed time for each problem.
In order to get the best possible accuracy within this time limit, we set the coefficient of variation to zero.

.. GENERATED FROM PYTHON SOURCE LINES 12-19

.. code-block:: Python

    import otbenchmark as otb
    import pandas as pd
    import numpy as np
    from tqdm import tqdm
    import time









.. GENERATED FROM PYTHON SOURCE LINES 20-25

.. code-block:: Python

    problemslist = otb.ReliabilityBenchmarkProblemList()
    numberOfProblems = len(problemslist)
    numberOfProblems






.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    26



.. GENERATED FROM PYTHON SOURCE LINES 26-31

.. code-block:: Python

    coefficientOfVariation = 0.0
    maximumOuterSampling = 10 ** 4  # 10 ** 6 for real
    blockSize = 10 ** 0  # 10 ** 4 for real simulations
    blockSize





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    1



.. GENERATED FROM PYTHON SOURCE LINES 32-35

.. code-block:: Python

    confidenceLevel = 0.95
    maximumDurationSeconds = 5 * 60.0








.. GENERATED FROM PYTHON SOURCE LINES 36-39

.. code-block:: Python

    totalDurationMinutes = numberOfProblems * maximumDurationSeconds / 60.0
    totalDurationMinutes





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    130.0



.. GENERATED FROM PYTHON SOURCE LINES 40-79

.. code-block:: Python

    model_names = [problemslist[i].getName() for i in range(numberOfProblems)]
    metrics = ["PF", "N. function calls", "PMin", "PMax", "C.O.V.", "Digits", "Time (s)"]
    resultArray = np.zeros((numberOfProblems, len(metrics)))
    for i in tqdm(range(numberOfProblems)):
        startTime = time.time()
        problem = problemslist[i]
        name = problem.getName()
        event = problem.getEvent()
        g = event.getFunction()
        factory = otb.ProbabilitySimulationAlgorithmFactory()
        algo = factory.buildMonteCarlo(problem)
        algo.setMaximumOuterSampling(maximumOuterSampling)
        algo.setBlockSize(blockSize)
        algo.setMaximumCoefficientOfVariation(coefficientOfVariation)
        algo.setMaximumTimeDuration(maximumDurationSeconds)
        initialNumberOfCall = g.getEvaluationCallsNumber()
        algo.run()
        result = algo.getResult()
        numberOfFunctionEvaluations = g.getEvaluationCallsNumber() - initialNumberOfCall
        computedProbability = result.getProbabilityEstimate()
        confidenceLength = result.getConfidenceLength(confidenceLevel)
        pmin = computedProbability - 0.5 * confidenceLength
        pmax = computedProbability + 0.5 * confidenceLength
        cov = result.getCoefficientOfVariation()
        if cov > 0.0:
            expectedDigits = -np.log10(cov) - 1.0
        else:
            expectedDigits = 0.0
        stopTime = time.time()
        elapsedTime = stopTime - startTime
        resultArray[i][0] = computedProbability
        resultArray[i][1] = numberOfFunctionEvaluations
        resultArray[i][2] = pmin
        resultArray[i][3] = pmax
        resultArray[i][4] = cov
        resultArray[i][5] = expectedDigits
        resultArray[i][6] = elapsedTime






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/26 [00:00<?, ?it/s]      4%|▍         | 1/26 [00:00<00:16,  1.49it/s]      8%|▊         | 2/26 [00:00<00:09,  2.58it/s]     15%|█▌        | 4/26 [00:00<00:03,  5.65it/s]     23%|██▎       | 6/26 [00:01<00:02,  8.33it/s]     31%|███       | 8/26 [00:01<00:01, 10.57it/s]     38%|███▊      | 10/26 [00:01<00:01, 11.50it/s]     50%|█████     | 13/26 [00:01<00:01, 12.27it/s]     65%|██████▌   | 17/26 [00:01<00:00, 16.86it/s]     77%|███████▋  | 20/26 [00:02<00:00, 10.68it/s]     85%|████████▍ | 22/26 [00:02<00:00,  9.29it/s]    100%|██████████| 26/26 [00:02<00:00, 13.45it/s]    100%|██████████| 26/26 [00:02<00:00, 10.04it/s]




.. GENERATED FROM PYTHON SOURCE LINES 80-84

.. code-block:: Python

    df = pd.DataFrame(resultArray, index=model_names, columns=metrics)
    # df.to_csv("reliability_compute_reference_proba.csv")
    df






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>PF</th>
          <th>N. function calls</th>
          <th>PMin</th>
          <th>PMax</th>
          <th>C.O.V.</th>
          <th>Digits</th>
          <th>Time (s)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>RP8</th>
          <td>0.0009</td>
          <td>10000.0</td>
          <td>0.000312</td>
          <td>0.001488</td>
          <td>0.333183</td>
          <td>-0.522683</td>
          <td>0.669825</td>
        </tr>
        <tr>
          <th>RP14</th>
          <td>0.0005</td>
          <td>10000.0</td>
          <td>0.000062</td>
          <td>0.000938</td>
          <td>0.447102</td>
          <td>-0.650406</td>
          <td>0.190267</td>
        </tr>
        <tr>
          <th>RP22</th>
          <td>0.0050</td>
          <td>10000.0</td>
          <td>0.003618</td>
          <td>0.006382</td>
          <td>0.141067</td>
          <td>-0.149427</td>
          <td>0.051356</td>
        </tr>
        <tr>
          <th>RP24</th>
          <td>0.0016</td>
          <td>10000.0</td>
          <td>0.000817</td>
          <td>0.002383</td>
          <td>0.249800</td>
          <td>-0.397592</td>
          <td>0.051584</td>
        </tr>
        <tr>
          <th>RP25</th>
          <td>0.0000</td>
          <td>10000.0</td>
          <td>0.000000</td>
          <td>0.000000</td>
          <td>-1.000000</td>
          <td>0.000000</td>
          <td>0.055840</td>
        </tr>
        <tr>
          <th>RP28</th>
          <td>0.0000</td>
          <td>10000.0</td>
          <td>0.000000</td>
          <td>0.000000</td>
          <td>-1.000000</td>
          <td>0.000000</td>
          <td>0.057107</td>
        </tr>
        <tr>
          <th>RP31</th>
          <td>0.0026</td>
          <td>10000.0</td>
          <td>0.001602</td>
          <td>0.003598</td>
          <td>0.195861</td>
          <td>-0.291948</td>
          <td>0.052056</td>
        </tr>
        <tr>
          <th>RP33</th>
          <td>0.0027</td>
          <td>10000.0</td>
          <td>0.001683</td>
          <td>0.003717</td>
          <td>0.192190</td>
          <td>-0.283731</td>
          <td>0.061380</td>
        </tr>
        <tr>
          <th>RP35</th>
          <td>0.0042</td>
          <td>10000.0</td>
          <td>0.002932</td>
          <td>0.005468</td>
          <td>0.153979</td>
          <td>-0.187461</td>
          <td>0.052402</td>
        </tr>
        <tr>
          <th>RP38</th>
          <td>0.0071</td>
          <td>10000.0</td>
          <td>0.005454</td>
          <td>0.008746</td>
          <td>0.118256</td>
          <td>-0.072824</td>
          <td>0.094761</td>
        </tr>
        <tr>
          <th>RP53</th>
          <td>0.0305</td>
          <td>10000.0</td>
          <td>0.027130</td>
          <td>0.033870</td>
          <td>0.056380</td>
          <td>0.248876</td>
          <td>0.048982</td>
        </tr>
        <tr>
          <th>RP55</th>
          <td>0.5529</td>
          <td>10000.0</td>
          <td>0.543155</td>
          <td>0.562645</td>
          <td>0.008992</td>
          <td>1.046121</td>
          <td>0.049190</td>
        </tr>
        <tr>
          <th>RP54</th>
          <td>0.0009</td>
          <td>10000.0</td>
          <td>0.000312</td>
          <td>0.001488</td>
          <td>0.333183</td>
          <td>-0.522683</td>
          <td>0.124994</td>
        </tr>
        <tr>
          <th>RP57</th>
          <td>0.0301</td>
          <td>10000.0</td>
          <td>0.026751</td>
          <td>0.033449</td>
          <td>0.056765</td>
          <td>0.245920</td>
          <td>0.027397</td>
        </tr>
        <tr>
          <th>RP75</th>
          <td>0.0094</td>
          <td>10000.0</td>
          <td>0.007509</td>
          <td>0.011291</td>
          <td>0.102656</td>
          <td>-0.011385</td>
          <td>0.023459</td>
        </tr>
        <tr>
          <th>RP89</th>
          <td>0.0057</td>
          <td>10000.0</td>
          <td>0.004224</td>
          <td>0.007176</td>
          <td>0.132075</td>
          <td>-0.120821</td>
          <td>0.023571</td>
        </tr>
        <tr>
          <th>RP107</th>
          <td>0.0000</td>
          <td>10000.0</td>
          <td>0.000000</td>
          <td>0.000000</td>
          <td>-1.000000</td>
          <td>0.000000</td>
          <td>0.056536</td>
        </tr>
        <tr>
          <th>RP110</th>
          <td>0.0000</td>
          <td>10000.0</td>
          <td>0.000000</td>
          <td>0.000000</td>
          <td>-1.000000</td>
          <td>0.000000</td>
          <td>0.025389</td>
        </tr>
        <tr>
          <th>RP111</th>
          <td>0.0000</td>
          <td>10000.0</td>
          <td>0.000000</td>
          <td>0.000000</td>
          <td>-1.000000</td>
          <td>0.000000</td>
          <td>0.024765</td>
        </tr>
        <tr>
          <th>RP63</th>
          <td>0.0006</td>
          <td>10000.0</td>
          <td>0.000120</td>
          <td>0.001080</td>
          <td>0.408126</td>
          <td>-0.610794</td>
          <td>0.441558</td>
        </tr>
        <tr>
          <th>RP91</th>
          <td>0.0003</td>
          <td>10000.0</td>
          <td>-0.000039</td>
          <td>0.000639</td>
          <td>0.577264</td>
          <td>-0.761374</td>
          <td>0.037605</td>
        </tr>
        <tr>
          <th>RP60</th>
          <td>0.0458</td>
          <td>10000.0</td>
          <td>0.041703</td>
          <td>0.049897</td>
          <td>0.045644</td>
          <td>0.340613</td>
          <td>0.267488</td>
        </tr>
        <tr>
          <th>RP77</th>
          <td>0.0000</td>
          <td>10000.0</td>
          <td>0.000000</td>
          <td>0.000000</td>
          <td>-1.000000</td>
          <td>0.000000</td>
          <td>0.030512</td>
        </tr>
        <tr>
          <th>Four-branch serial system</th>
          <td>0.0019</td>
          <td>10000.0</td>
          <td>0.001046</td>
          <td>0.002754</td>
          <td>0.229198</td>
          <td>-0.360210</td>
          <td>0.024115</td>
        </tr>
        <tr>
          <th>R-S</th>
          <td>0.0828</td>
          <td>10000.0</td>
          <td>0.077399</td>
          <td>0.088201</td>
          <td>0.033283</td>
          <td>0.477783</td>
          <td>0.023154</td>
        </tr>
        <tr>
          <th>Axial stressed beam</th>
          <td>0.0297</td>
          <td>10000.0</td>
          <td>0.026373</td>
          <td>0.033027</td>
          <td>0.057158</td>
          <td>0.242925</td>
          <td>0.023476</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 85-127

The problems with higher failture probabilities are obviously solved with more accuracy with the Monte-Carlo method.
For example, the RP55 problem which has the highest probability equal to 0.560 has more than 3 significant digits.
On the opposite side, the problems with probabilities close to zero are much more difficult to solve.
The RP28 with a probability close to :math:`10^{-7}` has no significant digit.

These previous results are consistent with the distribution of the Monte-Carlo estimator.
The properties of the binomial distribution imply that its variance is:

.. math::
    \sigma_{p_f}^2 = \frac{p_f (1-p_f)}{n}

where :math:`n` is the sample size and :math:`p_f` is the failure probability.
The coefficient of variation is:

.. math::
    CV = \frac{\sigma_{p_f}}{p_f}.

Since we do not know the exact value of :math:`p_f`, we use is approximation :math:`\tilde{p_f}` instead
(this turns rigorous equations into approximate ones, but does not change the outcome).
This implies:

.. math::
    CV = \sqrt{\frac{1 - p_f}{p_f n}}.

When :math:`p_f\rightarrow 0`, we have :math:`p_f \rightarrow 0` which implies:

.. math::
     CV \rightarrow \sqrt{\frac{1}{p_f n}}.

Inverting the previous equation, we get the sample size given the coefficient of variation:

.. math::
    n \approx \frac{1}{p_f CV^2}.

This leads to the rule of thumb that, in order to estimate the probability :math:`p_f = 10^{-m}`,
where :math:`m` is an integer, we need a sample size equal to:

.. math::
    n \approx \frac{1}{10^{-m} 10^{-2}} = 10^{m+2}.

For example, estimating the probability of the RP28 problem with just one single digit leads to
a sample size equal to :math:`n=10^9`, since the exact :math:`p_f \approx 10^{-7}`.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 3.003 seconds)


.. _sphx_glr_download_auto_examples_reliability_problems_plot_reliability_compute_reference_proba.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_reliability_compute_reference_proba.ipynb <plot_reliability_compute_reference_proba.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_reliability_compute_reference_proba.py <plot_reliability_compute_reference_proba.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_reliability_compute_reference_proba.zip <plot_reliability_compute_reference_proba.zip>`
